<html>
<head>
<title> Output </title>
<style>.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
</head>
<body>
<p><h2> eudplib\__init__.py : 59 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.trigger</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.ctrlstru</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.eudlib</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.trigtrg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.maprw</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.53a0&#39;</span>


<span class="c1"># remove modules from __all__</span>

<span class="n">_alllist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_k</span><span class="p">,</span> <span class="n">_v</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_v</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">_k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">_alllist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_k</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="n">_alllist</span>


<span class="k">del</span> <span class="n">_k</span>
<span class="k">del</span> <span class="n">_v</span>


<span class="k">def</span> <span class="nf">eudplibVersion</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">__version__</span>

<span class="n">_alllist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;eudplibVersion&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\curpl.py : 59 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="kn">from</span> <span class="nn">.allocator</span> <span class="kn">import</span> <span class="n">Forward</span>
<span class="kn">from</span> <span class="nn">.varfunc</span> <span class="kn">import</span> <span class="n">EUDVariable</span>
<span class="kn">from</span> <span class="nn">.rawtrigger</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EncodePlayer</span><span class="p">,</span>
    <span class="n">Memory</span><span class="p">,</span>
    <span class="n">SetMemory</span><span class="p">,</span>
    <span class="n">SetTo</span><span class="p">,</span>
    <span class="n">Exactly</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">_curpl_var</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
<span class="n">_curpl_checkcond</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">cpcacheMatchCond</span><span class="p">():</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="n">Memory</span><span class="p">(</span><span class="mh">0x6509A0</span><span class="p">,</span> <span class="n">Exactly</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">_curpl_checkcond</span> <span class="o">&lt;&lt;</span> <span class="n">cond</span>
    <span class="k">return</span> <span class="n">cond</span>


<span class="k">def</span> <span class="nf">SetCurrentPlayer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">_curpl_var</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="n">p</span><span class="p">),</span>
        <span class="n">SetMemory</span><span class="p">(</span><span class="n">_curpl_checkcond</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">SetTo</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span>
        <span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">SetTo</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span>
    <span class="p">]</span>


<span class="k">def</span> <span class="nf">GetCPCache</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_curpl_var</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\inlinens.py : 53 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">_objns</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">EUDClearNamespace</span><span class="p">():</span>
    <span class="n">_objns</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">EUDRegisterObjectToNamespace</span><span class="p">(</span><span class="n">funcname</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Register object to inline code namespace. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">funcname</span> <span class="ow">in</span> <span class="n">_objns</span><span class="p">:</span>
            <span class="n">_objns</span><span class="p">[</span><span class="n">funcname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_objns</span><span class="p">[</span><span class="n">funcname</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">return</span> <span class="n">obj</span>


<span class="k">def</span> <span class="nf">EUDRegistered</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Decoreator for registering class / function. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">EUDRegisterObjectToNamespace</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GetEUDNamespace</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Get list of functions that inline code can use. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_objns</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\__init__.py : 35 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.inlinens</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.curpl</span> <span class="kn">import</span> <span class="n">SetCurrentPlayer</span>

<span class="kn">from</span> <span class="nn">.allocator</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.eudobj</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.rawtrigger</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.mapdata</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.varfunc</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.calcf</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\allocator\constexpr.py : 147 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.rlocint</span> <span class="kn">import</span> <span class="n">RlocInt</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">ConstExpr</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39; Class for general expression with rlocints.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseobj</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rlocmode</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span> <span class="o">=</span> <span class="n">baseobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">=</span> <span class="n">rlocmode</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="n">ConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="n">ConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ConstExpr</span><span class="p">):</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">baseobj</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">,</span>
                <span class="s1">&#39;Cannot subtract between addresses btw two objects&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">-</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ConstExpr</span><span class="p">):</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">baseobj</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">,</span>
                <span class="s1">&#39;Cannot subtract between addresses btw two distinct objects&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">,</span> <span class="n">other</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="n">ConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="n">ConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">%</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">%</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;Address not divisible&#39;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">//</span> <span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">//</span> <span class="n">k</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Forward</span><span class="p">(</span><span class="n">ConstExpr</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Class for forward definition.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s1">&#39;Reforwarding without reset is not allowed&#39;</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Cannot forward to None&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="k">return</span> <span class="n">expr</span>

    <span class="k">def</span> <span class="nf">IsSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">Reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Forward not initialized&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Evaluate expressions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RlocInt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">IsConstExpr</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unProxy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ConstExpr</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\allocator\payload.py : 359 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">rlocint</span><span class="p">,</span> <span class="n">pbuffer</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">constexpr</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">eudplib.utils</span> <span class="kn">import</span> <span class="n">stackobjs</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="n">_found_objects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_found_objects_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">_untraversed_objects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_dynamic_objects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_dynamic_objects_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">_alloctable</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_payload_size</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">PHASE_COLLECTING</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PHASE_ALLOCATING</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">PHASE_WRITING</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">phase</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">_payload_compress</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">CompressPayload</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Set payload compression mode.</span>

<span class="sd">    :param mode: If true, enable object stacking (compression). If false,</span>
<span class="sd">    disable it.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">global</span> <span class="n">_payload_compress</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Invalid type&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
        <span class="n">_payload_compress</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_payload_compress</span> <span class="o">=</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">ObjCollector</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Object having PayloadBuffer-like interfaces. Collects all objects by</span>
<span class="sd">    calling RegisterObject() for every related objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">StartWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">EndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">WriteByte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">WriteWord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">WriteDword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="n">constexpr</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WritePack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structformat</span><span class="p">,</span> <span class="o">*</span><span class="n">arglist</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">arglist</span><span class="p">:</span>
            <span class="n">constexpr</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WriteBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">WriteSpace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacesize</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">def</span> <span class="nf">CollectObjects</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">phase</span>
    <span class="k">global</span> <span class="n">_found_objects</span>
    <span class="k">global</span> <span class="n">_found_objects_set</span>
    <span class="k">global</span> <span class="n">_dynamic_objects</span>
    <span class="k">global</span> <span class="n">_dynamic_objects_set</span>
    <span class="k">global</span> <span class="n">_untraversed_objects</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="n">PHASE_COLLECTING</span>

    <span class="n">objc</span> <span class="o">=</span> <span class="n">ObjCollector</span><span class="p">()</span>
    <span class="n">_found_objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_found_objects_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">_dynamic_objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_dynamic_objects_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">_untraversed_objects</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Evaluate root to register root object.</span>
    <span class="c1"># root may not have WritePayload() method e.g: Forward()</span>
    <span class="n">constexpr</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">_untraversed_objects</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">_untraversed_objects</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">_untraversed_objects</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">objc</span><span class="o">.</span><span class="n">StartWrite</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">WritePayload</span><span class="p">(</span><span class="n">objc</span><span class="p">)</span>
            <span class="n">objc</span><span class="o">.</span><span class="n">EndWrite</span><span class="p">()</span>

        <span class="c1"># Check for new objects</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">_dynamic_objects</span><span class="p">[:]:</span>
            <span class="n">objc</span><span class="o">.</span><span class="n">StartWrite</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">WritePayload</span><span class="p">(</span><span class="n">objc</span><span class="p">)</span>
            <span class="n">objc</span><span class="o">.</span><span class="n">EndWrite</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_found_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;No object collected&#39;</span><span class="p">)</span>

    <span class="c1"># Shuffle objects -&gt; Randomize(?) addresses</span>
    <span class="n">fo2</span> <span class="o">=</span> <span class="n">_found_objects</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">fo2</span><span class="p">)</span>
    <span class="n">_found_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">_found_objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">fo2</span>

    <span class="c1"># cleanup</span>
    <span class="n">_found_objects_set</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="bp">None</span>


<span class="c1"># -------</span>


<span class="k">class</span> <span class="nc">ObjAllocator</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Object having PayloadBuffer-like interfaces. Collects all objects by</span>
<span class="sd">    calling RegisterObject() for every related objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">StartWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupmap</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_Occup0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboccupmap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupmap</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_Occup1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupmap</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboccupmap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupmap</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">EndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboccupmap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span>

    <span class="k">def</span> <span class="nf">WriteByte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup0</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup1</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">WriteWord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup0</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup0</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup1</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup1</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">WriteDword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WritePack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structformat</span><span class="p">,</span> <span class="o">*</span><span class="n">arglist</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">structformat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span><span class="p">:</span>
            <span class="n">ssize</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sizedict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arglist</span><span class="p">)):</span>
                <span class="n">ssize</span> <span class="o">+=</span> <span class="n">sizedict</span><span class="p">[</span><span class="n">structformat</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span><span class="p">[</span><span class="n">structformat</span><span class="p">]</span> <span class="o">=</span> <span class="n">ssize</span>

        <span class="n">ssize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span><span class="p">[</span><span class="n">structformat</span><span class="p">]</span>

        <span class="c1"># Add occupiation index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ssize</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">ssize</span> <span class="o">&amp;=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ssize</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup1</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">WriteBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">ssize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ssize</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ssize</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup1</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">WriteSpace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ssize</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">ssize</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suboccupidx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup0</span><span class="p">()</span>
            <span class="n">ssize</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_occupmap</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ssize</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">ssize</span> <span class="o">&amp;=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ssize</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Occup0</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">AllocObjects</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">phase</span>
    <span class="k">global</span> <span class="n">_alloctable</span>
    <span class="k">global</span> <span class="n">_payload_size</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="n">PHASE_ALLOCATING</span>

    <span class="c1"># Quick and less space-efficient approach</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_payload_compress</span><span class="p">:</span>
        <span class="n">lallocaddr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">_found_objects</span><span class="p">:</span>
            <span class="n">objsize</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetDataSize</span><span class="p">()</span>
            <span class="n">allocsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">objsize</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span>
            <span class="n">_alloctable</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">lallocaddr</span>
            <span class="n">lallocaddr</span> <span class="o">+=</span> <span class="n">allocsize</span>
        <span class="n">_payload_size</span> <span class="o">=</span> <span class="n">lallocaddr</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>

    <span class="n">obja</span> <span class="o">=</span> <span class="n">ObjAllocator</span><span class="p">()</span>

    <span class="n">_alloctable</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dwoccupmap_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get occupation map for all objects</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">_found_objects</span><span class="p">:</span>
        <span class="n">obja</span><span class="o">.</span><span class="n">StartWrite</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">WritePayload</span><span class="p">(</span><span class="n">obja</span><span class="p">)</span>
        <span class="n">dwoccupmap</span> <span class="o">=</span> <span class="n">obja</span><span class="o">.</span><span class="n">EndWrite</span><span class="p">()</span>
        <span class="n">dwoccupmap_dict</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">dwoccupmap</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">dwoccupmap</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">GetDataSize</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;Occupation map length &amp; Object size mismatch for object&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">_payload_compress</span><span class="p">:</span>
        <span class="n">stackobjs</span><span class="o">.</span><span class="n">StackObjects</span><span class="p">(</span><span class="n">_found_objects</span><span class="p">,</span> <span class="n">dwoccupmap_dict</span><span class="p">,</span> <span class="n">_alloctable</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">_found_objects</span><span class="p">:</span>
            <span class="n">_alloctable</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">_offset</span>
            <span class="n">_offset</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">dwoccupmap_dict</span><span class="p">[</span><span class="n">obj</span><span class="p">])</span>

    <span class="c1"># Get payload length</span>
    <span class="n">_payload_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">_alloctable</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetDataSize</span><span class="p">(),</span> <span class="n">_found_objects</span>
    <span class="p">))</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="bp">None</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">ConstructPayload</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">phase</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="n">PHASE_WRITING</span>

    <span class="n">pbuf</span> <span class="o">=</span> <span class="n">pbuffer</span><span class="o">.</span><span class="n">PayloadBuffer</span><span class="p">(</span><span class="n">_payload_size</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">_found_objects</span><span class="p">:</span>
        <span class="n">objaddr</span><span class="p">,</span> <span class="n">objsize</span> <span class="o">=</span> <span class="n">_alloctable</span><span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetDataSize</span><span class="p">()</span>

        <span class="n">pbuf</span><span class="o">.</span><span class="n">StartWrite</span><span class="p">(</span><span class="n">objaddr</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">WritePayload</span><span class="p">(</span><span class="n">pbuf</span><span class="p">)</span>
        <span class="n">written_bytes</span> <span class="o">=</span> <span class="n">pbuf</span><span class="o">.</span><span class="n">EndWrite</span><span class="p">()</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="n">written_bytes</span> <span class="o">==</span> <span class="n">objsize</span><span class="p">,</span>
            <span class="s1">&#39;obj.GetDataSize()(</span><span class="si">%d</span><span class="s1">) != Real payload size(</span><span class="si">%d</span><span class="s1">) for object </span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">objsize</span><span class="p">,</span> <span class="n">written_bytes</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">pbuf</span><span class="o">.</span><span class="n">CreatePayload</span><span class="p">()</span>


<span class="n">_on_create_payload_callbacks</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">RegisterCreatePayloadCallback</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">_on_create_payload_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CreatePayload</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="c1"># Call callbacks</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">_on_create_payload_callbacks</span><span class="p">:</span>
        <span class="n">f</span><span class="p">()</span>
    <span class="n">CollectObjects</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">AllocObjects</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ConstructPayload</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">GetObjectAddr</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_alloctable</span>
    <span class="k">global</span> <span class="n">_found_objects</span>
    <span class="k">global</span> <span class="n">_found_objects_set</span>
    <span class="k">global</span> <span class="n">_untraversed_objects</span>
    <span class="k">global</span> <span class="n">_dynamic_objects</span>
    <span class="k">global</span> <span class="n">_dynamic_objects_set</span>

    <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">PHASE_COLLECTING</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_found_objects_set</span><span class="p">:</span>
            <span class="n">_untraversed_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">DynamicConstructed</span><span class="p">():</span>
                <span class="n">_dynamic_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">_dynamic_objects_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">_found_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">_found_objects_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rlocint</span><span class="o">.</span><span class="n">RlocInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">PHASE_ALLOCATING</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rlocint</span><span class="o">.</span><span class="n">RlocInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">PHASE_WRITING</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">_alloctable</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">rlocint</span><span class="o">.</span><span class="n">RlocInt</span><span class="p">(</span><span class="n">_alloctable</span><span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\allocator\pbuffer.py : 174 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">constexpr</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">Payload</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">prttable</span><span class="p">,</span> <span class="n">orttable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prttable</span> <span class="o">=</span> <span class="n">prttable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orttable</span> <span class="o">=</span> <span class="n">orttable</span>


<span class="n">_packerlist</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">class</span> <span class="nc">PayloadBuffer</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Buffer where EUDObject should write to.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totlen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">totlen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_totlen</span> <span class="o">=</span> <span class="n">totlen</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prttable</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orttable</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">StartWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writeaddr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datastart</span> <span class="o">=</span> <span class="n">writeaddr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">=</span> <span class="n">writeaddr</span>

    <span class="k">def</span> <span class="nf">EndWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastart</span>

    <span class="k">def</span> <span class="nf">WriteByte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">constexpr</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">number</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Non-constant given.&#39;</span><span class="p">)</span>
        <span class="n">number</span><span class="o">.</span><span class="n">offset</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b1</span><span class="p">(</span><span class="n">number</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">WriteWord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">constexpr</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">number</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Non-constant given.&#39;</span><span class="p">)</span>
        <span class="n">number</span><span class="o">.</span><span class="n">offset</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b2</span><span class="p">(</span><span class="n">number</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">WriteDword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">constexpr</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="n">number</span><span class="o">.</span><span class="n">offset</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>

        <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Non-const dwords must be aligned to 4byte&#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prttable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">number</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_orttable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;rlocmode should be 1 or 4&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">number</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">WritePack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structformat</span><span class="p">,</span> <span class="o">*</span><span class="n">arglist</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        ======= =======</span>
<span class="sd">          Char   Type</span>
<span class="sd">        ======= =======</span>
<span class="sd">           B     Byte</span>
<span class="sd">           H     Word</span>
<span class="sd">           I     Dword</span>
<span class="sd">        ======= =======</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">structformat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_packerlist</span><span class="p">:</span>
            <span class="n">_packerlist</span><span class="p">[</span><span class="n">structformat</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CreateStructPacker</span><span class="p">(</span><span class="n">structformat</span><span class="p">)</span>

        <span class="n">_packerlist</span><span class="p">[</span><span class="n">structformat</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arglist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WriteBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Write bytes object to buffer.</span>

<span class="sd">        :param b: bytes object to write.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WriteSpace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacesize</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">+=</span> <span class="n">spacesize</span>

    <span class="c1"># Internally used</span>
    <span class="k">def</span> <span class="nf">CreatePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Payload</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prttable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orttable</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_CreateStructPacker</span><span class="p">(</span><span class="n">structformat</span><span class="p">):</span>
    <span class="n">sizedict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
    <span class="n">fdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">}</span>

    <span class="n">sizelist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">flist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">structlen</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structformat</span><span class="p">:</span>
        <span class="n">datasize</span> <span class="o">=</span> <span class="n">sizedict</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">structlen</span> <span class="o">+=</span> <span class="n">datasize</span>

        <span class="n">sizelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datasize</span><span class="p">)</span>
        <span class="n">flist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fdict</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">packer</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">*</span><span class="n">arglist</span><span class="p">):</span>
        <span class="n">dpos</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">_datacur</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">_data</span>
        <span class="n">prttb</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">_prttable</span>
        <span class="n">orttb</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">_orttable</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arglist</span><span class="p">):</span>
            <span class="n">ri</span> <span class="o">=</span> <span class="n">constexpr</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
                <span class="n">ri</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sizelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">dpos</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;Cannot write non-const in byte/word/nonalligned dword.&#39;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">ri</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">prttb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dpos</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">ri</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">orttb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dpos</span><span class="p">)</span>

            <span class="n">data</span><span class="p">[</span><span class="n">dpos</span><span class="p">:</span> <span class="n">dpos</span> <span class="o">+</span> <span class="n">sizelist</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">flist</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">ri</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">dpos</span> <span class="o">+=</span> <span class="n">sizelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">buf</span><span class="o">.</span><span class="n">_datacur</span> <span class="o">=</span> <span class="n">dpos</span>

    <span class="k">return</span> <span class="n">packer</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\allocator\rlocint.py : 101 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">RlocInt</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Relocatable int&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">rlocmode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span> <span class="n">rlocmode</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">toRlocInt</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RlocInt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">rlocmode</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">toRlocInt</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RlocInt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">rlocmode</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">toRlocInt</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">toRlocInt</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;Cannot multiply two non-const RlocInts&#39;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">RlocInt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">rlocmode</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">toRlocInt</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="n">other</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;Cannot divide RlocInt with non-const&#39;</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Divide by zero&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">%</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">%</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;RlocInt not divisible by </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">RlocInt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">//</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span> <span class="o">//</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Rlocint(0x</span><span class="si">%08X</span><span class="s1">, </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rlocmode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">toRlocInt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert int/RlocInt to rlocint&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">RlocInt</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RlocInt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\allocator\__init__.py : 44 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.constexpr</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConstExpr</span><span class="p">,</span>
    <span class="n">Forward</span><span class="p">,</span>
    <span class="n">Evaluate</span><span class="p">,</span>
    <span class="n">IsConstExpr</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.rlocint</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RlocInt</span><span class="p">,</span>
    <span class="n">toRlocInt</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.payload</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GetObjectAddr</span><span class="p">,</span>
    <span class="n">CreatePayload</span><span class="p">,</span>
    <span class="n">CompressPayload</span><span class="p">,</span>
    <span class="n">RegisterCreatePayloadCallback</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\calcf\bitwise.py : 148 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">varfunc</span> <span class="k">as</span> <span class="n">vf</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">rawtrigger</span> <span class="k">as</span> <span class="n">rt</span>
<span class="kn">from</span> <span class="nn">.muldiv</span> <span class="kn">import</span> <span class="n">f_mul</span><span class="p">,</span> <span class="n">f_div</span>


<span class="k">def</span> <span class="nf">bw_gen</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">docstring</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="nd">@vf.EUDFunc</span>
    <span class="k">def</span> <span class="nf">f_bitsize_template</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDLightVariable</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

        <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                <span class="p">],</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                <span class="p">],</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">conditions</span><span class="o">=</span><span class="n">cond</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span>
                <span class="n">actions</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">if</span> <span class="n">docstring</span><span class="p">:</span>
        <span class="n">f_bitsize_template</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">docstring</span>

    <span class="k">return</span> <span class="n">f_bitsize_template</span>


<span class="n">f_bitand</span> <span class="o">=</span> <span class="n">bw_gen</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;Calculate a &amp; b&quot;</span><span class="p">)</span>
<span class="n">f_bitor</span> <span class="o">=</span> <span class="n">bw_gen</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Calculate a | b&quot;</span><span class="p">)</span>
<span class="n">f_bitxor</span> <span class="o">=</span> <span class="n">bw_gen</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Calculate a ^ b&quot;</span><span class="p">)</span>
<span class="n">f_bitnand</span> <span class="o">=</span> <span class="n">bw_gen</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Calculate ~(a &amp; b)&quot;</span><span class="p">)</span>
<span class="n">f_bitnor</span> <span class="o">=</span> <span class="n">bw_gen</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">AtMost</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Calculate ~(a | b)&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">f_bitnxor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate ~(a ^ b)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_bitnot</span><span class="p">(</span><span class="n">f_bitxor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">f_bitnot</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate ~a&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mh">0xFFFFFFFF</span> <span class="o">-</span> <span class="n">a</span>


<span class="c1"># -------</span>


<span class="nd">@vf.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_bitsplit</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Splits bit of given number</span>

<span class="sd">    :returns: int bits[32];  // bits[i] = (ith bit from LSB of a is set)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bits</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
        <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">a</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">bits</span>


<span class="c1"># -------</span>

<span class="nd">@vf.EUDFunc</span>
<span class="k">def</span> <span class="nf">_exp2_vv</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
        <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">ret</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">))]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span> <span class="nf">_exp2</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_exp2_vv</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">f_bitlshift</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;a &lt;&lt; b&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_exp2</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">f_bitrshift</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate a &gt;&gt; b&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">f_div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_exp2</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\calcf\muldiv.py : 256 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">varfunc</span> <span class="k">as</span> <span class="n">vf</span><span class="p">,</span>
    <span class="n">rawtrigger</span> <span class="k">as</span> <span class="n">rt</span><span class="p">,</span>
    <span class="n">allocator</span> <span class="k">as</span> <span class="n">ac</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">def</span> <span class="nf">f_mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate a * b&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_f_mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f_constmul</span><span class="p">(</span><span class="n">b</span><span class="p">)(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f_constmul</span><span class="p">(</span><span class="n">a</span><span class="p">)(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
        <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span> <span class="nf">f_div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate (a//b, a%b) &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_f_div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f_constdiv</span><span class="p">(</span><span class="n">b</span><span class="p">)(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="n">a</span>
        <span class="n">vq</span><span class="p">,</span> <span class="n">vm</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">vq</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span>
            <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="n">vq</span><span class="p">,</span> <span class="n">vm</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">f_constmul</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    f_constnum(a)(b) calculates b * a.</span>

<span class="sd">    :param number: Constant integer being multiplied to other numbers.</span>
<span class="sd">    :return: Function taking one parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f_constmul</span><span class="p">,</span> <span class="s1">&#39;mulfdict&#39;</span><span class="p">):</span>
        <span class="n">f_constmul</span><span class="o">.</span><span class="n">mulfdict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">mulfdict</span> <span class="o">=</span> <span class="n">f_constmul</span><span class="o">.</span><span class="n">mulfdict</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mulfdict</span><span class="p">[</span><span class="n">number</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nd">@vf.EUDFunc</span>
        <span class="k">def</span> <span class="nf">_mulf</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
            <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                    <span class="n">conditions</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                    <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="n">mulfdict</span><span class="p">[</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">_mulf</span>
        <span class="k">return</span> <span class="n">_mulf</span>


<span class="k">def</span> <span class="nf">f_constdiv</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    f_constdiv(a)(b) calculates (b // a, b % a)</span>

<span class="sd">    :param number: Constant integer to divide other numbers by.</span>
<span class="sd">    :return: Function taking one parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f_constdiv</span><span class="p">,</span> <span class="s1">&#39;divfdict&#39;</span><span class="p">):</span>
        <span class="n">f_constdiv</span><span class="o">.</span><span class="n">divfdict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">divfdict</span> <span class="o">=</span> <span class="n">f_constdiv</span><span class="o">.</span><span class="n">divfdict</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">divfdict</span><span class="p">[</span><span class="n">number</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nd">@vf.EUDFunc</span>
        <span class="k">def</span> <span class="nf">_divf</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
            <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># number too big</span>
                <span class="k">if</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                    <span class="n">conditions</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number</span><span class="p">),</span>
                    <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number</span><span class="p">),</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">a</span>

        <span class="n">divfdict</span><span class="p">[</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">_divf</span>
        <span class="k">return</span> <span class="n">_divf</span>


<span class="c1"># -------</span>


<span class="nd">@vf.EUDFunc</span>
<span class="k">def</span> <span class="nf">_f_mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Init</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
        <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
    <span class="n">chain_y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>

    <span class="c1"># Calculate chain_y0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">((</span>
            <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">chain_y0</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
            <span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
        <span class="p">))</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
            <span class="n">p1</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">nextptr</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span>
                <span class="n">conditions</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">AtMost</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">actions</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">p3</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">nextptr</span><span class="o">=</span><span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">actions</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">p2</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="c1"># Run multiplication chain</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">cy0</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

        <span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">a</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">a</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">cy0</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">chain_y0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">cy0</span> <span class="o">+</span> <span class="mi">20</span>

    <span class="k">return</span> <span class="n">ret</span>


<span class="nd">@vf.EUDFunc</span>
<span class="k">def</span> <span class="nf">_f_div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Init</span>
    <span class="n">vf</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
        <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="c1"># Chain ac.Forward decl</span>
    <span class="n">chain_x0</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
    <span class="n">chain_x1</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
    <span class="n">chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>

    <span class="c1"># Fill in chain</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
        <span class="n">vf</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">chain_x0</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
            <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">chain_x1</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="c1"># Skip if over 0x80000000</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">p1</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mh">0x80000000</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">p3</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">p2</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="n">vf</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
        <span class="p">])</span>

    <span class="c1"># Run division chain</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">cx0</span><span class="p">,</span> <span class="n">cx1</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">ac</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">cx0</span> <span class="o">&lt;&lt;</span> <span class="n">a</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">cx1</span> <span class="o">&lt;&lt;</span> <span class="n">a</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">chain_x0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">cx0</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">chain_x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">cx1</span> <span class="o">+</span> <span class="mi">20</span>

    <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">a</span>  <span class="c1"># a : remainder</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\calcf\_eudvsupport.py : 64 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.muldiv</span> <span class="kn">import</span> <span class="n">f_mul</span><span class="p">,</span> <span class="n">f_div</span>
<span class="kn">from</span> <span class="nn">.bitwise</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_bitand</span><span class="p">,</span>
    <span class="n">f_bitor</span><span class="p">,</span>
    <span class="n">f_bitxor</span><span class="p">,</span>
    <span class="n">f_bitnot</span><span class="p">,</span>
<span class="p">)</span>


<span class="kn">from</span> <span class="nn">..varfunc</span> <span class="kn">import</span> <span class="n">EUDVariable</span>


<span class="k">def</span> <span class="nf">DefClsMethod</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="s1">&#39;EUDVariable.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">EUDVariable</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">DefOperator</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="n">DefClsMethod</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="n">DefClsMethod</span><span class="p">(</span><span class="s1">&#39;__i</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">iop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="n">DefClsMethod</span><span class="p">(</span><span class="s1">&#39;__r</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">rop</span><span class="p">)</span>


<span class="n">DefOperator</span><span class="p">(</span><span class="s1">&#39;__mul__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">f_mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">DefOperator</span><span class="p">(</span><span class="s1">&#39;__floordiv__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">f_div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">DefOperator</span><span class="p">(</span><span class="s1">&#39;__mod__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">f_div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">DefOperator</span><span class="p">(</span><span class="s1">&#39;__and__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">f_bitand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">DefOperator</span><span class="p">(</span><span class="s1">&#39;__or__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">f_bitor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">DefOperator</span><span class="p">(</span><span class="s1">&#39;__xor__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">f_bitxor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">DefClsMethod</span><span class="p">(</span><span class="s1">&#39;__neg__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
<span class="n">DefClsMethod</span><span class="p">(</span><span class="s1">&#39;__invert__&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f_bitnot</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\calcf\__init__.py : 47 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.bitwise</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_bitand</span><span class="p">,</span>
    <span class="n">f_bitor</span><span class="p">,</span>
    <span class="n">f_bitxor</span><span class="p">,</span>
    <span class="n">f_bitnand</span><span class="p">,</span>
    <span class="n">f_bitnor</span><span class="p">,</span>
    <span class="n">f_bitnxor</span><span class="p">,</span>
    <span class="n">f_bitnot</span><span class="p">,</span>
    <span class="n">f_bitlshift</span><span class="p">,</span>
    <span class="n">f_bitrshift</span><span class="p">,</span>
    <span class="n">f_bitsplit</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.muldiv</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_mul</span><span class="p">,</span>
    <span class="n">f_div</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Just run _eudvsupport. This won&#39;t be visible in user side.</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_eudvsupport</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\eudobj\bytedump.py : 42 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.eudobj</span> <span class="kn">import</span> <span class="n">EUDObject</span>


<span class="k">class</span> <span class="nc">Db</span><span class="p">(</span><span class="n">EUDObject</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class for raw data object&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pbuffer</span><span class="p">):</span>
        <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\eudobj\eudobj.py : 81 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="n">ConstExpr</span>
<span class="kn">from</span> <span class="nn">..allocator.payload</span> <span class="kn">import</span> <span class="n">GetObjectAddr</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">EUDObject</span><span class="p">(</span><span class="n">ConstExpr</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for standalone object on memory</span>

<span class="sd">    .. note::</span>
<span class="sd">        Object collection occures in three steps:</span>

<span class="sd">        - Collection phase : collects object used in map generation. Object</span>
<span class="sd">        used in WritePayload method are being collected. Methods Evaluate</span>
<span class="sd">        and WritePayload are called during this phase.</span>
<span class="sd">        - Allocation phase : Object have their offset assigned. GetDataSize</span>
<span class="sd">        method is called on this phase, so if GetDataSize is being called,</span>
<span class="sd">        it means that every object required in map has been collected.</span>
<span class="sd">        WritePayload and GetDataSize method should behave exactly the same as</span>
<span class="sd">        it should on Writing phase here.</span>
<span class="sd">        - Writing phase : Object is written into payload.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">DynamicConstructed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Whether function is constructed dynamically.</span>

<span class="sd">        Dynamically constructed EUDObject may have their dependency list</span>
<span class="sd">        generated during object construction. So their dependency list is</span>
<span class="sd">        re-examined before allocation phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        What this object should be evaluated to when used in eudplib program.</span>

<span class="sd">        :return: Default) Memory address of this object.</span>

<span class="sd">        .. note::</span>
<span class="sd">            In overriding this method, you can use</span>
<span class="sd">            :func:`eudplib.GetObjectAddr`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GetObjectAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Memory size of object.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Override&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pbuffer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write object&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Override&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\eudobj\__init__.py : 28 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.eudobj</span> <span class="kn">import</span> <span class="n">EUDObject</span>
<span class="kn">from</span> <span class="nn">.bytedump</span> <span class="kn">import</span> <span class="n">Db</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\chktok.py : 155 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">scenario.chk section tokenizer. Internally used in eudplib.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">General CHK class.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">sectionname_format</span><span class="p">(</span><span class="n">sn</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">sn</span> <span class="o">+=</span> <span class="n">b</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sn</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Length of section name cannot be longer than 4&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sn</span>


<span class="k">class</span> <span class="nc">CHK</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">loadblank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">loadchk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># this code won&#39;t handle protection methods properly such as...</span>
        <span class="c1"># - duplicate section name</span>
        <span class="c1"># - jump section protection</span>
        <span class="c1">#</span>
        <span class="c1"># this program although handles</span>
        <span class="c1">#  - invalid section length (too high)</span>
        <span class="c1">#  - unused sections</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span>  <span class="c1"># temporarilly store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="c1"># read data</span>
            <span class="n">sectionname</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span><span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
            <span class="n">sectionlength</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i4</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sectionlength</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># jsp with negative section size.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="n">t</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="n">section</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">8</span><span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">sectionlength</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="n">sectionlength</span> <span class="o">+</span> <span class="mi">8</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">sectionname</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">savechk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># calculate output size</span>
        <span class="n">blist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">binary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">blist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">binary</span><span class="p">))</span> <span class="o">+</span> <span class="n">binary</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">blist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">enumsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">getsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">):</span>
        <span class="n">sectionname</span> <span class="o">=</span> <span class="n">sectionname_format</span><span class="p">(</span><span class="n">sectionname</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">sectionname</span><span class="p">]</span>  <span class="c1"># Nameerror may be raised.</span>

    <span class="k">def</span> <span class="nf">setsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">sectionname</span> <span class="o">=</span> <span class="n">sectionname_format</span><span class="p">(</span><span class="n">sectionname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">sectionname</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">):</span>
        <span class="n">sectionname</span> <span class="o">=</span> <span class="n">sectionname_format</span><span class="p">(</span><span class="n">sectionname</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">sectionname</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Delete unused sections</span>
        <span class="n">used_section</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">b</span><span class="s1">&#39;VER &#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;VCOD&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;OWNR&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;ERA &#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;DIM &#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;SIDE&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;MTXM&#39;</span><span class="p">,</span>
            <span class="n">b</span><span class="s1">&#39;UNIT&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;THG2&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;MASK&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;STR &#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;UPRP&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;MRGN&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;TRIG&#39;</span><span class="p">,</span>
            <span class="n">b</span><span class="s1">&#39;MBRF&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;SPRP&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;FORC&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;COLR&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;PUNI&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;PUPx&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;PTEx&#39;</span><span class="p">,</span>
            <span class="n">b</span><span class="s1">&#39;UNIx&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;UPGx&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;TECx&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">unused_section</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">sn</span> <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">sn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_section</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">unused_section</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">sn</span><span class="p">]</span>

        <span class="c1"># Terrain optimization</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;DIM &#39;</span><span class="p">)</span>
        <span class="n">mapw</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i2</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">maph</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i2</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">terrainsize</span> <span class="o">=</span> <span class="n">mapw</span> <span class="o">*</span> <span class="n">maph</span>

        <span class="c1"># MASK optimization : cancel 0xFFs.</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;MASK&#39;</span><span class="p">)</span>
        <span class="n">clippos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">terrainsize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0xff</span><span class="p">:</span>
                <span class="n">clippos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">break</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[:</span><span class="n">clippos</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;MASK&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

        <span class="c1"># MTXM optimization</span>
        <span class="c1"># MASK optimization : cancel 0xFFs.</span>
        <span class="n">mtxm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;MTXM&#39;</span><span class="p">)</span>
        <span class="n">clippos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">terrainsize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mtxm</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x00</span> <span class="ow">or</span> <span class="n">mtxm</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x00</span><span class="p">:</span>
                <span class="n">clippos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">break</span>

        <span class="n">mtxm</span> <span class="o">=</span> <span class="n">mtxm</span><span class="p">[:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">clippos</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;MTXM&#39;</span><span class="p">,</span> <span class="n">mtxm</span><span class="p">)</span>

        <span class="c1"># More optimization would be possible, but I don&#39;t care.</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\mapdata.py : 61 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.stringmap</span> <span class="kn">import</span> <span class="n">InitStringMap</span><span class="p">,</span> <span class="n">ApplyStringMap</span>
<span class="kn">from</span> <span class="nn">.proptable</span> <span class="kn">import</span> <span class="n">InitPropertyMap</span><span class="p">,</span> <span class="n">ApplyPropertyMap</span>
<span class="kn">from</span> <span class="nn">.playerinfo</span> <span class="kn">import</span> <span class="n">InitPlayerInfo</span>

<span class="n">_inited</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">_chkt</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_rawfile</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">InitMapData</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">rawfile</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_inited</span><span class="p">,</span> <span class="n">_chkt</span><span class="p">,</span> <span class="n">_rawfile</span>
    <span class="n">_chkt</span> <span class="o">=</span> <span class="n">chkt</span>
    <span class="n">_rawfile</span> <span class="o">=</span> <span class="n">rawfile</span>

    <span class="n">InitStringMap</span><span class="p">(</span><span class="n">chkt</span><span class="p">)</span>
    <span class="n">InitPropertyMap</span><span class="p">(</span><span class="n">chkt</span><span class="p">)</span>
    <span class="n">InitPlayerInfo</span><span class="p">(</span><span class="n">chkt</span><span class="p">)</span>
    <span class="n">_inited</span> <span class="o">=</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">UpdateMapData</span><span class="p">():</span>
    <span class="n">ApplyStringMap</span><span class="p">(</span><span class="n">_chkt</span><span class="p">)</span>
    <span class="n">ApplyPropertyMap</span><span class="p">(</span><span class="n">_chkt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">IsMapdataInitalized</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_inited</span>


<span class="k">def</span> <span class="nf">GetChkTokenized</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_chkt</span>


<span class="k">def</span> <span class="nf">GetRawFile</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_rawfile</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\mpqapi.py : 302 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">SFmpq.dll wrapper. Used internally inside eudplib.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># @UnusedWildImport</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">find where sfmpq.dll is.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># These can be an argument to for MpqWrite.PutWave</span>
<span class="n">WAVCOMP_NOCOMPRESSION</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">WAVCOMP_HIGHQUALITY</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">WAVCOMP_MIDQUALITY</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">WAVCOMP_LOWQUALITY</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">SFmpq</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">find_data_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;frozen&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="c1"># The application is frozen</span>
        <span class="n">datadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># The application is not frozen</span>
        <span class="c1"># Change this bit to match where you store your data files:</span>
        <span class="n">datadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datadir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>


<span class="n">currentdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">InitMpqLibrary</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">SFmpq</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># 32bit</span>
            <span class="n">SFmpq</span> <span class="o">=</span> <span class="n">WinDLL</span><span class="p">(</span><span class="n">find_data_file</span><span class="p">(</span><span class="s1">&#39;SFmpq32.dll&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SFmpq</span> <span class="o">=</span> <span class="n">WinDLL</span><span class="p">(</span><span class="n">find_data_file</span><span class="p">(</span><span class="s1">&#39;SFmpq64.dll&#39;</span><span class="p">))</span>

        <span class="c1"># for MpqRead</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileOpenArchive</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileCloseArchive</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileOpenFileEx</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileGetFileSize</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileReadFile</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileCloseFile</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>

        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileOpenArchive</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_void_p</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileCloseArchive</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_void_p</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileOpenFileEx</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_void_p</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileGetFileSize</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">,</span> <span class="n">c_void_p</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileReadFile</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c_int</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_void_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileCloseFile</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">]</span>

        <span class="c1"># for MpqWrite</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqOpenArchiveForUpdate</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqAddFileFromBuffer</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqAddWaveFromBuffer</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqRenameFile</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqDeleteFile</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqCloseUpdatedArchive</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqCompactArchive</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>

        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqOpenArchiveForUpdate</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_int</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqAddFileFromBuffer</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c_int</span><span class="p">,</span> <span class="n">c_void_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_int</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqAddWaveFromBuffer</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c_int</span><span class="p">,</span> <span class="n">c_void_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_int</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqRenameFile</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqDeleteFile</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqCloseUpdatedArchive</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">,</span> <span class="n">c_int</span><span class="p">]</span>
        <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqCompactArchive</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Loading SFmpq failed.&#39;</span><span class="p">)</span>
        <span class="n">SFmpq</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">MpqRead</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span> <span class="o">=</span> <span class="n">SFmpq</span>  <span class="c1"># SFmpq are global variable. We cannot rely on it</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s2">&quot;double open&quot;</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">c_int</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileOpenArchive</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">byref</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">Close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileCloseArchive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">EnumFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># using listfile.</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Extract</span><span class="p">(</span><span class="s1">&#39;(listfile)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lst</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2u</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c1"># Open file</span>
        <span class="n">fileh</span> <span class="o">=</span> <span class="n">c_int</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileOpenFileEx</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">byref</span><span class="p">(</span><span class="n">fileh</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">fileh</span> <span class="o">=</span> <span class="n">fileh</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Get file size &amp; allocate buffer</span>
        <span class="c1"># Note : this version only supports 32bit mpq file</span>
        <span class="n">fsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileGetFileSize</span><span class="p">(</span><span class="n">fileh</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">create_string_buffer</span><span class="p">(</span><span class="n">fsize</span><span class="p">)</span>
        <span class="n">readleft</span> <span class="o">=</span> <span class="n">fsize</span>
        <span class="n">read</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># read data</span>
        <span class="k">while</span> <span class="n">readleft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">buffer</span> <span class="o">=</span> <span class="n">create_string_buffer</span><span class="p">(</span><span class="n">readleft</span><span class="p">)</span>
            <span class="n">readbyte</span> <span class="o">=</span> <span class="n">c_int</span><span class="p">()</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileReadFile</span><span class="p">(</span>
                <span class="n">fileh</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="n">readleft</span><span class="p">,</span> <span class="n">byref</span><span class="p">(</span><span class="n">readbyte</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">readbyte</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">readleft</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span> <span class="ow">or</span> <span class="n">readbyte</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># read failed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileCloseFile</span><span class="p">(</span><span class="n">fileh</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>

            <span class="n">f</span><span class="p">[</span><span class="n">read</span><span class="p">:</span><span class="n">read</span> <span class="o">+</span> <span class="n">readbyte</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">readbyte</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="n">readleft</span> <span class="o">-=</span> <span class="n">readbyte</span><span class="o">.</span><span class="n">value</span>
            <span class="n">read</span> <span class="o">+=</span> <span class="n">readbyte</span><span class="o">.</span><span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SFmpq</span><span class="o">.</span><span class="n">SFileCloseFile</span><span class="p">(</span><span class="n">fileh</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">raw</span>


<span class="c1"># flags internally used by MpqWrite</span>
<span class="n">MOAU_OPEN_ALWAYS</span> <span class="o">=</span> <span class="mh">0x20</span>
<span class="n">MOAU_CREATE_ALWAYS</span> <span class="o">=</span> <span class="mh">0x08</span>
<span class="n">MOAU_MAINTAIN_LISTFILE</span> <span class="o">=</span> <span class="mh">0x01</span>

<span class="n">MAFA_MODCRYPTKEY</span> <span class="o">=</span> <span class="mh">0x00020000</span>
<span class="n">MAFA_ENCRYPT</span> <span class="o">=</span> <span class="mh">0x00010000</span>
<span class="n">MAFA_COMPRESS</span> <span class="o">=</span> <span class="mh">0x00000200</span>
<span class="n">MAFA_REPLACE_EXISTING</span> <span class="o">=</span> <span class="mh">0x00000001</span>
<span class="n">MAFA_COMPRESS_STANDARD</span> <span class="o">=</span> <span class="mh">0x08</span>

<span class="c1"># NEVER USE THESE FOR MpqWrite.PutWave!!!!!!</span>
<span class="n">MAWA_QUALITY_HIGH</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">MAWA_QUALITY_MEDIUM</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">MAWA_QUALITY_LOW</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">WaveCmpDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">WAVCOMP_NOCOMPRESSION</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">WAVCOMP_HIGHQUALITY</span><span class="p">:</span> <span class="n">MAWA_QUALITY_HIGH</span><span class="p">,</span>
    <span class="n">WAVCOMP_MIDQUALITY</span><span class="p">:</span> <span class="n">MAWA_QUALITY_MEDIUM</span><span class="p">,</span>
    <span class="n">WAVCOMP_LOWQUALITY</span><span class="p">:</span> <span class="n">MAWA_QUALITY_LOW</span>
<span class="p">}</span>
<span class="c1"># NEVER USE THESE FOR MpqWrite.PutWave!!!!!!</span>


<span class="k">class</span> <span class="nc">MpqWrite</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">preserve_content</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s2">&quot;double open&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">preserve_content</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">MOAU_OPEN_ALWAYS</span> <span class="o">|</span> <span class="n">MOAU_MAINTAIN_LISTFILE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">MOAU_CREATE_ALWAYS</span> <span class="o">|</span> <span class="n">MOAU_MAINTAIN_LISTFILE</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqOpenArchiveForUpdate</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">flag</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="o">=</span> <span class="n">ret</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">Close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c1"># Close archive</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqCloseUpdatedArchive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flist</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">PutFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c1"># Replace file if existing</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">MAFA_ENCRYPT</span> <span class="o">|</span> <span class="n">MAFA_COMPRESS</span>
        <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">|=</span> <span class="n">MAFA_REPLACE_EXISTING</span>
        <span class="n">cmptype</span> <span class="o">=</span> <span class="n">MAFA_COMPRESS_STANDARD</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqAddFileFromBufferEx</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">buffer</span><span class="p">),</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">flag</span><span class="p">,</span> <span class="n">cmptype</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PutWave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="n">complev</span><span class="o">=</span><span class="n">WAVCOMP_LOWQUALITY</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">cmplevel</span> <span class="o">=</span> <span class="n">WaveCmpDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">complev</span><span class="p">,</span> <span class="n">MAWA_QUALITY_HIGH</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmplevel</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PutFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">)</span>

        <span class="n">flag</span> <span class="o">=</span> <span class="n">MAFA_ENCRYPT</span> <span class="o">|</span> <span class="n">MAFA_COMPRESS</span>
        <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">|=</span> <span class="n">MAFA_REPLACE_EXISTING</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqAddWaveFromBuffer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">buffer</span><span class="p">),</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">flag</span><span class="p">,</span> <span class="n">cmplevel</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">DeleteFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqDeleteFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Compact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">SFmpq</span><span class="o">.</span><span class="n">MpqCompactArchive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpqh</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>


<span class="k">if</span> <span class="ow">not</span> <span class="n">InitMpqLibrary</span><span class="p">():</span>
    <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s2">&quot;Cannot load SFmpq.dll. SFmpq not initalized&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\playerinfo.py : 77 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>

<span class="n">_playerinfo</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">class</span> <span class="nc">PlayerInfo</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">InitPlayerInfo</span><span class="p">(</span><span class="n">chkt</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_playerinfo</span>

    <span class="n">section_forc</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;FORC&#39;</span><span class="p">)</span>
    <span class="n">section_ownr</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;OWNR&#39;</span><span class="p">)</span>
    <span class="n">section_side</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;SIDE&#39;</span><span class="p">)</span>

    <span class="n">_playerinfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">PlayerInfo</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">pinfo</span> <span class="o">=</span> <span class="n">_playerinfo</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>

        <span class="c1"># Numeric info</span>
        <span class="n">pinfo</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">section_forc</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>
        <span class="n">pinfo</span><span class="o">.</span><span class="n">race</span> <span class="o">=</span> <span class="n">section_side</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>
        <span class="n">pinfo</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">section_ownr</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>

        <span class="c1"># String info</span>
        <span class="n">pinfo</span><span class="o">.</span><span class="n">racestr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mh">0x00</span><span class="p">:</span> <span class="s2">&quot;Zerg&quot;</span><span class="p">,</span>
            <span class="mh">0x01</span><span class="p">:</span> <span class="s2">&quot;Terran&quot;</span><span class="p">,</span>
            <span class="mh">0x02</span><span class="p">:</span> <span class="s2">&quot;Protoss&quot;</span><span class="p">,</span>
            <span class="mh">0x03</span><span class="p">:</span> <span class="s2">&quot;Independent&quot;</span><span class="p">,</span>
            <span class="mh">0x04</span><span class="p">:</span> <span class="s2">&quot;Neutral&quot;</span><span class="p">,</span>
            <span class="mh">0x05</span><span class="p">:</span> <span class="s2">&quot;User selectable&quot;</span><span class="p">,</span>
            <span class="mh">0x07</span><span class="p">:</span> <span class="s2">&quot;Inactive&quot;</span><span class="p">,</span>
            <span class="mh">0x08</span><span class="p">:</span> <span class="s2">&quot;Human&quot;</span><span class="p">,</span>
            <span class="mh">0x0A</span><span class="p">:</span> <span class="s2">&quot;Human&quot;</span><span class="p">,</span>
            <span class="mh">0x0D</span><span class="p">:</span> <span class="s2">&quot;Starcraft Campaign Editor&quot;</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pinfo</span><span class="o">.</span><span class="n">race</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">pinfo</span><span class="o">.</span><span class="n">typestr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mh">0x00</span><span class="p">:</span> <span class="s2">&quot;Unused&quot;</span><span class="p">,</span>
            <span class="mh">0x03</span><span class="p">:</span> <span class="s2">&quot;Rescuable&quot;</span><span class="p">,</span>
            <span class="mh">0x05</span><span class="p">:</span> <span class="s2">&quot;Computer&quot;</span><span class="p">,</span>
            <span class="mh">0x06</span><span class="p">:</span> <span class="s2">&quot;Human&quot;</span><span class="p">,</span>
            <span class="mh">0x07</span><span class="p">:</span> <span class="s2">&quot;Neutral&quot;</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pinfo</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GetPlayerInfo</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_playerinfo</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\proptable.py : 74 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.unitprp</span> <span class="kn">import</span> <span class="n">UnitProperty</span>

<span class="n">_uprpdict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_uprptable</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">InitPropertyMap</span><span class="p">(</span><span class="n">chkt</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_prptable</span><span class="p">,</span> <span class="n">_uprpdict</span>
    <span class="n">_uprpdict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">_uprptable</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">_uprptable</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span><span class="p">)</span>

    <span class="c1"># Backup UPRP data</span>
    <span class="n">uprp</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;UPRP&#39;</span><span class="p">)</span>
    <span class="n">upus</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;UPUS&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">upus</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">uprpdata</span> <span class="o">=</span> <span class="n">uprp</span><span class="p">[</span><span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="p">:</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">20</span><span class="p">]</span>
            <span class="n">_uprpdict</span><span class="p">[</span><span class="n">uprpdata</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">_uprptable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uprpdata</span>


<span class="k">def</span> <span class="nf">GetPropertyIndex</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">UnitProperty</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">),</span>
                 <span class="s1">&#39;Invalid property type&#39;</span><span class="p">)</span>

    <span class="n">prop</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_uprpdict</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># SC counts unit properties from 1. Sucks</span>

    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">uprpindex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_uprptable</span><span class="p">[</span><span class="n">uprpindex</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">uprpindex</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;Unit property table overflow&#39;</span><span class="p">)</span>

        <span class="n">_uprptable</span><span class="p">[</span><span class="n">uprpindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>
        <span class="n">_uprpdict</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">uprpindex</span>
        <span class="k">return</span> <span class="n">uprpindex</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># SC counts unit properties from 1. Sucks</span>


<span class="k">def</span> <span class="nf">ApplyPropertyMap</span><span class="p">(</span><span class="n">chkt</span><span class="p">):</span>
    <span class="n">uprpdata</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">uprpdata</span> <span class="ow">or</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">uprpdata</span> <span class="ow">in</span> <span class="n">_uprptable</span><span class="p">])</span>
    <span class="n">chkt</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="s1">&#39;UPRP&#39;</span><span class="p">,</span> <span class="n">uprpdata</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\stringmap.py : 115 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tblformat</span>
<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="n">b2i2</span><span class="p">,</span> <span class="n">b2i4</span><span class="p">,</span> <span class="n">u2b</span>


<span class="k">class</span> <span class="nc">StringIdMap</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s2id</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">AddItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">u2b</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s2id</span><span class="p">:</span>  <span class="c1"># ambigious string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s2id</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s2id</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="nf">GetStringIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">u2b</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s2id</span><span class="p">[</span><span class="n">string</span><span class="p">]</span>


<span class="n">strmap</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">unitmap</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">locmap</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">swmap</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">IgnoreColor</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="mh">0x01</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mh">0x1F</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span> <span class="mh">0x7F</span><span class="p">),</span> <span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">InitStringMap</span><span class="p">(</span><span class="n">chkt</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">strmap</span><span class="p">,</span> <span class="n">unitmap</span><span class="p">,</span> <span class="n">locmap</span><span class="p">,</span> <span class="n">swmap</span>

    <span class="n">strmap</span> <span class="o">=</span> <span class="n">tblformat</span><span class="o">.</span><span class="n">TBL</span><span class="p">(</span><span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;STR&#39;</span><span class="p">))</span>
    <span class="n">unitmap</span> <span class="o">=</span> <span class="n">StringIdMap</span><span class="p">()</span>
    <span class="n">locmap</span> <span class="o">=</span> <span class="n">StringIdMap</span><span class="p">()</span>
    <span class="n">swmap</span> <span class="o">=</span> <span class="n">StringIdMap</span><span class="p">()</span>

    <span class="n">unix</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;UNIx&#39;</span><span class="p">)</span>
    <span class="n">mrgn</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;MRGN&#39;</span><span class="p">)</span>
    <span class="n">swnm</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;SWNM&#39;</span><span class="p">)</span>

    <span class="c1"># Get location names</span>
    <span class="k">if</span> <span class="n">mrgn</span><span class="p">:</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mrgn</span><span class="p">)</span> <span class="o">//</span> <span class="mi">20</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">locn</span><span class="p">):</span>
            <span class="n">locstrid</span> <span class="o">=</span> <span class="n">b2i2</span><span class="p">(</span><span class="n">mrgn</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">locstr</span> <span class="o">=</span> <span class="n">strmap</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">locstrid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">locstr</span><span class="p">:</span>
                <span class="n">locmap</span><span class="o">.</span><span class="n">AddItem</span><span class="p">(</span><span class="n">locstr</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="c1"># Get unit names</span>
    <span class="k">if</span> <span class="n">unix</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">228</span><span class="p">):</span>
            <span class="n">unitstrid</span> <span class="o">=</span> <span class="n">b2i2</span><span class="p">(</span><span class="n">unix</span><span class="p">,</span> <span class="mi">3192</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">unitstr</span> <span class="o">=</span> <span class="n">strmap</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">unitstrid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">unitstr</span><span class="p">:</span>
                <span class="n">unitmap</span><span class="o">.</span><span class="n">AddItem</span><span class="p">(</span><span class="n">unitstr</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">unitstr</span> <span class="o">!=</span> <span class="n">IgnoreColor</span><span class="p">(</span><span class="n">unitstr</span><span class="p">):</span>
                    <span class="n">unitmap</span><span class="o">.</span><span class="n">AddItem</span><span class="p">(</span><span class="n">IgnoreColor</span><span class="p">(</span><span class="n">unitstr</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>

    <span class="c1"># Get switch names</span>
    <span class="k">if</span> <span class="n">swnm</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="n">switchstrid</span> <span class="o">=</span> <span class="n">b2i4</span><span class="p">(</span><span class="n">swnm</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">switchstr</span> <span class="o">=</span> <span class="n">strmap</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">switchstrid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">switchstr</span><span class="p">:</span>
                <span class="n">swmap</span><span class="o">.</span><span class="n">AddItem</span><span class="p">(</span><span class="n">switchstr</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GetLocationIndex</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">locmap</span><span class="o">.</span><span class="n">GetStringIndex</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GetStringIndex</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">strmap</span><span class="o">.</span><span class="n">GetStringIndex</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GetSwitchIndex</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">swmap</span><span class="o">.</span><span class="n">GetStringIndex</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GetUnitIndex</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unitmap</span><span class="o">.</span><span class="n">GetStringIndex</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ApplyStringMap</span><span class="p">(</span><span class="n">chkt</span><span class="p">):</span>
    <span class="n">chkt</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="s1">&#39;STR&#39;</span><span class="p">,</span> <span class="n">strmap</span><span class="o">.</span><span class="n">SaveTBL</span><span class="p">())</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\tblformat.py : 136 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">String table manager. Internally used in eudplib.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">TBL</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># datatb : table of strings                       : string data table</span>
        <span class="c1"># dataindextb : string id -&gt; data id              : string offset table</span>
        <span class="c1"># stringmap : string -&gt; representative string id</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_datatb</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stringmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># String starts from #1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Size of STR section</span>

        <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoadTBL</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">LoadTBL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datatb</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stringmap</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">stringcount</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i2</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stringcount</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stringoffset</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i2</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">send</span> <span class="o">=</span> <span class="n">stringoffset</span>
            <span class="k">while</span> <span class="n">content</span><span class="p">[</span><span class="n">send</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">send</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">string</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">stringoffset</span><span class="p">:</span><span class="n">send</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddString</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">AddString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>  <span class="c1"># Starcraft uses multibyte encoding.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Invalid type for string&#39;</span><span class="p">)</span>

        <span class="n">stringindex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="p">)</span>

        <span class="c1"># If duplicate text exist -&gt; just proxy it</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">repr_stringid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stringmap</span><span class="p">[</span><span class="n">string</span><span class="p">]</span>
            <span class="n">dataindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="p">[</span><span class="n">repr_stringid</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataindex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span> <span class="o">+=</span> <span class="mi">2</span>  <span class="c1"># just string offset</span>

        <span class="c1"># Else -&gt; Create new entry</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">dataindex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datatb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stringmap</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="n">stringindex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datatb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataindex</span><span class="p">)</span>
            <span class="c1"># string + b&#39;\0&#39; + string offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_capacity</span> <span class="o">&lt;</span> <span class="mi">65536</span><span class="p">,</span> <span class="s1">&#39;String table overflow&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stringindex</span>

    <span class="k">def</span> <span class="nf">GetString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatb</span><span class="p">[</span><span class="n">dataindex</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">GetStringIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Invalid type for string&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stringmap</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AddString</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">SaveTBL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outbytes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># calculate offset of each string</span>
        <span class="n">stroffset</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">outindex</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatb</span><span class="p">:</span>
            <span class="n">stroffset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outindex</span><span class="p">)</span>
            <span class="n">outindex</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># String count</span>
        <span class="n">outbytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">i2b2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="p">)))</span>

        <span class="c1"># String offsets</span>
        <span class="k">for</span> <span class="n">dataidx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataindextb</span><span class="p">:</span>
            <span class="n">outbytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">i2b2</span><span class="p">(</span><span class="n">stroffset</span><span class="p">[</span><span class="n">dataidx</span><span class="p">]))</span>

        <span class="c1"># String data</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatb</span><span class="p">:</span>
            <span class="n">outbytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">outbytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outbytes</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\unitprp.py : 144 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">UnitProperty</span><span class="p">(</span><span class="n">LittleEndianStructure</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    UnitProperty class. Used in &#39;Create Unit with Properties&#39; action.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;sprpvalid&#39;</span><span class="p">,</span> <span class="n">c_ushort</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;prpvalid&#39;</span><span class="p">,</span> <span class="n">c_ushort</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;player&#39;</span><span class="p">,</span> <span class="n">c_byte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;hitpoint&#39;</span><span class="p">,</span> <span class="n">c_byte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;shield&#39;</span><span class="p">,</span> <span class="n">c_byte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">c_byte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="n">c_uint</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;hanger&#39;</span><span class="p">,</span> <span class="n">c_ushort</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;sprpflag&#39;</span><span class="p">,</span> <span class="n">c_ushort</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;unused&#39;</span><span class="p">,</span> <span class="n">c_uint</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">hitpoint</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">shield</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">energy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">resource</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">hanger</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">cloaked</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">burrowed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">intransit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">hallucinated</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">invincible</span><span class="o">=</span><span class="bp">None</span>
    <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Properties : Value/None (Don&#39;t care)</span>

<span class="sd">        - hitpoint : 0~100(%)  if) When unit&#39;s hitpoint is greater than 167772,</span>
<span class="sd">        - shield   : 0~100(%)   you should give hitpoint None to make 100%% HP.</span>
<span class="sd">        - energy   : 0~100(%)</span>
<span class="sd">        - resource : 0~4294967295</span>
<span class="sd">        - hanger   : 0~65536 (Count)</span>

<span class="sd">        Special properties : True(Enabled)/False(Disabled)/None(Don&#39;t care)</span>

<span class="sd">        - clocked      : Unit is clocked.</span>
<span class="sd">        - burrowed     : Unit is burrowed.</span>
<span class="sd">        - intransit    : Unit is lifted. (In transit)</span>
<span class="sd">        - hallucinated : Unit is hallucination.</span>
<span class="sd">        - invincible   : Unit is invincible.</span>

<span class="sd">        &gt;&gt;&gt; UnitProperty(hitpoint = 50, burrowed = True) # HP 50%, burrowed</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">hitpoint</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">hitpoint</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">shield</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">shield</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">energy</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">energy</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">resource</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">resource</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">hanger</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">hanger</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">)</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">cloaked</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">burrowed</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">intransit</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">hallucinated</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">invincible</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">prop2int</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p</span>

        <span class="k">def</span> <span class="nf">prop2valid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span>

        <span class="k">def</span> <span class="nf">prop2flag</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Set properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hitpoint</span> <span class="o">=</span> <span class="n">prop2int</span><span class="p">(</span><span class="n">hitpoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shield</span> <span class="o">=</span> <span class="n">prop2int</span><span class="p">(</span><span class="n">shield</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">prop2int</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">prop2int</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hanger</span> <span class="o">=</span> <span class="n">prop2int</span><span class="p">(</span><span class="n">hanger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prpvalid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">hitpoint</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">shield</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">hanger</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Set special properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sprpvalid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">cloaked</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">burrowed</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">intransit</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">hallucinated</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2valid</span><span class="p">(</span><span class="n">invincible</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sprpflag</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">prop2flag</span><span class="p">(</span><span class="n">cloaked</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2flag</span><span class="p">(</span><span class="n">burrowed</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2flag</span><span class="p">(</span><span class="n">intransit</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2flag</span><span class="p">(</span><span class="n">hallucinated</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
            <span class="n">prop2flag</span><span class="p">(</span><span class="n">invincible</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\mapdata\__init__.py : 38 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.stringmap</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GetLocationIndex</span><span class="p">,</span>
    <span class="n">GetStringIndex</span><span class="p">,</span>
    <span class="n">GetSwitchIndex</span><span class="p">,</span>
    <span class="n">GetUnitIndex</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.proptable</span> <span class="kn">import</span> <span class="n">GetPropertyIndex</span>
<span class="kn">from</span> <span class="nn">.unitprp</span> <span class="kn">import</span> <span class="n">UnitProperty</span>
<span class="kn">from</span> <span class="nn">.mapdata</span> <span class="kn">import</span> <span class="n">IsMapdataInitalized</span>
<span class="kn">from</span> <span class="nn">.tblformat</span> <span class="kn">import</span> <span class="n">TBL</span>

<span class="kn">from</span> <span class="nn">.playerinfo</span> <span class="kn">import</span> <span class="n">GetPlayerInfo</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\action.py : 154 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="n">ConstExpr</span><span class="p">,</span> <span class="n">Evaluate</span><span class="p">,</span> <span class="n">IsConstExpr</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">Action</span><span class="p">(</span><span class="n">ConstExpr</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Action class.</span>

<span class="sd">    Memory layout.</span>

<span class="sd">     ======  ============= ========  ==========</span>
<span class="sd">     Offset  Field Name    Position  EPD Player</span>
<span class="sd">     ======  ============= ========  ==========</span>
<span class="sd">       +00   locid1         dword0   EPD(act)+0</span>
<span class="sd">       +04   strid          dword1   EPD(act)+1</span>
<span class="sd">       +08   wavid          dword2   EPD(act)+2</span>
<span class="sd">       +0C   time           dword3   EPD(act)+3</span>
<span class="sd">       +10   player1        dword4   EPD(act)+4</span>
<span class="sd">       +14   player2        dword5   EPD(act)+5</span>
<span class="sd">       +18   unitid         dword6   EPD(act)+6</span>
<span class="sd">       +1A   acttype</span>
<span class="sd">       +1B   amount</span>
<span class="sd">       +1C   flags          dword7   EPD(act)+7</span>
<span class="sd">       +1D   internal[3</span>
<span class="sd">     ======  ============= ========  ==========</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locid1</span><span class="p">,</span> <span class="n">strid</span><span class="p">,</span> <span class="n">wavid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">player1</span><span class="p">,</span> <span class="n">player2</span><span class="p">,</span>
                 <span class="n">unitid</span><span class="p">,</span> <span class="n">acttype</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        See :mod:`eudplib.base.stocktrg` for stock actions list.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locid1</span> <span class="o">=</span> <span class="n">locid1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strid</span> <span class="o">=</span> <span class="n">strid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavid</span> <span class="o">=</span> <span class="n">wavid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player1</span> <span class="o">=</span> <span class="n">player1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player2</span> <span class="o">=</span> <span class="n">player2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span> <span class="o">=</span> <span class="n">unitid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acttype</span> <span class="o">=</span> <span class="n">acttype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actindex</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">Disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="mi">2</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">CheckArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locid1</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locid1</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">locid1</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strid</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">strid</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavid</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavid</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player1</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player1</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">player1</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player2</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player2</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">player2</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitid</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acttype</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acttype</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">acttype</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">SetParentTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trg</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s1">&#39;Actions cannot be shared by two triggers.&#39;</span>
        <span class="p">)</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">trg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Trigger should not be null.&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;Triggers out of range&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span> <span class="o">=</span> <span class="n">trg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actindex</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">actindex</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pbuffer</span><span class="p">):</span>
        <span class="n">pbuffer</span><span class="o">.</span><span class="n">WritePack</span><span class="p">(</span>
            <span class="s1">&#39;IIIIIIHBBBBH&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locid1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acttype</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">0</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\condition.py : 137 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="n">ConstExpr</span><span class="p">,</span> <span class="n">Evaluate</span><span class="p">,</span> <span class="n">IsConstExpr</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">Condition</span><span class="p">(</span><span class="n">ConstExpr</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Condition class.</span>

<span class="sd">    Memory layout:</span>

<span class="sd">     ======  =============  ========  ===========</span>
<span class="sd">     Offset  Field name     Position  EPD Player</span>
<span class="sd">     ======  =============  ========  ===========</span>
<span class="sd">       +00   locid           dword0   EPD(cond)+0</span>
<span class="sd">       +04   player          dword1   EPD(cond)+1</span>
<span class="sd">       +08   amount          dword2   EPD(cond)+2</span>
<span class="sd">       +0C   unitid          dword3   EPD(cond)+3</span>
<span class="sd">       +0E   comparison</span>
<span class="sd">       +0F   condtype</span>
<span class="sd">       +10   restype         dword4   EPD(cond)+4</span>
<span class="sd">       +11   flags</span>
<span class="sd">       +12   internal[2]</span>
<span class="sd">     ======  =============  ========  ===========</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locid</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unitid</span><span class="p">,</span>
                 <span class="n">comparison</span><span class="p">,</span> <span class="n">condtype</span><span class="p">,</span> <span class="n">restype</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locid</span> <span class="o">=</span> <span class="n">locid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span> <span class="o">=</span> <span class="n">unitid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condtype</span> <span class="o">=</span> <span class="n">condtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">restype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condindex</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">Disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="mi">2</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">CheckArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locid</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">locid</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitid</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comparison</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">condtype</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condtype</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">condtype</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restype</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restype</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">restype</span>
        <span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">),</span>
            <span class="s1">&#39;Invalid arg </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">SetParentTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trg</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s1">&#39;Condition cannot be shared by two triggers. &#39;</span>
        <span class="p">)</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">trg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Trigger should not be null.&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;WTF&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span> <span class="o">=</span> <span class="n">trg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condindex</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;Orphan condition&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parenttrg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">condindex</span> <span class="o">*</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pbuffer</span><span class="p">):</span>
        <span class="n">pbuffer</span><span class="o">.</span><span class="n">WritePack</span><span class="p">(</span>
            <span class="s1">&#39;IIIHBBBBH&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unitid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">condtype</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restype</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
            <span class="mi">0</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\constenc.py : 350 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..mapdata</span> <span class="kn">import</span> <span class="n">GetPropertyIndex</span>


<span class="k">class</span> <span class="nc">_Unique</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_KillsSpecialized</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internalf</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>


<span class="n">All</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Enemy</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Ally</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">AlliedVictory</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">AtLeast</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">AtMost</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Exactly</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">SetTo</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Add</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Subtract</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Move</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Patrol</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Attack</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P1</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P2</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P3</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P4</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P5</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P6</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P7</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P8</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P9</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P10</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P11</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">P12</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player1</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player2</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player3</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player4</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player5</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player6</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player7</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player8</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player9</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player10</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player11</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Player12</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">CurrentPlayer</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Foes</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Allies</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">NeutralPlayers</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">AllPlayers</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Force1</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Force2</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Force3</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Force4</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">NonAlliedVictoryPlayers</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Enable</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Disable</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Toggle</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Ore</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Gas</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">OreAndGas</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Total</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Units</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Buildings</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">UnitsAndBuildings</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>

<span class="c1"># Name &#39;Kills&#39; is used for both condition type and score type.</span>
<span class="c1"># To resolve conflict, we initialize Kills differently from others.</span>
<span class="n">Kills</span> <span class="o">=</span> <span class="n">_KillsSpecialized</span><span class="p">()</span>
<span class="n">Razings</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">KillsAndRazings</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Custom</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Set</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Clear</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Random</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>
<span class="n">Cleared</span> <span class="o">=</span> <span class="n">_Unique</span><span class="p">()</span>

<span class="n">AllyStatusDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Enemy</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Ally</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">AlliedVictory</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ComparisonDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">AtLeast</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">AtMost</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">Exactly</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ModifierDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">SetTo</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">Add</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">Subtract</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">OrderDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Move</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Patrol</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">Attack</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">PlayerDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">P1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">P2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">P3</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">P4</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">P5</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">P6</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">P7</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">P8</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">P9</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">P10</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="n">P11</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">P12</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="n">Player1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Player2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">Player3</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">Player4</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">Player5</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">Player6</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">Player7</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">Player8</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">Player9</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">Player10</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="n">Player11</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">Player12</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="n">CurrentPlayer</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="n">Foes</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="n">Allies</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">NeutralPlayers</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="n">AllPlayers</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
    <span class="n">Force1</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="n">Force2</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
    <span class="n">Force3</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">Force4</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
    <span class="n">NonAlliedVictoryPlayers</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">PropStateDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Enable</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">Disable</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">Toggle</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ResourceDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Ore</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Gas</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">OreAndGas</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ScoreDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Total</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Units</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">Buildings</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">UnitsAndBuildings</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">Kills</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">Razings</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">KillsAndRazings</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">Custom</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">SwitchActionDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Set</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">Clear</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">Toggle</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">Random</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">SwitchStateDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Set</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">Cleared</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">_EncodeConst</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># unhashable type</span>
        <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">EncodeAllyStatus</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [Enemy, Ally, AlliedVictory] to number [0, 1, 2].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">AllyStatusDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeComparison</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [AtLeast, AtMost, Exactly] to number [0, 1, 10].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">ComparisonDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeModifier</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [SetTo, Add, Subtract] to number [7, 8, 9].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">ModifierDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeOrder</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [Move, Patrol, Attack] to number [0, 1, 2].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">OrderDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodePlayer</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert player identifier to corresponding number.</span>

<span class="sd">    ======================= ========</span>
<span class="sd">        Identifier           Number</span>
<span class="sd">    ======================= ========</span>
<span class="sd">    P1                         0</span>
<span class="sd">    P2                         1</span>
<span class="sd">    P3                         2</span>
<span class="sd">    P4                         3</span>
<span class="sd">    P5                         4</span>
<span class="sd">    P6                         5</span>
<span class="sd">    P7                         6</span>
<span class="sd">    P8                         7</span>
<span class="sd">    P9                         8</span>
<span class="sd">    P10                        9</span>
<span class="sd">    P11                        10</span>
<span class="sd">    P12                        11</span>
<span class="sd">    Player1                    0</span>
<span class="sd">    Player2                    1</span>
<span class="sd">    Player3                    2</span>
<span class="sd">    Player4                    3</span>
<span class="sd">    Player5                    4</span>
<span class="sd">    Player6                    5</span>
<span class="sd">    Player7                    6</span>
<span class="sd">    Player8                    7</span>
<span class="sd">    Player9                    8</span>
<span class="sd">    Player10                   9</span>
<span class="sd">    Player11                   10</span>
<span class="sd">    Player12                   11</span>
<span class="sd">    CurrentPlayer              13</span>
<span class="sd">    Foes                       14</span>
<span class="sd">    Allies                     15</span>
<span class="sd">    NeutralPlayers             16</span>
<span class="sd">    AllPlayers                 17</span>
<span class="sd">    Force1                     18</span>
<span class="sd">    Force2                     19</span>
<span class="sd">    Force3                     20</span>
<span class="sd">    Force4                     21</span>
<span class="sd">    NonAlliedVictoryPlayers    26</span>
<span class="sd">    ======================= ========</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">PlayerDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodePropState</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [Enable, Disable, Toogle] to number [4, 5, 6]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">PropStateDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeResource</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [Ore, Gas, OreAndGas] to [0, 1, 2]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">ResourceDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeScore</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert score type identifier to number.</span>

<span class="sd">    ================= ========</span>
<span class="sd">        Score type     Number</span>
<span class="sd">    ================= ========</span>
<span class="sd">    Total                0</span>
<span class="sd">    Units                1</span>
<span class="sd">    Buildings            2</span>
<span class="sd">    UnitsAndBuildings    3</span>
<span class="sd">    Kills                4</span>
<span class="sd">    Razings              5</span>
<span class="sd">    KillsAndRazings      6</span>
<span class="sd">    Custom               7</span>
<span class="sd">    ================= ========</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">ScoreDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeSwitchAction</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [Set, Clear, Toogle, Random] to [4, 5, 6, 11].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">SwitchActionDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeSwitchState</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [Set, Cleared] to [2, 3].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_EncodeConst</span><span class="p">(</span><span class="n">SwitchStateDict</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeCount</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert [All, (other numbers)] to number [0, (as-is)].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="n">All</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>


<span class="c1"># ========================</span>


<span class="k">def</span> <span class="nf">EncodeProperty</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">GetPropertyIndex</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\rawtriggerdef.py : 159 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..eudobj</span> <span class="kn">import</span> <span class="n">EUDObject</span>
<span class="kn">from</span> <span class="nn">.triggerscope</span> <span class="kn">import</span> <span class="n">NextTrigger</span><span class="p">,</span> <span class="n">_RegisterTrigger</span>
<span class="kn">from</span> <span class="nn">.condition</span> <span class="kn">import</span> <span class="n">Condition</span>
<span class="kn">from</span> <span class="nn">.action</span> <span class="kn">import</span> <span class="n">Action</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="c1"># Trigger counter thing</span>

<span class="n">_trgCounter</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">GetTriggerCounter</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_trgCounter</span>


<span class="c1"># Aux</span>

<span class="k">def</span> <span class="nf">_bool2Cond</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Always</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Never</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">Disabled</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Disable condition or action&quot;&quot;&quot;</span>
    <span class="n">arg</span><span class="o">.</span><span class="n">Disabled</span><span class="p">()</span>


<span class="c1"># RawTrigger</span>

<span class="k">class</span> <span class="nc">RawTrigger</span><span class="p">(</span><span class="n">EUDObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">prevptr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">conditions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">preserved</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="k">global</span> <span class="n">_trgCounter</span>
        <span class="n">_trgCounter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">_RegisterTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># This should be called before (1)</span>

        <span class="k">if</span> <span class="n">prevptr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prevptr</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">nextptr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nextptr</span> <span class="o">=</span> <span class="n">NextTrigger</span><span class="p">()</span>  <span class="c1"># (1)</span>

        <span class="k">if</span> <span class="n">conditions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">actions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">conditions</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;Too many conditions&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;Too many actions&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">preserved</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="s1">&#39;preserved should be bool&#39;</span><span class="p">)</span>

        <span class="n">conditions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_bool2Cond</span><span class="p">,</span> <span class="n">conditions</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prevptr</span> <span class="o">=</span> <span class="n">prevptr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nextptr</span> <span class="o">=</span> <span class="n">nextptr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conditions</span> <span class="o">=</span> <span class="n">conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="n">actions</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cond</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conditions</span><span class="p">):</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">Condition</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cond</span><span class="o">.</span><span class="n">CheckArgs</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Error on condition </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">raise</span>

            <span class="n">cond</span><span class="o">.</span><span class="n">SetParentTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">act</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">):</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">Action</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">act</span><span class="o">.</span><span class="n">CheckArgs</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Error on action </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">raise</span>

            <span class="n">act</span><span class="o">.</span><span class="n">SetParentTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">preserved</span> <span class="o">=</span> <span class="n">preserved</span>

    <span class="k">def</span> <span class="nf">GetNextPtrMemory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2408</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pbuffer</span><span class="p">):</span>
        <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prevptr</span><span class="p">)</span>
        <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nextptr</span><span class="p">)</span>

        <span class="c1"># Conditions</span>
        <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conditions</span><span class="p">:</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">WritePayload</span><span class="p">(</span><span class="n">pbuffer</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conditions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
            <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteSpace</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">15</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conditions</span><span class="p">)))</span>

        <span class="c1"># Actions</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="n">act</span><span class="o">.</span><span class="n">WritePayload</span><span class="p">(</span><span class="n">pbuffer</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conditions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">64</span><span class="p">:</span>
            <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
            <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteSpace</span><span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="p">(</span><span class="mi">63</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">)))</span>

        <span class="c1"># Preserved flag</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preserved</span><span class="p">:</span>
            <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteSpace</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>
        <span class="n">pbuffer</span><span class="o">.</span><span class="n">WriteByte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\stockact.py : 411 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.action</span> <span class="kn">import</span> <span class="n">Action</span>
<span class="kn">from</span> <span class="nn">.constenc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EncodeAllyStatus</span><span class="p">,</span>
    <span class="n">EncodeCount</span><span class="p">,</span>
    <span class="n">EncodeModifier</span><span class="p">,</span>
    <span class="n">EncodeOrder</span><span class="p">,</span>
    <span class="n">EncodePlayer</span><span class="p">,</span>
    <span class="n">EncodeProperty</span><span class="p">,</span>
    <span class="n">EncodePropState</span><span class="p">,</span>
    <span class="n">EncodeResource</span><span class="p">,</span>
    <span class="n">EncodeScore</span><span class="p">,</span>
    <span class="n">EncodeSwitchAction</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.strenc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EncodeAIScript</span><span class="p">,</span>
    <span class="n">EncodeLocation</span><span class="p">,</span>
    <span class="n">EncodeString</span><span class="p">,</span>
    <span class="n">EncodeSwitch</span><span class="p">,</span>
    <span class="n">EncodeUnit</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="n">EPD</span>


<span class="k">def</span> <span class="nf">Victory</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Defeat</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">PreserveTrigger</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Wait</span><span class="p">(</span><span class="n">Time</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;[Warning] Don&#39;t use Wait action UNLESS YOU KNOW WHAT YOU&#39;RE DOING!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">PauseGame</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">UnpauseGame</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Transmission</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">WAVName</span><span class="p">,</span> <span class="n">TimeModifier</span><span class="p">,</span>
                 <span class="n">Time</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">AlwaysDisplay</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="n">WAVName</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">WAVName</span><span class="p">)</span>
    <span class="n">TimeModifier</span> <span class="o">=</span> <span class="n">EncodeModifier</span><span class="p">(</span><span class="n">TimeModifier</span><span class="p">)</span>
    <span class="n">Text</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">WAVName</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">Unit</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">TimeModifier</span><span class="p">,</span> <span class="n">AlwaysDisplay</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">PlayWAV</span><span class="p">(</span><span class="n">WAVName</span><span class="p">):</span>
    <span class="n">WAVName</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">WAVName</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">WAVName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">DisplayText</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">AlwaysDisplay</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">Text</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AlwaysDisplay</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CenterView</span><span class="p">(</span><span class="n">Where</span><span class="p">):</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CreateUnitWithProperties</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Properties</span> <span class="o">=</span> <span class="n">EncodeProperty</span><span class="p">(</span><span class="n">Properties</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Properties</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetMissionObjectives</span><span class="p">(</span><span class="n">Text</span><span class="p">):</span>
    <span class="n">Text</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetSwitch</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">EncodeSwitch</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    <span class="n">State</span> <span class="o">=</span> <span class="n">EncodeSwitchAction</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Switch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetCountdownTimer</span><span class="p">(</span><span class="n">TimeModifier</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
    <span class="n">TimeModifier</span> <span class="o">=</span> <span class="n">EncodeModifier</span><span class="p">(</span><span class="n">TimeModifier</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">TimeModifier</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">RunAIScript</span><span class="p">(</span><span class="n">Script</span><span class="p">):</span>
    <span class="n">Script</span> <span class="o">=</span> <span class="n">EncodeAIScript</span><span class="p">(</span><span class="n">Script</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Script</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">RunAIScriptAt</span><span class="p">(</span><span class="n">Script</span><span class="p">,</span> <span class="n">Where</span><span class="p">):</span>
    <span class="n">Script</span> <span class="o">=</span> <span class="n">EncodeAIScript</span><span class="p">(</span><span class="n">Script</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Script</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardControl</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardControlAt</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardResources</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">ResourceType</span> <span class="o">=</span> <span class="n">EncodeResource</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardKills</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">ScoreType</span> <span class="o">=</span> <span class="n">EncodeScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">KillUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Player</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">KillUnitAt</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">ForPlayer</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="n">ForPlayer</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">ForPlayer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ForPlayer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">RemoveUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Player</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">RemoveUnitAt</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">ForPlayer</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="n">ForPlayer</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">ForPlayer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ForPlayer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetResources</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">,</span> <span class="n">Amount</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Modifier</span> <span class="o">=</span> <span class="n">EncodeModifier</span><span class="p">(</span><span class="n">Modifier</span><span class="p">)</span>
    <span class="n">ResourceType</span> <span class="o">=</span> <span class="n">EncodeResource</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Amount</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetScore</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">,</span> <span class="n">Amount</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Modifier</span> <span class="o">=</span> <span class="n">EncodeModifier</span><span class="p">(</span><span class="n">Modifier</span><span class="p">)</span>
    <span class="n">ScoreType</span> <span class="o">=</span> <span class="n">EncodeScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Amount</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MinimapPing</span><span class="p">(</span><span class="n">Where</span><span class="p">):</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">TalkingPortrait</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MuteUnitSpeech</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">UnMuteUnitSpeech</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardComputerPlayers</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
    <span class="n">State</span> <span class="o">=</span> <span class="n">EncodePropState</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardGoalControl</span><span class="p">(</span><span class="n">Goal</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Goal</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardGoalControlAt</span><span class="p">(</span><span class="n">Goal</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Goal</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardGoalResources</span><span class="p">(</span><span class="n">Goal</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">ResourceType</span> <span class="o">=</span> <span class="n">EncodeResource</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Goal</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardGoalKills</span><span class="p">(</span><span class="n">Goal</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Goal</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardGoalScore</span><span class="p">(</span><span class="n">Goal</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="n">Label</span><span class="p">):</span>
    <span class="n">ScoreType</span> <span class="o">=</span> <span class="n">EncodeScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">)</span>
    <span class="n">Label</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Goal</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MoveLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span> <span class="n">OnUnit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">DestLocation</span><span class="p">):</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">)</span>
    <span class="n">OnUnit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">OnUnit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">DestLocation</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">DestLocation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">DestLocation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">OnUnit</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MoveUnit</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">UnitType</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">StartLocation</span><span class="p">,</span> <span class="n">DestLocation</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">UnitType</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">UnitType</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">StartLocation</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">StartLocation</span><span class="p">)</span>
    <span class="n">DestLocation</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">DestLocation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">StartLocation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">DestLocation</span><span class="p">,</span>
                  <span class="n">UnitType</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeaderBoardGreed</span><span class="p">(</span><span class="n">Goal</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Goal</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetNextScenario</span><span class="p">(</span><span class="n">ScenarioName</span><span class="p">):</span>
    <span class="n">ScenarioName</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">ScenarioName</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ScenarioName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetDoodadState</span><span class="p">(</span><span class="n">State</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">):</span>
    <span class="n">State</span> <span class="o">=</span> <span class="n">EncodePropState</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetInvincibility</span><span class="p">(</span><span class="n">State</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">):</span>
    <span class="n">State</span> <span class="o">=</span> <span class="n">EncodePropState</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CreateUnit</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">ForPlayer</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="n">ForPlayer</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">ForPlayer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ForPlayer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetDeaths</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Modifier</span> <span class="o">=</span> <span class="n">EncodeModifier</span><span class="p">(</span><span class="n">Modifier</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="n">Modifier</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Order</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">StartLocation</span><span class="p">,</span> <span class="n">OrderType</span><span class="p">,</span> <span class="n">DestLocation</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">StartLocation</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">StartLocation</span><span class="p">)</span>
    <span class="n">OrderType</span> <span class="o">=</span> <span class="n">EncodeOrder</span><span class="p">(</span><span class="n">OrderType</span><span class="p">)</span>
    <span class="n">DestLocation</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">DestLocation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">StartLocation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">DestLocation</span><span class="p">,</span>
                  <span class="n">Unit</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="n">OrderType</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Comment</span><span class="p">(</span><span class="n">Text</span><span class="p">):</span>
    <span class="n">Text</span> <span class="o">=</span> <span class="n">EncodeString</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GiveUnits</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">NewOwner</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="n">NewOwner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">NewOwner</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">NewOwner</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ModifyUnitHitPoints</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">Percent</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Percent</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ModifyUnitEnergy</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">Percent</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Percent</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ModifyUnitShields</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">Percent</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Percent</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ModifyUnitResourceAmount</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">,</span> <span class="n">NewValue</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">NewValue</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ModifyUnitHangarCount</span><span class="p">(</span><span class="n">Add</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Where</span><span class="p">):</span>
    <span class="n">Count</span> <span class="o">=</span> <span class="n">EncodeCount</span><span class="p">(</span><span class="n">Count</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Owner</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Owner</span><span class="p">)</span>
    <span class="n">Where</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Where</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">Where</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">PauseTimer</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">UnpauseTimer</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Draw</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetAllianceStatus</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Status</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Status</span> <span class="o">=</span> <span class="n">EncodeAllyStatus</span><span class="p">(</span><span class="n">Status</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Status</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetMemory</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">modtype</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SetDeaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">dest</span><span class="p">),</span> <span class="n">modtype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetMemoryEPD</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">modtype</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SetDeaths</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">modtype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetNextPtr</span><span class="p">(</span><span class="n">trg</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SetMemory</span><span class="p">(</span><span class="n">trg</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\stockcond.py : 200 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.condition</span> <span class="kn">import</span> <span class="n">Condition</span>
<span class="kn">from</span> <span class="nn">.constenc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EncodeComparison</span><span class="p">,</span>
    <span class="n">EncodePlayer</span><span class="p">,</span>
    <span class="n">EncodeResource</span><span class="p">,</span>
    <span class="n">EncodeScore</span><span class="p">,</span>
    <span class="n">EncodeSwitchState</span><span class="p">,</span>
    <span class="n">Kills</span>  <span class="c1"># for __calls__ binding</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.strenc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EncodeLocation</span><span class="p">,</span>
    <span class="n">EncodeSwitch</span><span class="p">,</span>
    <span class="n">EncodeUnit</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="n">EPD</span>


<span class="k">def</span> <span class="nf">CountdownTimer</span><span class="p">(</span><span class="n">Comparison</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks countdown timer.</span>

<span class="sd">    Example::</span>

<span class="sd">        CountdownTimer(AtLeast, 10)</span>

<span class="sd">    Memory Layout::</span>

<span class="sd">        0000 0000 0000 0000 TTTT TTTT 0000 CP01 0000</span>

<span class="sd">        T : Time, CP : Comparison.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Command</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;[Player] commands [Comparison] [Number] [Unit].</span>

<span class="sd">    Example::</span>
<span class="sd">        Command(Player1, AtLeast, 30, &quot;Terran Marine&quot;)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Bring</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Location</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Accumulate</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="n">ResourceType</span> <span class="o">=</span> <span class="n">EncodeResource</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1"># &#39;Kills&#39; is already defined inside constenc, so we just add __call__ method</span>
<span class="c1"># to there instead of creating new function</span>
<span class="k">def</span> <span class="nf">__Kills__internal</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="n">Kills</span><span class="o">.</span><span class="n">_internalf</span> <span class="o">=</span> <span class="n">__Kills__internal</span>


<span class="k">def</span> <span class="nf">CommandMost</span><span class="p">(</span><span class="n">Unit</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CommandMostAt</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Location</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MostKills</span><span class="p">(</span><span class="n">Unit</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">HighestScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">):</span>
    <span class="n">ScoreType</span> <span class="o">=</span> <span class="n">EncodeScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MostResources</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">):</span>
    <span class="n">ResourceType</span> <span class="o">=</span> <span class="n">EncodeResource</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Switch</span><span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">Switch</span> <span class="o">=</span> <span class="n">EncodeSwitch</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
    <span class="n">State</span> <span class="o">=</span> <span class="n">EncodeSwitchState</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">Switch</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ElapsedTime</span><span class="p">(</span><span class="n">Comparison</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Opponents</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Deaths</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CommandLeast</span><span class="p">(</span><span class="n">Unit</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CommandLeastAt</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Location</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="n">EncodeLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeastKills</span><span class="p">(</span><span class="n">Unit</span><span class="p">):</span>
    <span class="n">Unit</span> <span class="o">=</span> <span class="n">EncodeUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LowestScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">):</span>
    <span class="n">ScoreType</span> <span class="o">=</span> <span class="n">EncodeScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">LeastResources</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">):</span>
    <span class="n">ResourceType</span> <span class="o">=</span> <span class="n">EncodeResource</span><span class="p">(</span><span class="n">ResourceType</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">ResourceType</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Score</span><span class="p">(</span><span class="n">Player</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
    <span class="n">Player</span> <span class="o">=</span> <span class="n">EncodePlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="n">ScoreType</span> <span class="o">=</span> <span class="n">EncodeScore</span><span class="p">(</span><span class="n">ScoreType</span><span class="p">)</span>
    <span class="n">Comparison</span> <span class="o">=</span> <span class="n">EncodeComparison</span><span class="p">(</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Comparison</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">ScoreType</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Always</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Never</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Memory</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">cmptype</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Deaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">dest</span><span class="p">),</span> <span class="n">cmptype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MemoryEPD</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">cmptype</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Deaths</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">cmptype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\strdict.py : 574 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">DefLocationDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">({</span><span class="s2">&quot;Location </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">)}</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span>
    <span class="p">[(</span><span class="s1">&#39;Anywhere&#39;</span><span class="p">,</span> <span class="mi">63</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">DefSwitchDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Switch </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">)}</span>

<span class="c1"># ======================================</span>

<span class="n">DefUnitDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Terran Marine&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;Terran Ghost&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;Terran Vulture&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;Terran Goliath&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;Goliath Turret&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;Terran Siege Tank (Tank Mode)&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;Siege Tank Turret (Tank Mode)&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;Terran SCV&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s2">&quot;Terran Wraith&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s2">&quot;Terran Science Vessel&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s2">&quot;Gui Montag (Firebat)&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;Terran Dropship&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;Terran Battlecruiser&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s2">&quot;Spider Mine&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="s2">&quot;Nuclear Missile&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="s2">&quot;Terran Civilian&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;Sarah Kerrigan (Ghost)&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s2">&quot;Alan Schezar (Goliath)&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
    <span class="s2">&quot;Alan Schezar Turret&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="s2">&quot;Jim Raynor (Vulture)&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
    <span class="s2">&quot;Jim Raynor (Marine)&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;Tom Kazansky (Wraith)&quot;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
    <span class="s2">&quot;Magellan (Science Vessel)&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
    <span class="s2">&quot;Edmund Duke (Tank Mode)&quot;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
    <span class="s2">&quot;Edmund Duke Turret (Tank Mode)&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
    <span class="s2">&quot;Edmund Duke (Siege Mode)&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s2">&quot;Edmund Duke Turret (Siege Mode)&quot;</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span>
    <span class="s2">&quot;Arcturus Mengsk (Battlecruiser)&quot;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span>
    <span class="s2">&quot;Hyperion (Battlecruiser)&quot;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
    <span class="s2">&quot;Norad II (Battlecruiser)&quot;</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span>
    <span class="s2">&quot;Terran Siege Tank (Siege Mode)&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;Siege Tank Turret (Siege Mode)&quot;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
    <span class="s2">&quot;Terran Firebat&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
    <span class="s2">&quot;Scanner Sweep&quot;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
    <span class="s2">&quot;Terran Medic&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Larva&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Egg&quot;</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Zergling&quot;</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Hydralisk&quot;</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Ultralisk&quot;</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Broodling&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Drone&quot;</span><span class="p">:</span> <span class="mi">41</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Overlord&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Mutalisk&quot;</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Guardian&quot;</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Queen&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Defiler&quot;</span><span class="p">:</span> <span class="mi">46</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Scourge&quot;</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span>
    <span class="s2">&quot;Torrasque (Ultralisk)&quot;</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
    <span class="s2">&quot;Matriarch (Queen)&quot;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
    <span class="s2">&quot;Infested Terran&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;Infested Kerrigan (Infested Terran)&quot;</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span>
    <span class="s2">&quot;Unclean One (Defiler)&quot;</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span>
    <span class="s2">&quot;Hunter Killer (Hydralisk)&quot;</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span>
    <span class="s2">&quot;Devouring One (Zergling)&quot;</span><span class="p">:</span> <span class="mi">54</span><span class="p">,</span>
    <span class="s2">&quot;Kukulza (Mutalisk)&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
    <span class="s2">&quot;Kukulza (Guardian)&quot;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
    <span class="s2">&quot;Yggdrasill (Overlord)&quot;</span><span class="p">:</span> <span class="mi">57</span><span class="p">,</span>
    <span class="s2">&quot;Terran Valkyrie&quot;</span><span class="p">:</span> <span class="mi">58</span><span class="p">,</span>
    <span class="s2">&quot;Mutalisk Cocoon&quot;</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Corsair&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Dark Templar (Unit)&quot;</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Devourer&quot;</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Dark Archon&quot;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Probe&quot;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Zealot&quot;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Dragoon&quot;</span><span class="p">:</span> <span class="mi">66</span><span class="p">,</span>
    <span class="s2">&quot;Protoss High Templar&quot;</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Archon&quot;</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Shuttle&quot;</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Scout&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Arbiter&quot;</span><span class="p">:</span> <span class="mi">71</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Carrier&quot;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Interceptor&quot;</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Dark Templar (Hero)&quot;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span>
    <span class="s2">&quot;Zeratul (Dark Templar)&quot;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
    <span class="s2">&quot;Tassadar/Zeratul (Archon)&quot;</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span>
    <span class="s2">&quot;Fenix (Zealot)&quot;</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span>
    <span class="s2">&quot;Fenix (Dragoon)&quot;</span><span class="p">:</span> <span class="mi">78</span><span class="p">,</span>
    <span class="s2">&quot;Tassadar (Templar)&quot;</span><span class="p">:</span> <span class="mi">79</span><span class="p">,</span>
    <span class="s2">&quot;Mojo (Scout)&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="s2">&quot;Warbringer (Reaver)&quot;</span><span class="p">:</span> <span class="mi">81</span><span class="p">,</span>
    <span class="s2">&quot;Gantrithor (Carrier)&quot;</span><span class="p">:</span> <span class="mi">82</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Reaver&quot;</span><span class="p">:</span> <span class="mi">83</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Observer&quot;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Scarab&quot;</span><span class="p">:</span> <span class="mi">85</span><span class="p">,</span>
    <span class="s2">&quot;Danimoth (Arbiter)&quot;</span><span class="p">:</span> <span class="mi">86</span><span class="p">,</span>
    <span class="s2">&quot;Aldaris (Templar)&quot;</span><span class="p">:</span> <span class="mi">87</span><span class="p">,</span>
    <span class="s2">&quot;Artanis (Scout)&quot;</span><span class="p">:</span> <span class="mi">88</span><span class="p">,</span>
    <span class="s2">&quot;Rhynadon (Badlands Critter)&quot;</span><span class="p">:</span> <span class="mi">89</span><span class="p">,</span>
    <span class="s2">&quot;Bengalaas (Jungle Critter)&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
    <span class="s2">&quot;Cargo Ship (Unused)&quot;</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span>
    <span class="s2">&quot;Mercenary Gunship (Unused)&quot;</span><span class="p">:</span> <span class="mi">92</span><span class="p">,</span>
    <span class="s2">&quot;Scantid (Desert Critter)&quot;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
    <span class="s2">&quot;Kakaru (Twilight Critter)&quot;</span><span class="p">:</span> <span class="mi">94</span><span class="p">,</span>
    <span class="s2">&quot;Ragnasaur (Ashworld Critter)&quot;</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
    <span class="s2">&quot;Ursadon (Ice World Critter)&quot;</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span>
    <span class="s2">&quot;Lurker Egg&quot;</span><span class="p">:</span> <span class="mi">97</span><span class="p">,</span>
    <span class="s2">&quot;Raszagal (Corsair)&quot;</span><span class="p">:</span> <span class="mi">98</span><span class="p">,</span>
    <span class="s2">&quot;Samir Duran (Ghost)&quot;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
    <span class="s2">&quot;Alexei Stukov (Ghost)&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;Map Revealer&quot;</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span>
    <span class="s2">&quot;Gerard DuGalle (BattleCruiser)&quot;</span><span class="p">:</span> <span class="mi">102</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Lurker&quot;</span><span class="p">:</span> <span class="mi">103</span><span class="p">,</span>
    <span class="s2">&quot;Infested Duran (Infested Terran)&quot;</span><span class="p">:</span> <span class="mi">104</span><span class="p">,</span>
    <span class="s2">&quot;Disruption Web&quot;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
    <span class="s2">&quot;Terran Command Center&quot;</span><span class="p">:</span> <span class="mi">106</span><span class="p">,</span>
    <span class="s2">&quot;Terran Comsat Station&quot;</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span>
    <span class="s2">&quot;Terran Nuclear Silo&quot;</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span>
    <span class="s2">&quot;Terran Supply Depot&quot;</span><span class="p">:</span> <span class="mi">109</span><span class="p">,</span>
    <span class="s2">&quot;Terran Refinery&quot;</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span>
    <span class="s2">&quot;Terran Barracks&quot;</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span>
    <span class="s2">&quot;Terran Academy&quot;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span>
    <span class="s2">&quot;Terran Factory&quot;</span><span class="p">:</span> <span class="mi">113</span><span class="p">,</span>
    <span class="s2">&quot;Terran Starport&quot;</span><span class="p">:</span> <span class="mi">114</span><span class="p">,</span>
    <span class="s2">&quot;Terran Control Tower&quot;</span><span class="p">:</span> <span class="mi">115</span><span class="p">,</span>
    <span class="s2">&quot;Terran Science Facility&quot;</span><span class="p">:</span> <span class="mi">116</span><span class="p">,</span>
    <span class="s2">&quot;Terran Covert Ops&quot;</span><span class="p">:</span> <span class="mi">117</span><span class="p">,</span>
    <span class="s2">&quot;Terran Physics Lab&quot;</span><span class="p">:</span> <span class="mi">118</span><span class="p">,</span>
    <span class="s2">&quot;Starbase (Unused)&quot;</span><span class="p">:</span> <span class="mi">119</span><span class="p">,</span>
    <span class="s2">&quot;Terran Machine Shop&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s2">&quot;Repair Bay (Unused)&quot;</span><span class="p">:</span> <span class="mi">121</span><span class="p">,</span>
    <span class="s2">&quot;Terran Engineering Bay&quot;</span><span class="p">:</span> <span class="mi">122</span><span class="p">,</span>
    <span class="s2">&quot;Terran Armory&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="s2">&quot;Terran Missile Turret&quot;</span><span class="p">:</span> <span class="mi">124</span><span class="p">,</span>
    <span class="s2">&quot;Terran Bunker&quot;</span><span class="p">:</span> <span class="mi">125</span><span class="p">,</span>
    <span class="s2">&quot;Norad II (Crashed)&quot;</span><span class="p">:</span> <span class="mi">126</span><span class="p">,</span>
    <span class="s2">&quot;Ion Cannon&quot;</span><span class="p">:</span> <span class="mi">127</span><span class="p">,</span>
    <span class="s2">&quot;Uraj Crystal&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
    <span class="s2">&quot;Khalis Crystal&quot;</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span>
    <span class="s2">&quot;Infested Command Center&quot;</span><span class="p">:</span> <span class="mi">130</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Hatchery&quot;</span><span class="p">:</span> <span class="mi">131</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Lair&quot;</span><span class="p">:</span> <span class="mi">132</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Hive&quot;</span><span class="p">:</span> <span class="mi">133</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Nydus Canal&quot;</span><span class="p">:</span> <span class="mi">134</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Hydralisk Den&quot;</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Defiler Mound&quot;</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Greater Spire&quot;</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Queen&#39;s Nest&quot;</span><span class="p">:</span> <span class="mi">138</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Evolution Chamber&quot;</span><span class="p">:</span> <span class="mi">139</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Ultralisk Cavern&quot;</span><span class="p">:</span> <span class="mi">140</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Spire&quot;</span><span class="p">:</span> <span class="mi">141</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Spawning Pool&quot;</span><span class="p">:</span> <span class="mi">142</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Creep Colony&quot;</span><span class="p">:</span> <span class="mi">143</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Spore Colony&quot;</span><span class="p">:</span> <span class="mi">144</span><span class="p">,</span>
    <span class="s2">&quot;Unused Zerg Building1&quot;</span><span class="p">:</span> <span class="mi">145</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Sunken Colony&quot;</span><span class="p">:</span> <span class="mi">146</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Overmind (With Shell)&quot;</span><span class="p">:</span> <span class="mi">147</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Overmind&quot;</span><span class="p">:</span> <span class="mi">148</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Extractor&quot;</span><span class="p">:</span> <span class="mi">149</span><span class="p">,</span>
    <span class="s2">&quot;Mature Chrysalis&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Cerebrate&quot;</span><span class="p">:</span> <span class="mi">151</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Cerebrate Daggoth&quot;</span><span class="p">:</span> <span class="mi">152</span><span class="p">,</span>
    <span class="s2">&quot;Unused Zerg Building2&quot;</span><span class="p">:</span> <span class="mi">153</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Nexus&quot;</span><span class="p">:</span> <span class="mi">154</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Robotics Facility&quot;</span><span class="p">:</span> <span class="mi">155</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Pylon&quot;</span><span class="p">:</span> <span class="mi">156</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Assimilator&quot;</span><span class="p">:</span> <span class="mi">157</span><span class="p">,</span>
    <span class="s2">&quot;Unused Protoss Building1&quot;</span><span class="p">:</span> <span class="mi">158</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Observatory&quot;</span><span class="p">:</span> <span class="mi">159</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Gateway&quot;</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span>
    <span class="s2">&quot;Unused Protoss Building2&quot;</span><span class="p">:</span> <span class="mi">161</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Photon Cannon&quot;</span><span class="p">:</span> <span class="mi">162</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Citadel of Adun&quot;</span><span class="p">:</span> <span class="mi">163</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Cybernetics Core&quot;</span><span class="p">:</span> <span class="mi">164</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Templar Archives&quot;</span><span class="p">:</span> <span class="mi">165</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Forge&quot;</span><span class="p">:</span> <span class="mi">166</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Stargate&quot;</span><span class="p">:</span> <span class="mi">167</span><span class="p">,</span>
    <span class="s2">&quot;Stasis Cell/Prison&quot;</span><span class="p">:</span> <span class="mi">168</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Fleet Beacon&quot;</span><span class="p">:</span> <span class="mi">169</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Arbiter Tribunal&quot;</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Robotics Support Bay&quot;</span><span class="p">:</span> <span class="mi">171</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Shield Battery&quot;</span><span class="p">:</span> <span class="mi">172</span><span class="p">,</span>
    <span class="s2">&quot;Khaydarin Crystal Formation&quot;</span><span class="p">:</span> <span class="mi">173</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Temple&quot;</span><span class="p">:</span> <span class="mi">174</span><span class="p">,</span>
    <span class="s2">&quot;Xel&#39;Naga Temple&quot;</span><span class="p">:</span> <span class="mi">175</span><span class="p">,</span>
    <span class="s2">&quot;Mineral Field (Type 1)&quot;</span><span class="p">:</span> <span class="mi">176</span><span class="p">,</span>
    <span class="s2">&quot;Mineral Field (Type 2)&quot;</span><span class="p">:</span> <span class="mi">177</span><span class="p">,</span>
    <span class="s2">&quot;Mineral Field (Type 3)&quot;</span><span class="p">:</span> <span class="mi">178</span><span class="p">,</span>
    <span class="s2">&quot;Cave (Unused)&quot;</span><span class="p">:</span> <span class="mi">179</span><span class="p">,</span>
    <span class="s2">&quot;Cave-in (Unused)&quot;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
    <span class="s2">&quot;Cantina (Unused)&quot;</span><span class="p">:</span> <span class="mi">181</span><span class="p">,</span>
    <span class="s2">&quot;Mining Platform (Unused)&quot;</span><span class="p">:</span> <span class="mi">182</span><span class="p">,</span>
    <span class="s2">&quot;Independent Command Center (Unused)&quot;</span><span class="p">:</span> <span class="mi">183</span><span class="p">,</span>
    <span class="s2">&quot;Independent Starport (Unused)&quot;</span><span class="p">:</span> <span class="mi">184</span><span class="p">,</span>
    <span class="s2">&quot;Independent Jump Gate (Unused)&quot;</span><span class="p">:</span> <span class="mi">185</span><span class="p">,</span>
    <span class="s2">&quot;Ruins (Unused)&quot;</span><span class="p">:</span> <span class="mi">186</span><span class="p">,</span>
    <span class="s2">&quot;Khaydarin Crystal Formation (Unused)&quot;</span><span class="p">:</span> <span class="mi">187</span><span class="p">,</span>
    <span class="s2">&quot;Vespene Geyser&quot;</span><span class="p">:</span> <span class="mi">188</span><span class="p">,</span>
    <span class="s2">&quot;Warp Gate&quot;</span><span class="p">:</span> <span class="mi">189</span><span class="p">,</span>
    <span class="s2">&quot;Psi Disrupter&quot;</span><span class="p">:</span> <span class="mi">190</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Marker&quot;</span><span class="p">:</span> <span class="mi">191</span><span class="p">,</span>
    <span class="s2">&quot;Terran Marker&quot;</span><span class="p">:</span> <span class="mi">192</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Marker&quot;</span><span class="p">:</span> <span class="mi">193</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Beacon&quot;</span><span class="p">:</span> <span class="mi">194</span><span class="p">,</span>
    <span class="s2">&quot;Terran Beacon&quot;</span><span class="p">:</span> <span class="mi">195</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Beacon&quot;</span><span class="p">:</span> <span class="mi">196</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Flag Beacon&quot;</span><span class="p">:</span> <span class="mi">197</span><span class="p">,</span>
    <span class="s2">&quot;Terran Flag Beacon&quot;</span><span class="p">:</span> <span class="mi">198</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Flag Beacon&quot;</span><span class="p">:</span> <span class="mi">199</span><span class="p">,</span>
    <span class="s2">&quot;Power Generator&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="s2">&quot;Overmind Cocoon&quot;</span><span class="p">:</span> <span class="mi">201</span><span class="p">,</span>
    <span class="s2">&quot;Dark Swarm&quot;</span><span class="p">:</span> <span class="mi">202</span><span class="p">,</span>
    <span class="s2">&quot;Floor Missile Trap&quot;</span><span class="p">:</span> <span class="mi">203</span><span class="p">,</span>
    <span class="s2">&quot;Floor Hatch (Unused)&quot;</span><span class="p">:</span> <span class="mi">204</span><span class="p">,</span>
    <span class="s2">&quot;Left Upper Level Door&quot;</span><span class="p">:</span> <span class="mi">205</span><span class="p">,</span>
    <span class="s2">&quot;Right Upper Level Door&quot;</span><span class="p">:</span> <span class="mi">206</span><span class="p">,</span>
    <span class="s2">&quot;Left Pit Door&quot;</span><span class="p">:</span> <span class="mi">207</span><span class="p">,</span>
    <span class="s2">&quot;Right Pit Door&quot;</span><span class="p">:</span> <span class="mi">208</span><span class="p">,</span>
    <span class="s2">&quot;Floor Gun Trap&quot;</span><span class="p">:</span> <span class="mi">209</span><span class="p">,</span>
    <span class="s2">&quot;Left Wall Missile Trap&quot;</span><span class="p">:</span> <span class="mi">210</span><span class="p">,</span>
    <span class="s2">&quot;Left Wall Flame Trap&quot;</span><span class="p">:</span> <span class="mi">211</span><span class="p">,</span>
    <span class="s2">&quot;Right Wall Missile Trap&quot;</span><span class="p">:</span> <span class="mi">212</span><span class="p">,</span>
    <span class="s2">&quot;Right Wall Flame Trap&quot;</span><span class="p">:</span> <span class="mi">213</span><span class="p">,</span>
    <span class="s2">&quot;Start Location&quot;</span><span class="p">:</span> <span class="mi">214</span><span class="p">,</span>
    <span class="s2">&quot;Flag&quot;</span><span class="p">:</span> <span class="mi">215</span><span class="p">,</span>
    <span class="s2">&quot;Young Chrysalis&quot;</span><span class="p">:</span> <span class="mi">216</span><span class="p">,</span>
    <span class="s2">&quot;Psi Emitter&quot;</span><span class="p">:</span> <span class="mi">217</span><span class="p">,</span>
    <span class="s2">&quot;Data Disc&quot;</span><span class="p">:</span> <span class="mi">218</span><span class="p">,</span>
    <span class="s2">&quot;Khaydarin Crystal&quot;</span><span class="p">:</span> <span class="mi">219</span><span class="p">,</span>
    <span class="s2">&quot;Mineral Cluster Type 1&quot;</span><span class="p">:</span> <span class="mi">220</span><span class="p">,</span>
    <span class="s2">&quot;Mineral Cluster Type 2&quot;</span><span class="p">:</span> <span class="mi">221</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Vespene Gas Orb Type 1&quot;</span><span class="p">:</span> <span class="mi">222</span><span class="p">,</span>
    <span class="s2">&quot;Protoss Vespene Gas Orb Type 2&quot;</span><span class="p">:</span> <span class="mi">223</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Vespene Gas Sac Type 1&quot;</span><span class="p">:</span> <span class="mi">224</span><span class="p">,</span>
    <span class="s2">&quot;Zerg Vespene Gas Sac Type 2&quot;</span><span class="p">:</span> <span class="mi">225</span><span class="p">,</span>
    <span class="s2">&quot;Terran Vespene Gas Tank Type 1&quot;</span><span class="p">:</span> <span class="mi">226</span><span class="p">,</span>
    <span class="s2">&quot;Terran Vespene Gas Tank Type 2&quot;</span><span class="p">:</span> <span class="mi">227</span><span class="p">,</span>
    <span class="s2">&quot;(any unit)&quot;</span><span class="p">:</span> <span class="mi">229</span><span class="p">,</span>
    <span class="s2">&quot;(men)&quot;</span><span class="p">:</span> <span class="mi">230</span><span class="p">,</span>
    <span class="s2">&quot;(buildings)&quot;</span><span class="p">:</span> <span class="mi">231</span><span class="p">,</span>
    <span class="s2">&quot;(factories)&quot;</span><span class="p">:</span> <span class="mi">232</span>
<span class="p">}</span>

<span class="c1"># ======================================</span>

<span class="c1"># Data from http://cafe.daum.net/rpgguild/6cWR/158</span>
<span class="c1"># Original data from ScAIEdit</span>
<span class="n">DefAIScriptDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Custom AI Scripts</span>
    <span class="n">b</span><span class="s1">&#39;Terran Custom Level&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TMCu&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg Custom Level&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZMCu&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss Custom Level&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PMCu&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran Expansion Custom Level&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TMCx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg Expansion Custom Level&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZMCx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss Expansion Custom Level&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PMCx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran Campaign Easy&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TLOf&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran Campaign Medium&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TMED&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran Campaign Difficult&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;THIf&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran Campaign Insane&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TSUP&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran Campaign Area Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TARE&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg Campaign Easy&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZLOf&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg Campaign Medium&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZMED&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg Campaign Difficult&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZHIf&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg Campaign Insane&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZSUP&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg Campaign Area Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZARE&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss Campaign Easy&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PLOf&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss Campaign Medium&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PMED&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss Campaign Difficult&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PHIf&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss Campaign Insane&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PSUP&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss Campaign Area Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PARE&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Terran Campaign Easy&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TLOx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Terran Campaign Medium&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TMEx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Terran Campaign Difficult&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;THIx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Terran Campaign Insane&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TSUx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Terran Campaign Area Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TARx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Zerg Campaign Easy&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZLOx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Zerg Campaign Medium&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZMEx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Zerg Campaign Difficult&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZHIx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Zerg Campaign Insane&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZSUx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Zerg Campaign Area Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZARx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Protoss Campaign Easy&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PLOx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Protoss Campaign Medium&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PMEx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Protoss Campaign Difficult&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PHIx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Protoss Campaign Insane&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PSUx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Expansion Protoss Campaign Area Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PARx&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Send All Units on Strategic Suicide Missions&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Suic&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Send All Units on Random Suicide Missions&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;SuiR&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Switch Computer Player to Rescue Passive&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Rscu&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 1&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi0&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 2&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi1&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 3&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi2&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 4&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi3&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 5&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi4&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 6&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi5&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 7&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi6&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn ON Shared Vision for Player 8&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;+Vi7&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 1&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi0&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 2&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi1&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 3&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi2&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 4&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi3&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 5&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi4&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 6&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi5&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 7&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi6&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Turn OFF Shared Vision for Player 8&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;-Vi7&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Move Dark Templars to Region&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;MvTe&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Clear Previous Combat Data&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ClrC&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Set Player to Enemy&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Enmy&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Set Player to Ally  &#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;y   &#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Value This Area Higher&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;VluA&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Enter Closest Bunker&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;EnBk&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Set Generic Command Target&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;StTg&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Make These Units Patrol&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;StPt&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Enter Transport&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;EnTr&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Exit Transport&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ExTr&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;AI Nuke Here&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;NuHe&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;AI Harass Here&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;HaHe&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Set Unit Order To: Junk Yard Dog&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;JYDg&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Disruption Web Here&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;DWHe&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Recall Here&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ReHe&#39;</span><span class="p">,</span>

    <span class="c1"># StarCraft AI Scripts</span>
    <span class="n">b</span><span class="s1">&#39;Terran 3 - Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Ter3&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 5 - Terran Main Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Ter5&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 5 - Terran Harvest Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Te5H&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 6 - Air Attack Zerg&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Ter6&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 6 - Ground Attack Zerg&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Te6b&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 6 - Zerg Support Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Te6c&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 7 - Bottom Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Ter7&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 7 - Right Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Te7s&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 7 - Middle Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Te7m&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 8 - Confederate Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Ter8&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 9 - Light Attack&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Tr9L&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 9 - Heavy Attack&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Tr9H&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 10 - Confederate Towns&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Te10&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 11 - Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;T11z&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 11 - Lower Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;T11a&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 11 - Upper Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;T11b&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 12 - Nuke Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;T12N&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 12 - Phoenix Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;T12P&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 12 - Tank Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;T12T&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 1 - Electronic Distribution&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TED1&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 2 - Electronic Distribution&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TED2&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 3 - Electronic Distribution&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TED3&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 1 - Shareware&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TSW1&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 2 - Shareware&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TSW2&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 3 - Shareware&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TSW3&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 4 - Shareware&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TSW4&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Terran 5 - Shareware&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TSW5&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 1 - Terran Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zer1&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 2 - Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zer2&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 3 - Terran Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zer3&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 4 - Right Terran Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zer4&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 4 - Lower Terran Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Ze4S&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 6 - Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zer6&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 7 - Air Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zr7a&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 7 - Ground Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zr7g&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 7 - Support Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zr7s&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 8 - Scout Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zer8&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 8 - Templar Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Ze8T&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 9 - Teal Protoss&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Zer9&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 9 - Left Yellow Protoss&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z9ly&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 9 - Right Yellow Protoss&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z9ry&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 9 - Left Orange Protoss&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z9lo&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 9 - Right Orange Protoss&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z9ro&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 10 - Left Teal (Attack&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z10a&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 10 - Right Teal (Support&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z10b&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 10 - Left Yellow (Support&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z10c&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 10 - Right Yellow (Attack&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z10d&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Zerg 10 - Red Protoss&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Z10e&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 1 - Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pro1&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 2 - Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pro2&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 3 - Air Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr3R&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 3 - Ground Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr3G&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 4 - Zerg Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pro4&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 5 - Zerg Town Island&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr5I&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 5 - Zerg Town Base&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr5B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 7 - Left Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pro7&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 7 - Right Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr7B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 7 - Shrine Protoss&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr7S&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 8 - Left Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pro8&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 8 - Right Protoss Town&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr8B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 8 - Protoss Defenders&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr8D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 9 - Ground Zerg&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pro9&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 9 - Air Zerg&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr9W&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 9 - Spell Zerg&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr9Y&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 10 - Mini-Towns&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;Pr10&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 10 - Mini-Town Master&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;P10C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Protoss 10 - Overmind Defenders&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;P10o&#39;</span><span class="p">,</span>

    <span class="c1"># Brood Wars AI Scripts</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 1 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB1A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 1 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB1B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 1 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB1C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 1 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB1D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 1 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB1E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 1 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB1F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 2 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB2A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 2 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB2B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 2 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB2C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 2 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB2D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 2 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB2E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 2 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB2F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 3 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB3A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 3 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB3B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 3 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB3C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 3 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB3D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 3 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB3E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 3 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB3F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 4 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB4A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 4 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB4B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 4 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB4C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 4 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB4D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 4 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB4E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 4 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB4F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 5 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB5A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 5 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB5B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 5 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB5C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 5 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB5D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 5 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB5E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 5 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB5F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 6 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB6A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 6 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB6B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 6 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB6C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 6 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB6D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 6 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB6E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 6 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB6F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 7 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB7A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 7 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB7B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 7 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB7C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 7 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB7D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 7 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB7E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 7 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB7F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 8 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB8A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 8 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB8B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 8 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB8C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 8 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB8D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 8 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB8E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Protoss 8 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;PB8F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 1 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB1A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 1 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB1B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 1 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB1C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 1 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB1D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 1 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB1E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 1 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB1F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 2 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB2A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 2 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB2B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 2 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB2C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 2 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB2D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 2 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB2E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 2 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB2F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 3 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB3A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 3 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB3B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 3 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB3C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 3 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB3D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 3 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB3E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 3 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB3F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 4 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB4A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 4 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB4B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 4 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB4C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 4 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB4D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 4 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB4E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 4 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB4F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 5 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB5A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 5 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB5B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 5 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB5C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 5 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB5D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 5 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB5E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 5 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB5F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 6 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB6A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 6 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB6B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 6 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB6C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 6 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB6D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 6 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB6E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 6 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB6F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 7 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB7A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 7 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB7B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 7 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB7C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 7 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB7D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 7 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB7E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 7 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB7F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 8 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB8A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 8 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB8B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 8 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB8C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 8 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB8D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 8 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB8E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Terran 8 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;TB8F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 1 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB1A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 1 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB1B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 1 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB1C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 1 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB1D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 1 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB1E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 1 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB1F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 2 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB2A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 2 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB2B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 2 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB2C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 2 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB2D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 2 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB2E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 2 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB2F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 3 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB3A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 3 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB3B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 3 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB3C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 3 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB3D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 3 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB3E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 3 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB3F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 4 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB4A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 4 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB4B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 4 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB4C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 4 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB4D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 4 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB4E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 4 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB4F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 5 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB5A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 5 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB5B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 5 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB5C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 5 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB5D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 5 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB5E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 5 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB5F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 6 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB6A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 6 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB6B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 6 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB6C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 6 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB6D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 6 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB6E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 6 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB6F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 7 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB7A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 7 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB7B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 7 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB7C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 7 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB7D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 7 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB7E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 7 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB7F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 8 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB8A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 8 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB8B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 8 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB8C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 8 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB8D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 8 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB8E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 8 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB8F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 9 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB9A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 9 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB9B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 9 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB9C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 9 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB9D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 9 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB9E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 9 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB9F&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 10 - Town A&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB0A&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 10 - Town B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB0B&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 10 - Town C&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB0C&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 10 - Town D&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB0D&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 10 - Town E&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB0E&#39;</span><span class="p">,</span>
    <span class="n">b</span><span class="s1">&#39;Brood Wars Zerg 10 - Town F&#39;</span><span class="p">:</span> <span class="n">b</span><span class="s1">&#39;ZB0F&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\strenc.py : 86 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..mapdata</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GetLocationIndex</span><span class="p">,</span>
    <span class="n">GetStringIndex</span><span class="p">,</span>
    <span class="n">GetSwitchIndex</span><span class="p">,</span>
    <span class="n">GetUnitIndex</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>

<span class="kn">from</span> <span class="nn">.strdict</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DefAIScriptDict</span><span class="p">,</span>
    <span class="n">DefLocationDict</span><span class="p">,</span>
    <span class="n">DefSwitchDict</span><span class="p">,</span>
    <span class="n">DefUnitDict</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeAIScript</span><span class="p">(</span><span class="n">ais</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ais</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">ais</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">ais</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ais</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ais</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;AIScript name too short&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ais</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i4</span><span class="p">(</span><span class="n">DefAIScriptDict</span><span class="p">[</span><span class="n">ais</span><span class="p">])</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ais</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i4</span><span class="p">(</span><span class="n">ais</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ais</span>


<span class="k">def</span> <span class="nf">_EncodeAny</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dl</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># unhashable</span>
            <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">EncodeLocation</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_EncodeAny</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">GetLocationIndex</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DefLocationDict</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeString</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_EncodeAny</span><span class="p">(</span><span class="n">GetStringIndex</span><span class="p">,</span> <span class="p">{},</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeSwitch</span><span class="p">(</span><span class="n">sw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_EncodeAny</span><span class="p">(</span><span class="n">GetSwitchIndex</span><span class="p">,</span> <span class="n">DefSwitchDict</span><span class="p">,</span> <span class="n">sw</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EncodeUnit</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_EncodeAny</span><span class="p">(</span><span class="n">GetUnitIndex</span><span class="p">,</span> <span class="n">DefUnitDict</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\triggerscope.py : 55 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="n">EUDCreateBlock</span><span class="p">,</span> <span class="n">EUDGetLastBlockOfName</span><span class="p">,</span> <span class="n">EUDPopBlock</span>
<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="n">Forward</span>


<span class="k">def</span> <span class="nf">PushTriggerScope</span><span class="p">():</span>
    <span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;triggerscope&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;nexttrigger_list&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="bp">True</span>  <span class="c1"># Allow `if PushTriggerScope()` syntax for indent</span>


<span class="k">def</span> <span class="nf">NextTrigger</span><span class="p">():</span>
    <span class="n">fw</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
    <span class="n">nt_list</span> <span class="o">=</span> <span class="n">EUDGetLastBlockOfName</span><span class="p">(</span><span class="s1">&#39;triggerscope&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;nexttrigger_list&#39;</span><span class="p">]</span>
    <span class="n">nt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fw</span>


<span class="k">def</span> <span class="nf">_RegisterTrigger</span><span class="p">(</span><span class="n">trg</span><span class="p">):</span>
    <span class="n">nt_list</span> <span class="o">=</span> <span class="n">EUDGetLastBlockOfName</span><span class="p">(</span><span class="s1">&#39;triggerscope&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;nexttrigger_list&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">fw</span> <span class="ow">in</span> <span class="n">nt_list</span><span class="p">:</span>
        <span class="n">fw</span> <span class="o">&lt;&lt;</span> <span class="n">trg</span>
    <span class="n">nt_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">PopTriggerScope</span><span class="p">():</span>
    <span class="n">nt_list</span> <span class="o">=</span> <span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;triggerscope&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;nexttrigger_list&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">fw</span> <span class="ow">in</span> <span class="n">nt_list</span><span class="p">:</span>
        <span class="n">fw</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\rawtrigger\__init__.py : 89 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.rawtriggerdef</span> <span class="kn">import</span> <span class="n">Disabled</span><span class="p">,</span> <span class="n">RawTrigger</span><span class="p">,</span> <span class="n">GetTriggerCounter</span>
<span class="kn">from</span> <span class="nn">.triggerscope</span> <span class="kn">import</span> <span class="n">PushTriggerScope</span><span class="p">,</span> <span class="n">PopTriggerScope</span><span class="p">,</span> <span class="n">NextTrigger</span>
<span class="kn">from</span> <span class="nn">.condition</span> <span class="kn">import</span> <span class="n">Condition</span>
<span class="kn">from</span> <span class="nn">.action</span> <span class="kn">import</span> <span class="n">Action</span>
<span class="kn">from</span> <span class="nn">.stockcond</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CountdownTimer</span><span class="p">,</span> <span class="n">Command</span><span class="p">,</span> <span class="n">Bring</span><span class="p">,</span> <span class="n">Accumulate</span><span class="p">,</span> <span class="n">Kills</span><span class="p">,</span>
    <span class="n">CommandMost</span><span class="p">,</span> <span class="n">CommandMostAt</span><span class="p">,</span> <span class="n">MostKills</span><span class="p">,</span> <span class="n">HighestScore</span><span class="p">,</span> <span class="n">MostResources</span><span class="p">,</span>
    <span class="n">Switch</span><span class="p">,</span> <span class="n">ElapsedTime</span><span class="p">,</span> <span class="n">Opponents</span><span class="p">,</span> <span class="n">Deaths</span><span class="p">,</span> <span class="n">CommandLeast</span><span class="p">,</span>
    <span class="n">CommandLeastAt</span><span class="p">,</span> <span class="n">LeastKills</span><span class="p">,</span> <span class="n">LowestScore</span><span class="p">,</span> <span class="n">LeastResources</span><span class="p">,</span> <span class="n">Score</span><span class="p">,</span>
    <span class="n">Always</span><span class="p">,</span> <span class="n">Never</span><span class="p">,</span> <span class="n">Memory</span><span class="p">,</span> <span class="n">MemoryEPD</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.stockact</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Victory</span><span class="p">,</span> <span class="n">Defeat</span><span class="p">,</span> <span class="n">PreserveTrigger</span><span class="p">,</span> <span class="n">Wait</span><span class="p">,</span> <span class="n">PauseGame</span><span class="p">,</span>
    <span class="n">UnpauseGame</span><span class="p">,</span> <span class="n">Transmission</span><span class="p">,</span> <span class="n">PlayWAV</span><span class="p">,</span> <span class="n">DisplayText</span><span class="p">,</span> <span class="n">CenterView</span><span class="p">,</span>
    <span class="n">CreateUnitWithProperties</span><span class="p">,</span> <span class="n">SetMissionObjectives</span><span class="p">,</span> <span class="n">SetSwitch</span><span class="p">,</span>
    <span class="n">SetCountdownTimer</span><span class="p">,</span> <span class="n">RunAIScript</span><span class="p">,</span> <span class="n">RunAIScriptAt</span><span class="p">,</span> <span class="n">LeaderBoardControl</span><span class="p">,</span>
    <span class="n">LeaderBoardControlAt</span><span class="p">,</span> <span class="n">LeaderBoardResources</span><span class="p">,</span> <span class="n">LeaderBoardKills</span><span class="p">,</span>
    <span class="n">LeaderBoardScore</span><span class="p">,</span> <span class="n">KillUnit</span><span class="p">,</span> <span class="n">KillUnitAt</span><span class="p">,</span> <span class="n">RemoveUnit</span><span class="p">,</span> <span class="n">RemoveUnitAt</span><span class="p">,</span>
    <span class="n">SetResources</span><span class="p">,</span> <span class="n">SetScore</span><span class="p">,</span> <span class="n">MinimapPing</span><span class="p">,</span> <span class="n">TalkingPortrait</span><span class="p">,</span> <span class="n">MuteUnitSpeech</span><span class="p">,</span>
    <span class="n">UnMuteUnitSpeech</span><span class="p">,</span> <span class="n">LeaderBoardComputerPlayers</span><span class="p">,</span> <span class="n">LeaderBoardGoalControl</span><span class="p">,</span>
    <span class="n">LeaderBoardGoalControlAt</span><span class="p">,</span> <span class="n">LeaderBoardGoalResources</span><span class="p">,</span>
    <span class="n">LeaderBoardGoalKills</span><span class="p">,</span> <span class="n">LeaderBoardGoalScore</span><span class="p">,</span> <span class="n">MoveLocation</span><span class="p">,</span> <span class="n">MoveUnit</span><span class="p">,</span>
    <span class="n">LeaderBoardGreed</span><span class="p">,</span> <span class="n">SetNextScenario</span><span class="p">,</span> <span class="n">SetDoodadState</span><span class="p">,</span> <span class="n">SetInvincibility</span><span class="p">,</span>
    <span class="n">CreateUnit</span><span class="p">,</span> <span class="n">SetDeaths</span><span class="p">,</span> <span class="n">Order</span><span class="p">,</span> <span class="n">Comment</span><span class="p">,</span> <span class="n">GiveUnits</span><span class="p">,</span> <span class="n">ModifyUnitHitPoints</span><span class="p">,</span>
    <span class="n">ModifyUnitEnergy</span><span class="p">,</span> <span class="n">ModifyUnitShields</span><span class="p">,</span> <span class="n">ModifyUnitResourceAmount</span><span class="p">,</span>
    <span class="n">ModifyUnitHangarCount</span><span class="p">,</span> <span class="n">PauseTimer</span><span class="p">,</span> <span class="n">UnpauseTimer</span><span class="p">,</span> <span class="n">Draw</span><span class="p">,</span>
    <span class="n">SetAllianceStatus</span><span class="p">,</span> <span class="n">SetMemory</span><span class="p">,</span> <span class="n">SetNextPtr</span><span class="p">,</span> <span class="n">SetMemoryEPD</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.constenc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">All</span><span class="p">,</span> <span class="n">Enemy</span><span class="p">,</span> <span class="n">Ally</span><span class="p">,</span> <span class="n">AlliedVictory</span><span class="p">,</span> <span class="n">AtLeast</span><span class="p">,</span> <span class="n">AtMost</span><span class="p">,</span> <span class="n">Exactly</span><span class="p">,</span> <span class="n">SetTo</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span>
    <span class="n">Subtract</span><span class="p">,</span> <span class="n">Move</span><span class="p">,</span> <span class="n">Patrol</span><span class="p">,</span> <span class="n">Attack</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span>
    <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">Player1</span><span class="p">,</span> <span class="n">Player2</span><span class="p">,</span> <span class="n">Player3</span><span class="p">,</span> <span class="n">Player4</span><span class="p">,</span> <span class="n">Player5</span><span class="p">,</span> <span class="n">Player6</span><span class="p">,</span>
    <span class="n">Player7</span><span class="p">,</span> <span class="n">Player8</span><span class="p">,</span> <span class="n">Player9</span><span class="p">,</span> <span class="n">Player10</span><span class="p">,</span> <span class="n">Player11</span><span class="p">,</span> <span class="n">Player12</span><span class="p">,</span>
    <span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">Foes</span><span class="p">,</span> <span class="n">Allies</span><span class="p">,</span> <span class="n">NeutralPlayers</span><span class="p">,</span> <span class="n">AllPlayers</span><span class="p">,</span> <span class="n">Force1</span><span class="p">,</span>
    <span class="n">Force2</span><span class="p">,</span> <span class="n">Force3</span><span class="p">,</span> <span class="n">Force4</span><span class="p">,</span> <span class="n">NonAlliedVictoryPlayers</span><span class="p">,</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Disable</span><span class="p">,</span>
    <span class="n">Toggle</span><span class="p">,</span> <span class="n">Ore</span><span class="p">,</span> <span class="n">Gas</span><span class="p">,</span> <span class="n">OreAndGas</span><span class="p">,</span> <span class="n">Total</span><span class="p">,</span> <span class="n">Units</span><span class="p">,</span> <span class="n">Buildings</span><span class="p">,</span>
    <span class="n">UnitsAndBuildings</span><span class="p">,</span> <span class="n">Kills</span><span class="p">,</span> <span class="n">Razings</span><span class="p">,</span> <span class="n">KillsAndRazings</span><span class="p">,</span> <span class="n">Custom</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span>
    <span class="n">Clear</span><span class="p">,</span> <span class="n">Random</span><span class="p">,</span> <span class="n">Cleared</span><span class="p">,</span>

<span class="c1"># encoders</span>
    <span class="n">EncodeAllyStatus</span><span class="p">,</span>
    <span class="n">EncodeComparison</span><span class="p">,</span>
    <span class="n">EncodeCount</span><span class="p">,</span>
    <span class="n">EncodeModifier</span><span class="p">,</span>
    <span class="n">EncodeOrder</span><span class="p">,</span>
    <span class="n">EncodePlayer</span><span class="p">,</span>
    <span class="n">EncodeProperty</span><span class="p">,</span>
    <span class="n">EncodePropState</span><span class="p">,</span>
    <span class="n">EncodeResource</span><span class="p">,</span>
    <span class="n">EncodeScore</span><span class="p">,</span>
    <span class="n">EncodeSwitchAction</span><span class="p">,</span>
    <span class="n">EncodeSwitchState</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.strenc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EncodeAIScript</span><span class="p">,</span>
    <span class="n">EncodeLocation</span><span class="p">,</span>
    <span class="n">EncodeString</span><span class="p">,</span>
    <span class="n">EncodeSwitch</span><span class="p">,</span>
    <span class="n">EncodeUnit</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\eudf.py : 51 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">from</span> <span class="nn">.eudfuncn</span> <span class="kn">import</span> <span class="n">EUDFuncN</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">def</span> <span class="nf">EUDFunc</span><span class="p">(</span><span class="n">fdecl_func</span><span class="p">):</span>
    <span class="n">argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">fdecl_func</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
        <span class="n">argspec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s1">&#39;No variadic arguments (*args) allowed for EUDFunc.&#39;</span>
    <span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
        <span class="n">argspec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s1">&#39;No variadic keyword arguments (*kwargs) allowed for EUDFunc.&#39;</span>
    <span class="p">)</span>

    <span class="n">_f</span> <span class="o">=</span> <span class="n">EUDFuncN</span><span class="p">(</span><span class="n">fdecl_func</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">argspec</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">fdecl_func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fcaller</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_f</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\eudfmethod.py : 70 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">eudf</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>

<span class="n">__f_increment</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">EUDFuncMethod</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">__f_increment</span>

    <span class="c1"># Get argument number of fdecl_func</span>
    <span class="n">argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
        <span class="n">argspec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s1">&#39;No variadic arguments (*args) allowed for EUDFunc.&#39;</span>
    <span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
        <span class="n">argspec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s1">&#39;No variadic keyword arguments (*kwargs) allowed for EUDFunc.&#39;</span>
    <span class="p">)</span>

    <span class="n">argn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argspec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">idf</span> <span class="o">=</span> <span class="n">__f_increment</span>
    <span class="n">__f_increment</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1"># Create eudfuncmethod list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_efmlist&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_efmlist</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Create wrapper for eudfunc</span>
        <span class="k">if</span> <span class="n">idf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_efmlist</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">call2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">call2</span> <span class="o">=</span> <span class="n">eudf</span><span class="o">.</span><span class="n">EUDFuncN</span><span class="p">(</span><span class="n">call2</span><span class="p">,</span> <span class="n">argn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_efmlist</span><span class="p">[</span><span class="n">idf</span><span class="p">]</span> <span class="o">=</span> <span class="n">call2</span>

        <span class="c1"># Call that wrapper with arguments</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_efmlist</span><span class="p">[</span><span class="n">idf</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">call</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\eudfptr.py : 191 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.eudfuncn</span> <span class="kn">import</span> <span class="n">EUDFuncN</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.eudv</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_VProc</span><span class="p">,</span>
    <span class="n">EUDVariable</span><span class="p">,</span>
    <span class="n">SetVariables</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.eudstruct</span> <span class="kn">import</span> <span class="n">EUDStruct</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">rawtrigger</span> <span class="k">as</span> <span class="n">rt</span>
<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="n">Forward</span>


<span class="c1">#</span>
<span class="c1"># Common argument / returns storage</span>
<span class="c1">#</span>

<span class="k">def</span> <span class="nf">getArgStorage</span><span class="p">(</span><span class="n">argn</span><span class="p">,</span> <span class="n">_argstorage_dict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot; Get common arguments storage for argn &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_argstorage_dict</span><span class="p">:</span>
        <span class="n">_argstorage_dict</span><span class="p">[</span><span class="n">argn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">argn</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">_argstorage_dict</span><span class="p">[</span><span class="n">argn</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">getRetStorage</span><span class="p">(</span><span class="n">retn</span><span class="p">,</span> <span class="n">_retstorage_dict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot; Get common returns storage for retn &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">retn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_retstorage_dict</span><span class="p">:</span>
        <span class="n">_retstorage_dict</span><span class="p">[</span><span class="n">retn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retn</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">_retstorage_dict</span><span class="p">[</span><span class="n">retn</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">fillArguments</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Copy values from common argument storage to f._args &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">_argn</span><span class="p">:</span>
        <span class="n">argStorage</span> <span class="o">=</span> <span class="n">getArgStorage</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">_argn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">farg</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">_fargs</span><span class="p">,</span> <span class="n">argStorage</span><span class="p">):</span>
            <span class="n">_VProc</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">QueueAssignTo</span><span class="p">(</span><span class="n">farg</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fillReturns</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Copy values from f_rets to common returns storage &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">_retn</span><span class="p">:</span>
        <span class="n">retStorage</span> <span class="o">=</span> <span class="n">getRetStorage</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">_retn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fret</span><span class="p">,</span> <span class="n">ret</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">_frets</span><span class="p">,</span> <span class="n">retStorage</span><span class="p">):</span>
            <span class="n">_VProc</span><span class="p">(</span><span class="n">fret</span><span class="p">,</span> <span class="n">fret</span><span class="o">.</span><span class="n">QueueAssignTo</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">callFuncBody</span><span class="p">(</span><span class="n">fstart</span><span class="p">,</span> <span class="n">fend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Call function&#39;s body triggers &quot;&quot;&quot;</span>
    <span class="n">fcallend</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>

    <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">nextptr</span><span class="o">=</span><span class="n">fstart</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">rt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">fend</span><span class="p">,</span> <span class="n">fcallend</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="n">fcallend</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">createIndirectCaller</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">_caller_dict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot; Create function caller using common argument/return storage &quot;&quot;&quot;</span>

    <span class="c1"># Cache function in _caller_dict. If uncached,</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_caller_dict</span><span class="p">:</span>
        <span class="n">rt</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">()</span>
        <span class="n">caller_start</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">fillArguments</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">callFuncBody</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">_fstart</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">_fend</span><span class="p">)</span>
        <span class="n">fillReturns</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">caller_end</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">()</span>
        <span class="n">rt</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

        <span class="n">_caller_dict</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">caller_start</span><span class="p">,</span> <span class="n">caller_end</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_caller_dict</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>


<span class="c1"># ---------------------------------</span>


<span class="k">def</span> <span class="nf">EUDFuncPtr</span><span class="p">(</span><span class="n">argn</span><span class="p">,</span> <span class="n">retn</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PtrDataClass</span><span class="p">(</span><span class="n">EUDStruct</span><span class="p">):</span>
        <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;_fstart&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_fendnext_epd&#39;</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_init</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Constructor with function prototype</span>

<span class="sd">            :param argn: Number of arguments function can accepy</span>
<span class="sd">            :param retn: Number of variables function will return.</span>
<span class="sd">            :param f_init: First function</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">f_init</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_init</span><span class="p">,</span> <span class="n">EUDFuncN</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkValidFunction</span><span class="p">(</span><span class="n">f_init</span><span class="p">)</span>
                    <span class="n">f_idcstart</span><span class="p">,</span> <span class="n">f_idcend</span> <span class="o">=</span> <span class="n">createIndirectCaller</span><span class="p">(</span><span class="n">f_init</span><span class="p">)</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">([</span>
                        <span class="n">f_idcstart</span><span class="p">,</span>  <span class="c1"># fstart</span>
                        <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">f_idcend</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># fendnext_epd</span>
                    <span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">f_init</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">checkValidFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">EUDFuncN</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">_fstart</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">_CreateFuncBody</span><span class="p">()</span>

            <span class="n">f_argn</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">_argn</span>
            <span class="n">f_retn</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">_retn</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">argn</span> <span class="o">==</span> <span class="n">f_argn</span><span class="p">,</span> <span class="s2">&quot;Function with different prototype&quot;</span><span class="p">)</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">retn</span> <span class="o">==</span> <span class="n">f_retn</span><span class="p">,</span> <span class="s2">&quot;Function with different prototype&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">setFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Set function pointer&#39;s target to function</span>

<span class="sd">            :param f: Target function</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkValidFunction</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># Build actions</span>
            <span class="n">f_idcstart</span><span class="p">,</span> <span class="n">f_idcend</span> <span class="o">=</span> <span class="n">createIndirectCaller</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span> <span class="o">=</span> <span class="n">f_idcstart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fendnext_epd</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">f_idcend</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFunc</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Call target function with given arguments &quot;&quot;&quot;</span>

            <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">argn</span><span class="p">:</span>
                <span class="n">argStorage</span> <span class="o">=</span> <span class="n">getArgStorage</span><span class="p">(</span><span class="n">argn</span><span class="p">)</span>
                <span class="n">SetVariables</span><span class="p">(</span><span class="n">argStorage</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

            <span class="c1"># Call function</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">(),</span> <span class="n">Forward</span><span class="p">()</span>
            <span class="n">SetVariables</span><span class="p">(</span>
                <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fendnext_epd</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">fcallend</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fcallend</span><span class="p">),</span>
                    <span class="n">rt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">rt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">fcallend</span> <span class="o">&lt;&lt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">retn</span><span class="p">:</span>
                <span class="n">tmpRets</span> <span class="o">=</span> <span class="p">[</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retn</span><span class="p">)]</span>
                <span class="n">retStorage</span> <span class="o">=</span> <span class="n">getRetStorage</span><span class="p">(</span><span class="n">retn</span><span class="p">)</span>
                <span class="n">SetVariables</span><span class="p">(</span><span class="n">tmpRets</span><span class="p">,</span> <span class="n">retStorage</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">List2Assignable</span><span class="p">(</span><span class="n">tmpRets</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PtrDataClass</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\eudfuncn.py : 177 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">from</span> <span class="nn">.eudv</span> <span class="kn">import</span> <span class="n">EUDVariable</span><span class="p">,</span> <span class="n">SeqCompute</span><span class="p">,</span> <span class="n">SetVariables</span>
<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">List2Assignable</span><span class="p">,</span>
    <span class="n">Assignable2List</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">...utils.blockstru</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BlockStruManager</span><span class="p">,</span>
    <span class="n">SetCurrentBlockStruManager</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="n">Forward</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">rawtrigger</span> <span class="k">as</span> <span class="n">bt</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="n">_currentCompiledFunc</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_currentTriggerCount</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">_updateFuncTriggerCount</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_currentTriggerCount</span>
    <span class="n">currentCounter</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">GetTriggerCounter</span><span class="p">()</span>
    <span class="n">addedTriggerCount</span> <span class="o">=</span> <span class="n">currentCounter</span> <span class="o">-</span> <span class="n">_currentTriggerCount</span>

    <span class="k">if</span> <span class="n">_currentCompiledFunc</span><span class="p">:</span>
        <span class="n">_currentCompiledFunc</span><span class="o">.</span><span class="n">_triggerCount</span> <span class="o">+=</span> <span class="n">addedTriggerCount</span>
    <span class="n">_currentTriggerCount</span> <span class="o">=</span> <span class="n">currentCounter</span>


<span class="k">def</span> <span class="nf">_setCurrentCompiledFunc</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_currentCompiledFunc</span>

    <span class="n">lastCompiledFunc</span> <span class="o">=</span> <span class="n">_currentCompiledFunc</span>
    <span class="n">_updateFuncTriggerCount</span><span class="p">()</span>
    <span class="n">_currentCompiledFunc</span> <span class="o">=</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">lastCompiledFunc</span>


<span class="k">class</span> <span class="nc">EUDFuncN</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdecl_func</span><span class="p">,</span> <span class="n">argn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_argn</span> <span class="o">=</span> <span class="n">argn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retn</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fdecl_func</span> <span class="o">=</span> <span class="n">fdecl_func</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdecl_func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fend</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fargs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frets</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_triggerCount</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_CreateFuncBody</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_triggerCount</span>

    <span class="k">def</span> <span class="nf">_CreateFuncBody</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_triggerCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lastCompiledFunc</span> <span class="o">=</span> <span class="n">_setCurrentCompiledFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Add return point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fend</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>

        <span class="c1"># Prevent double compilication</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c1"># Initalize new namespace</span>
        <span class="n">f_bsm</span> <span class="o">=</span> <span class="n">BlockStruManager</span><span class="p">()</span>
        <span class="n">prev_bsm</span> <span class="o">=</span> <span class="n">SetCurrentBlockStruManager</span><span class="p">(</span><span class="n">f_bsm</span><span class="p">)</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">()</span>

        <span class="n">f_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_argn</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fargs</span> <span class="o">=</span> <span class="n">f_args</span>

        <span class="n">fstart</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span> <span class="o">=</span> <span class="n">fstart</span>

        <span class="n">final_rets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fdecl_func</span><span class="p">(</span><span class="o">*</span><span class="n">f_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">final_rets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_AddReturn</span><span class="p">(</span><span class="n">Assignable2List</span><span class="p">(</span><span class="n">final_rets</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">fend</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">()</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

        <span class="c1"># Finalize</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">f_bsm</span><span class="o">.</span><span class="n">empty</span><span class="p">(),</span> <span class="s1">&#39;Block start/end mismatch inside function&#39;</span><span class="p">)</span>
        <span class="n">SetCurrentBlockStruManager</span><span class="p">(</span><span class="n">prev_bsm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fend</span> <span class="o">&lt;&lt;</span> <span class="n">fend</span>
        <span class="c1"># No return -&gt; set return count to 0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_retn</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">_setCurrentCompiledFunc</span><span class="p">(</span><span class="n">lastCompiledFunc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_AddReturn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retv</span><span class="p">,</span> <span class="n">needjump</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frets</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frets</span> <span class="o">=</span> <span class="p">[</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retv</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_retn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">retv</span><span class="p">)</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">retv</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frets</span><span class="p">),</span>
            <span class="s2">&quot;Numbers of returned value should be constant.&quot;</span>
            <span class="s2">&quot; (From function </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fdecl_func</span><span class="o">.</span><span class="n">__name__</span>
        <span class="p">)</span>

        <span class="n">SetVariables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frets</span><span class="p">,</span> <span class="n">retv</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">needjump</span><span class="p">:</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">nextptr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fend</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_CreateFuncBody</span><span class="p">()</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_argn</span><span class="p">,</span> <span class="s1">&#39;Argument number mismatch&#39;</span><span class="p">)</span>

        <span class="c1"># Assign arguments into argument space</span>
        <span class="n">SeqCompute</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">farg</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">farg</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fargs</span><span class="p">,</span> <span class="n">args</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="c1"># Call body</span>
        <span class="n">fcallend</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>

        <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fstart</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fend</span><span class="p">,</span> <span class="n">fcallend</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="n">fcallend</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">retn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frets</span><span class="p">)</span>
            <span class="n">tmp_rets</span> <span class="o">=</span> <span class="p">[</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retn</span><span class="p">)]</span>
            <span class="n">SetVariables</span><span class="p">(</span><span class="n">tmp_rets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frets</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">List2Assignable</span><span class="p">(</span><span class="n">tmp_rets</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDReturn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">callerName</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">currentFuncName</span> <span class="o">=</span> <span class="n">_currentCompiledFunc</span><span class="o">.</span><span class="n">__name__</span>
    <span class="k">if</span> <span class="n">callerName</span> <span class="o">!=</span> <span class="n">currentFuncName</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;[Warning] EUDReturn may have been called from a &#39;</span>
              <span class="s1">&#39;different function (</span><span class="si">%s</span><span class="s1">) than compiled function(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
              <span class="p">(</span><span class="n">callerName</span><span class="p">,</span> <span class="n">currentFuncName</span><span class="p">))</span>
    <span class="n">_currentCompiledFunc</span><span class="o">.</span><span class="n">_AddReturn</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\eudlv.py : 41 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..eudobj</span> <span class="kn">import</span> <span class="n">Db</span>
<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="n">i2b4</span>
<span class="kn">from</span> <span class="nn">.vbase</span> <span class="kn">import</span> <span class="n">VariableBase</span>


<span class="k">class</span> <span class="nc">EUDLightVariable</span><span class="p">(</span><span class="n">VariableBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memaddr</span> <span class="o">=</span> <span class="n">Db</span><span class="p">(</span><span class="n">i2b4</span><span class="p">(</span><span class="n">initvalue</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getValueAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memaddr</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\eudstruct.py : 107 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.vararray</span> <span class="kn">import</span> <span class="n">EUDVArray</span>
<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="n">ExprProxy</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">structarr</span>


<span class="k">class</span> <span class="nc">EUDStruct</span><span class="p">(</span><span class="n">ExprProxy</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">structarr</span><span class="o">.</span><span class="n">_EUDStruct_Metaclass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initvar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">basetype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">basetype</span><span class="o">.</span><span class="n">_fields_</span>

        <span class="c1"># Fill fielddict</span>
        <span class="n">fielddict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">nametype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nametype</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">fielddict</span><span class="p">[</span><span class="n">nametype</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fielddict</span><span class="p">[</span><span class="n">nametype</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">nametype</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fielddict</span> <span class="o">=</span> <span class="n">fielddict</span>

        <span class="c1"># With initialization</span>
        <span class="k">if</span> <span class="n">initvar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">initvals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">nametype</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nametype</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">initvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">attrtype</span> <span class="o">=</span> <span class="n">nametype</span>
                    <span class="n">initvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrtype</span><span class="p">())</span>

            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">EUDVArray</span><span class="p">(</span><span class="n">initvals</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">EUDVArray</span><span class="p">(</span><span class="n">initvar</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create struct clone &quot;&quot;&quot;</span>
        <span class="n">basetype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">basetype</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span> <span class="nf">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy struct to other instance &quot;&quot;&quot;</span>
        <span class="n">basetype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">basetype</span><span class="o">.</span><span class="n">_fields_</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nametype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nametype</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">attrtype</span> <span class="o">=</span> <span class="n">nametype</span>
                <span class="n">attrtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">attrtype</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">getfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attrid</span><span class="p">,</span> <span class="n">attrtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fielddict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attrid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attrtype</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attr</span>

    <span class="k">def</span> <span class="nf">setfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">attrid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fielddict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attrid</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getfield</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;_initialized&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setfield</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\eudv.py : 475 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">rawtrigger</span> <span class="k">as</span> <span class="n">bt</span>
<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Evaluate</span><span class="p">,</span>
    <span class="n">Forward</span><span class="p">,</span>
    <span class="n">ConstExpr</span><span class="p">,</span>
    <span class="n">IsConstExpr</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FlattenList</span><span class="p">,</span>
    <span class="n">EPD</span><span class="p">,</span>
    <span class="n">List2Assignable</span><span class="p">,</span>
    <span class="n">unProxy</span><span class="p">,</span>
    <span class="n">ep_assert</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.vbase</span> <span class="kn">import</span> <span class="n">VariableBase</span>
<span class="kn">from</span> <span class="nn">.vbuf</span> <span class="kn">import</span> <span class="n">GetCurrentVariableBuffer</span>


<span class="c1"># Unused variable don&#39;t need to be allocated.</span>
<span class="k">class</span> <span class="nc">VariableTriggerForward</span><span class="p">(</span><span class="n">ConstExpr</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initval</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakKeyDictionary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initval</span> <span class="o">=</span> <span class="n">initval</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">evb</span> <span class="o">=</span> <span class="n">GetCurrentVariableBuffer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">evb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span><span class="p">[</span><span class="n">evb</span><span class="p">]</span> <span class="o">=</span> <span class="n">evb</span><span class="o">.</span><span class="n">CreateVarTrigger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initval</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span><span class="p">[</span><span class="n">evb</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">EUDVariable</span><span class="p">(</span><span class="n">VariableBase</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Full variable.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initval</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vartrigger</span> <span class="o">=</span> <span class="n">VariableTriggerForward</span><span class="p">(</span><span class="n">initval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vartrigger</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetVTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vartrigger</span>

    <span class="k">def</span> <span class="nf">getValueAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">+</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">QueueAssignTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">EPD</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">+</span> <span class="mi">24</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0x072D0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">QueueAddTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">EPD</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">+</span> <span class="mi">24</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0x082D0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">QueueSubtractTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">EPD</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_varact</span> <span class="o">+</span> <span class="mi">24</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0x092D0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">SeqCompute</span><span class="p">((</span>
            <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
        <span class="p">))</span>

    <span class="k">def</span> <span class="nf">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">SeqCompute</span><span class="p">(((</span><span class="bp">self</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">other</span><span class="p">),))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>

        <span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="o">-</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">),</span>
            <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtMost</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
            <span class="n">SeqCompute</span><span class="p">((</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
            <span class="n">SeqCompute</span><span class="p">((</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;[Warning] No unsigned number can be leq than </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">other</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">Never</span><span class="p">()]</span>  <span class="c1"># No unsigned number is less than 0</span>

        <span class="k">if</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtMost</span><span class="p">(</span><span class="n">other</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
            <span class="n">SeqCompute</span><span class="p">((</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span> <span class="o">&gt;=</span> <span class="mh">0xFFFFFFFF</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;[Warning] No unsigned int can be greater than </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">other</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">Never</span><span class="p">()]</span>  <span class="c1"># No unsigned number is less than 0</span>

        <span class="k">if</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="n">other</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
            <span class="n">SeqCompute</span><span class="p">((</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
                <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># operator placeholders</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__imod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__iand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__ixor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">def</span> <span class="nf">IsEUDVariable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">unProxy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">EUDVariable</span><span class="p">)</span>


<span class="c1"># ---------</span>


<span class="k">def</span> <span class="nf">_VProc</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="n">nexttrg</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>

    <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">nextptr</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">GetVTable</span><span class="p">(),</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">actions</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">GetVTable</span><span class="p">(),</span> <span class="n">nexttrg</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="n">nexttrg</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="c1"># From vbuffer.py</span>
<span class="k">def</span> <span class="nf">EUDCreateVariables</span><span class="p">(</span><span class="n">varn</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">List2Assignable</span><span class="p">([</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">varn</span><span class="p">)])</span>


<span class="c1"># -------</span>

<span class="k">def</span> <span class="nf">_GetComputeDest</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EPD</span><span class="p">(</span><span class="n">dst</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dst</span>


<span class="k">def</span> <span class="nf">_SeqComputeSub</span><span class="p">(</span><span class="n">assignpairs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subset of SeqCompute with following restrictions</span>

<span class="sd">    - Assignment from variable should be after assignment from constant.</span>
<span class="sd">    - Total number of actions should be leq than 64</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">actionlist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Collect constant-assigning actions</span>
    <span class="n">const_assigning_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignpairs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">assignpair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">assignpairs</span><span class="p">):</span>
        <span class="n">dst</span><span class="p">,</span> <span class="n">mdt</span><span class="p">,</span> <span class="n">src</span> <span class="o">=</span> <span class="n">assignpair</span>
        <span class="k">if</span> <span class="n">IsEUDVariable</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">const_assigning_index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>

    <span class="k">for</span> <span class="n">dst</span><span class="p">,</span> <span class="n">mdt</span><span class="p">,</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">assignpairs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">const_assigning_index</span><span class="p">]:</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">_GetComputeDest</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
        <span class="n">actionlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">mdt</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="c1"># Only constant-assigning function : skip</span>
    <span class="k">if</span> <span class="n">const_assigning_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignpairs</span><span class="p">):</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">actionlist</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">#</span>
    <span class="c1"># Rest is for non-constant assigning actions</span>
    <span class="c1">#</span>

    <span class="n">nextptr</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># nextptr for this rawtrigger</span>
    <span class="n">vt_nextptr</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># what to set for nextptr of current vtable</span>

    <span class="k">for</span> <span class="n">dst</span><span class="p">,</span> <span class="n">mdt</span><span class="p">,</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">assignpairs</span><span class="p">[</span><span class="n">const_assigning_index</span><span class="p">:]:</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">_GetComputeDest</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nextptr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nextptr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetVTable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vt_nextptr</span> <span class="o">&lt;&lt;</span> <span class="n">src</span><span class="o">.</span><span class="n">GetVTable</span><span class="p">()</span>

        <span class="n">vt_nextptr</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">queuef</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">:</span> <span class="n">EUDVariable</span><span class="o">.</span><span class="n">QueueAssignTo</span><span class="p">,</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">:</span> <span class="n">EUDVariable</span><span class="o">.</span><span class="n">QueueAddTo</span><span class="p">,</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">:</span> <span class="n">EUDVariable</span><span class="o">.</span><span class="n">QueueSubtractTo</span><span class="p">,</span>
        <span class="p">}[</span><span class="n">mdt</span><span class="p">]</span>

        <span class="n">actionlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
            <span class="n">queuef</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">),</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">GetVTable</span><span class="p">(),</span> <span class="n">vt_nextptr</span><span class="p">)</span>
        <span class="p">])</span>

    <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">nextptr</span><span class="o">=</span><span class="n">nextptr</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="n">actionlist</span>
    <span class="p">)</span>

    <span class="n">vt_nextptr</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">SeqCompute</span><span class="p">(</span><span class="n">assignpairs</span><span class="p">):</span>
    <span class="c1"># We need dependency map while writing assignment pairs</span>
    <span class="n">dstvarset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">srcvarset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># Sublist of assignments to put in _SeqComputeSub</span>
    <span class="n">subassignpairs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Is we collecting constant-assigning pairs?</span>
    <span class="n">constcollecting</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># Number of expected actions.</span>
    <span class="n">actioncount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">FlushPairs</span><span class="p">():</span>
        <span class="n">nonlocal</span> <span class="n">constcollecting</span><span class="p">,</span> <span class="n">actioncount</span>

        <span class="k">if</span> <span class="n">actioncount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Already flushed before</span>
            <span class="k">return</span>

        <span class="n">_SeqComputeSub</span><span class="p">(</span><span class="n">subassignpairs</span><span class="p">)</span>

        <span class="n">dstvarset</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">srcvarset</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">subassignpairs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">constcollecting</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">actioncount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">assignpair</span> <span class="ow">in</span> <span class="n">assignpairs</span><span class="p">:</span>
        <span class="n">dst</span><span class="p">,</span> <span class="n">mdt</span><span class="p">,</span> <span class="n">src</span> <span class="o">=</span> <span class="n">assignpair</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">unProxy</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">unProxy</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

        <span class="c1"># Flush action set before preceeding</span>
        <span class="k">if</span> <span class="n">IsEUDVariable</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">dstvarset</span><span class="p">:</span>
                <span class="n">FlushPairs</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">srcvarset</span><span class="p">:</span>
                <span class="n">FlushPairs</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">actioncount</span> <span class="o">&gt;=</span> <span class="mi">64</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">FlushPairs</span><span class="p">()</span>

            <span class="n">srcvarset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
            <span class="n">constcollecting</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">actioncount</span> <span class="o">+=</span> <span class="mi">3</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">constcollecting</span><span class="p">:</span>
                <span class="n">FlushPairs</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">actioncount</span> <span class="o">&gt;=</span> <span class="mi">64</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">FlushPairs</span><span class="p">()</span>

            <span class="n">actioncount</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">subassignpairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assignpair</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">IsEUDVariable</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
            <span class="n">dstvarset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

    <span class="n">FlushPairs</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">SetVariables</span><span class="p">(</span><span class="n">srclist</span><span class="p">,</span> <span class="n">dstlist</span><span class="p">,</span> <span class="n">mdtlist</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">srclist</span> <span class="o">=</span> <span class="n">FlattenList</span><span class="p">(</span><span class="n">srclist</span><span class="p">)</span>
    <span class="n">dstlist</span> <span class="o">=</span> <span class="n">FlattenList</span><span class="p">(</span><span class="n">dstlist</span><span class="p">)</span>
    <span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">srclist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dstlist</span><span class="p">),</span> <span class="s1">&#39;Input/output size mismatch&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mdtlist</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mdtlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">srclist</span><span class="p">)</span>

    <span class="n">sqa</span> <span class="o">=</span> <span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">mdt</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">mdt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">srclist</span><span class="p">,</span> <span class="n">dstlist</span><span class="p">,</span> <span class="n">mdtlist</span><span class="p">)]</span>
    <span class="n">SeqCompute</span><span class="p">(</span><span class="n">sqa</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\structarr.py : 71 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.vararray</span> <span class="kn">import</span> <span class="n">EUDVArray</span>
<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="n">ExprProxy</span>


<span class="k">class</span> <span class="nc">_EUDStruct_Metaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="n">basetype</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">class</span> <span class="nc">EUDStructArray</span><span class="p">(</span><span class="n">ExprProxy</span><span class="p">):</span>
            <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">_EUDStruct_Metaclass</span>

            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initvar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">initvar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">initvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">basetype</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">)]</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">EUDVArray</span><span class="p">(</span><span class="n">initvals</span><span class="p">,</span> <span class="n">basetype</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">EUDVArray</span><span class="p">(</span><span class="n">initvar</span><span class="p">,</span> <span class="n">basetype</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot; Create struct clone &quot;&quot;&quot;</span>
                <span class="n">arraytype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">inst</span> <span class="o">=</span> <span class="n">arraytype</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">inst</span>

            <span class="k">def</span> <span class="nf">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot; Copy struct to other instance &quot;&quot;&quot;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">inst</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">newval</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">newval</span>

            <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">EUDStructArray</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\vararray.py : 135 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">rawtrigger</span> <span class="k">as</span> <span class="n">bt</span>
<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Evaluate</span><span class="p">,</span>
    <span class="n">Forward</span><span class="p">,</span>
    <span class="n">ConstExpr</span><span class="p">,</span>
    <span class="n">IsConstExpr</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">...utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EPD</span><span class="p">,</span>
    <span class="n">ExprProxy</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.eudv</span> <span class="kn">import</span> <span class="n">EUDVariable</span><span class="p">,</span> <span class="n">SeqCompute</span>
<span class="kn">from</span> <span class="nn">.vbuf</span> <span class="kn">import</span> <span class="n">GetCurrentVariableBuffer</span>


<span class="k">class</span> <span class="nc">EUDVArrayData</span><span class="p">(</span><span class="n">ConstExpr</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initvars</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initvars</span> <span class="o">=</span> <span class="n">initvars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakKeyDictionary</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">evb</span> <span class="o">=</span> <span class="n">GetCurrentVariableBuffer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">evb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span><span class="p">:</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">evb</span><span class="o">.</span><span class="n">CreateVarTrigger</span><span class="p">(</span><span class="n">ival</span><span class="p">)</span> <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initvars</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span><span class="p">[</span><span class="n">evb</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vdict</span><span class="p">[</span><span class="n">evb</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">EUDVArray</span><span class="p">(</span><span class="n">ExprProxy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initvars</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initvars</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">initvars</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">initvars</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initvars</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
            <span class="n">baseobj</span> <span class="o">=</span> <span class="n">EUDVArrayData</span><span class="p">(</span><span class="n">initvars</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">IsConstExpr</span><span class="p">(</span><span class="n">initvars</span><span class="p">):</span>
            <span class="n">baseobj</span> <span class="o">=</span> <span class="n">initvars</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baseobj</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
            <span class="n">baseobj</span> <span class="o">&lt;&lt;</span> <span class="n">initvars</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">baseobj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epd</span> <span class="o">=</span> <span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span> <span class="o">=</span> <span class="n">basetype</span>

    <span class="k">def</span> <span class="nf">getItemPtr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">getItemEPD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epd</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="c1"># This function is hand-optimized</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">itemptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getItemPtr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">itemepd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getItemEPD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">vtproc</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">nptr</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">(),</span> <span class="n">Forward</span><span class="p">(),</span> <span class="n">Forward</span><span class="p">()</span>

        <span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">vtproc</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">itemptr</span><span class="p">),</span>
            <span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">itemepd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">itemepd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">24</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">itemepd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="n">vtproc</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">a0</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">EPD</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">()),</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">a1</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0x072D0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">a2</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">nptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">nptr</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">itemepd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getItemEPD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">(),</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">itemepd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="n">EPD</span><span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="mi">20</span><span class="p">),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">a0</span> <span class="o">&lt;&lt;</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\vbase.py : 103 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">rawtrigger</span> <span class="k">as</span> <span class="n">bt</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">class</span> <span class="nc">VariableBase</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">getValueAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;override&#39;</span><span class="p">)</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">AtLeast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bt</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span> <span class="n">bt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">AtMost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bt</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span> <span class="n">bt</span><span class="o">.</span><span class="n">AtMost</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Exactly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bt</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span> <span class="n">bt</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">SetNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">AddNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span> <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">SubtractNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span> <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span>
                <span class="n">value</span>
            <span class="p">)</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span>
                <span class="n">value</span>
            <span class="p">)</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getValueAddr</span><span class="p">(),</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span>
                <span class="n">value</span>
            <span class="p">)</span>
        <span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># -------</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtMost</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\vbuf.py : 82 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..eudobj</span> <span class="kn">import</span> <span class="n">EUDObject</span>
<span class="kn">from</span> <span class="nn">..allocator</span> <span class="kn">import</span> <span class="n">RegisterCreatePayloadCallback</span>


<span class="k">class</span> <span class="nc">EUDVarBuffer</span><span class="p">(</span><span class="n">EUDObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Variable buffer</span>

<span class="sd">    40 bytes per variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">DynamicConstructed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">CreateVarTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initval</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initval</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emitbuffer</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">2408</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span><span class="p">)):</span>
            <span class="c1"># &#39;preserve rawtrigger&#39;</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">60</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2376</span><span class="p">:</span><span class="mi">60</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2380</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\x04\0\0\0</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">initval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span><span class="p">):</span>
            <span class="n">heads</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">352</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">heade</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">348</span>
            <span class="n">emitbuffer</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">heads</span><span class="p">:</span><span class="n">heade</span><span class="p">])</span>
            <span class="n">emitbuffer</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="n">initval</span><span class="p">)</span>
            <span class="c1"># output[60 * i + 320 + 20:60 * i + 320 + 24] = ut.i2b4(initval)</span>

        <span class="n">tails</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">352</span>
        <span class="n">emitbuffer</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">tails</span><span class="p">:])</span>

<span class="n">_evb</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">RegisterNewVariableBuffer</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_evb</span>
    <span class="n">_evb</span> <span class="o">=</span> <span class="n">EUDVarBuffer</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">GetCurrentVariableBuffer</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_evb</span>


<span class="n">RegisterCreatePayloadCallback</span><span class="p">(</span><span class="n">RegisterNewVariableBuffer</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\core\varfunc\__init__.py : 42 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.eudv</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDVariable</span><span class="p">,</span>
    <span class="n">IsEUDVariable</span><span class="p">,</span>
    <span class="n">EUDCreateVariables</span><span class="p">,</span>
    <span class="n">SeqCompute</span><span class="p">,</span>
    <span class="n">SetVariables</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.vararray</span> <span class="kn">import</span> <span class="n">EUDVArray</span>
<span class="kn">from</span> <span class="nn">.eudstruct</span> <span class="kn">import</span> <span class="n">EUDStruct</span>

<span class="kn">from</span> <span class="nn">.eudlv</span> <span class="kn">import</span> <span class="n">EUDLightVariable</span>
<span class="kn">from</span> <span class="nn">.eudf</span> <span class="kn">import</span> <span class="n">EUDFunc</span>
<span class="kn">from</span> <span class="nn">.eudfptr</span> <span class="kn">import</span> <span class="n">EUDFuncPtr</span>
<span class="kn">from</span> <span class="nn">.eudfmethod</span> <span class="kn">import</span> <span class="n">EUDFuncMethod</span>
<span class="kn">from</span> <span class="nn">.eudfuncn</span> <span class="kn">import</span> <span class="n">EUDFuncN</span><span class="p">,</span> <span class="n">EUDReturn</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\ctrlstru\basicstru.py : 68 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">trigger</span> <span class="k">as</span> <span class="n">tg</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">def</span> <span class="nf">DoActions</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">preserved</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">tg</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">actions</span><span class="p">),</span> <span class="n">preserved</span><span class="o">=</span><span class="n">preserved</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDJump</span><span class="p">(</span><span class="n">nextptr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nextptr</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">nextptr</span><span class="p">)])</span>
        <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">nextptr</span><span class="o">=</span><span class="n">nextptr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">ontrue</span><span class="p">):</span>
    <span class="n">onfalse</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">tg</span><span class="o">.</span><span class="n">EUDBranch</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">ontrue</span><span class="p">,</span> <span class="n">onfalse</span><span class="p">)</span>
    <span class="n">onfalse</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">EUDJumpIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">onfalse</span><span class="p">):</span>
    <span class="n">ontrue</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">tg</span><span class="o">.</span><span class="n">EUDBranch</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">ontrue</span><span class="p">,</span> <span class="n">onfalse</span><span class="p">)</span>
    <span class="n">ontrue</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">EUDTernary</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">ontrue</span><span class="p">,</span> <span class="n">onfalse</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">onfalse</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">ontrue</span>
    <span class="n">end</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\ctrlstru\breakcont.py : 91 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">loopblock</span> <span class="k">as</span> <span class="n">lb</span><span class="p">,</span>
    <span class="n">swblock</span> <span class="k">as</span> <span class="n">sb</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">def</span> <span class="nf">EUDContinue</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopContinue</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">EUDContinueIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopContinueIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDContinueIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopContinueIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDSetContinuePoint</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopSetContinuePoint</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">EUDIsContinuePointSet</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopIsContinuePointSet</span><span class="p">()</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">EUDBreak</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EUDGetBlockList</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">_IsLoopBlock</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopBreak</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">sb</span><span class="o">.</span><span class="n">_IsSwitchBlockId</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">sb</span><span class="o">.</span><span class="n">EUDSwitchBreak</span><span class="p">()</span>
            <span class="k">return</span>

    <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;No loop/switch block surrounding this code area&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDBreakIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EUDGetBlockList</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">_IsLoopBlock</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopBreakIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">sb</span><span class="o">.</span><span class="n">_IsSwitchBlockId</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">sb</span><span class="o">.</span><span class="n">EUDSwitchBreakIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;No loop/switch block surrounding this code area&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDBreakIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EUDGetBlockList</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">_IsLoopBlock</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">lb</span><span class="o">.</span><span class="n">EUDLoopBreakIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">sb</span><span class="o">.</span><span class="n">_IsSwitchBlockId</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">sb</span><span class="o">.</span><span class="n">EUDSwitchBreakIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;No loop/switch block surrounding this code area&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\ctrlstru\cshelper.py : 47 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">CtrlStruOpener</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_called</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_called</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;Control structures must be double-parenthesised.&#39;</span> <span class="o">+</span>
                <span class="s1">&#39; ex) EUDInfLoop()()&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s1">&#39;Control structures must be double-parenthesised.&#39;</span> <span class="o">+</span>
            <span class="s1">&#39; ex) EUDInfLoop()()&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_called</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\ctrlstru\loopblock.py : 214 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.basicstru</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDJump</span><span class="p">,</span>
    <span class="n">EUDJumpIf</span><span class="p">,</span>
    <span class="n">EUDJumpIfNot</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.cshelper</span> <span class="kn">import</span> <span class="n">CtrlStruOpener</span>


<span class="k">def</span> <span class="nf">_IsLoopBlock</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;contpoint&#39;</span> <span class="ow">in</span> <span class="n">block</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">EUDInfLoop</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;loopstart&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">(),</span>
            <span class="s1">&#39;loopend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
            <span class="s1">&#39;contpoint&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;infloopblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDEndInfLoop</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;infloopblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IsSet</span><span class="p">():</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopstart&#39;</span><span class="p">]</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopstart&#39;</span><span class="p">])</span>
    <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">EUDLoopN</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">vardb</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">vardb</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;loopstart&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">(),</span>
            <span class="s1">&#39;loopend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
            <span class="s1">&#39;contpoint&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
            <span class="s1">&#39;vardb&#39;</span><span class="p">:</span> <span class="n">vardb</span>
        <span class="p">}</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;loopnblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
        <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="n">vardb</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDEndLoopN</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;loopnblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IsSet</span><span class="p">():</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="n">vardb</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;vardb&#39;</span><span class="p">]</span>
    <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">vardb</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopstart&#39;</span><span class="p">])</span>
    <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">EUDLoopRange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;looprangeblock&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">start</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">start</span>
    <span class="k">if</span> <span class="n">EUDWhile</span><span class="p">()(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">v</span>
        <span class="n">EUDLoopSetContinuePoint</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">EUDEndWhile</span><span class="p">()</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;looprangeblock&#39;</span><span class="p">)</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">EUDWhile</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_header</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;loopstart&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">(),</span>
            <span class="s1">&#39;loopend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
            <span class="s1">&#39;contpoint&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;whileblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPeekBlock</span><span class="p">(</span><span class="s1">&#39;whileblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">_header</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDWhileNot</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_header</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;loopstart&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">(),</span>
            <span class="s1">&#39;loopend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
            <span class="s1">&#39;contpoint&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;whileblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPeekBlock</span><span class="p">(</span><span class="s1">&#39;whileblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">_header</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDEndWhile</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;whileblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IsSet</span><span class="p">():</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopstart&#39;</span><span class="p">]</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopstart&#39;</span><span class="p">])</span>
    <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">_GetLastLoopBlock</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EUDGetBlockList</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">_IsLoopBlock</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">block</span>

    <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;No loop block surrounding this code area&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDLoopContinue</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDLoopContinueIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDLoopContinueIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDLoopIsContinuePointSet</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IsSet</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">EUDLoopSetContinuePoint</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">block</span><span class="p">[</span><span class="s1">&#39;contpoint&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">EUDLoopBreak</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDLoopBreakIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDLoopBreakIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">_GetLastLoopBlock</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;loopend&#39;</span><span class="p">])</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\ctrlstru\simpleblock.py : 170 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.basicstru</span> <span class="kn">import</span> <span class="n">EUDJump</span><span class="p">,</span> <span class="n">EUDJumpIf</span><span class="p">,</span> <span class="n">EUDJumpIfNot</span>
<span class="kn">from</span> <span class="nn">.cshelper</span> <span class="kn">import</span> <span class="n">CtrlStruOpener</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">There are code duplication between EUDIf - EUDIfNot, EUDElseIf - EUDElseIfNot.</span>
<span class="sd">TODO : Remove code duplication if possible.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">EUDIf</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ifend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
            <span class="s1">&#39;next_elseif&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

        <span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDIfNot</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ifend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
            <span class="s1">&#39;next_elseif&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

        <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="c1"># -------</span>

<span class="k">def</span> <span class="nf">EUDElseIf</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_header</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPeekBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s1">&#39;Cannot have EUDElseIf after EUDElse&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Finish previous if/elseif block</span>
        <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;ifend&#39;</span><span class="p">])</span>

        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPeekBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">)</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">_header</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDElseIfNot</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_header</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPeekBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s1">&#39;Cannot have EUDElseIfNot after EUDElse&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Finish previous if/elseif block</span>
        <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;ifend&#39;</span><span class="p">])</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPeekBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">_header</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">EUDElse</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPeekBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
            <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s1">&#39;Cannot have EUDElse after EUDElse&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Finish previous if/elseif block</span>
        <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;ifend&#39;</span><span class="p">])</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDEndIf</span><span class="p">():</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;ifblock&#39;</span><span class="p">)</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Finalize</span>
    <span class="n">nei_fw</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;next_elseif&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nei_fw</span><span class="p">:</span>
        <span class="n">nei_fw</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="n">block</span><span class="p">[</span><span class="s1">&#39;ifend&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>


<span class="c1"># -------</span>

<span class="k">def</span> <span class="nf">EUDExecuteOnce</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;blockend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;executeonceblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

        <span class="n">tv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDLightVariable</span><span class="p">()</span>
        <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">tv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;blockend&#39;</span><span class="p">])</span>
        <span class="n">tv</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDEndExecuteOnce</span><span class="p">():</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;executeonceblock&#39;</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">lb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;executeonceblock&#39;</span><span class="p">,</span> <span class="s1">&#39;Block start/end mismatch&#39;</span><span class="p">)</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">block</span><span class="p">[</span><span class="s1">&#39;blockend&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\ctrlstru\swblock.py : 142 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">trigger</span> <span class="k">as</span> <span class="n">tg</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.basicstru</span> <span class="kn">import</span> <span class="n">EUDJump</span><span class="p">,</span> <span class="n">EUDJumpIf</span><span class="p">,</span> <span class="n">EUDJumpIfNot</span>
<span class="kn">from</span> <span class="nn">.cshelper</span> <span class="kn">import</span> <span class="n">CtrlStruOpener</span>


<span class="k">def</span> <span class="nf">_IsSwitchBlockId</span><span class="p">(</span><span class="n">idf</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">idf</span> <span class="o">==</span> <span class="s1">&#39;swblock&#39;</span>


<span class="k">def</span> <span class="nf">EUDSwitch</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;targetvar&#39;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span>
        <span class="s1">&#39;casebrlist&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;defaultbr&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
        <span class="s1">&#39;swend&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">()</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;swblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">EUDSwitchCase</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">(</span><span class="o">*</span><span class="n">numbers</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">ConstExpr</span><span class="p">),</span>
                <span class="s1">&#39;Invalid selector start for EUDSwitch&#39;</span>
            <span class="p">)</span>

        <span class="n">lb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDGetLastBlock</span><span class="p">()</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">lb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;swblock&#39;</span><span class="p">,</span> <span class="s1">&#39;Block start/end mismatch&#39;</span><span class="p">)</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;casebrlist&#39;</span><span class="p">],</span> <span class="s1">&#39;Duplicate cases&#39;</span><span class="p">)</span>
            <span class="n">block</span><span class="p">[</span><span class="s1">&#39;casebrlist&#39;</span><span class="p">][</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDSwitchDefault</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">():</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDGetLastBlock</span><span class="p">()</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">lb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;swblock&#39;</span><span class="p">,</span> <span class="s1">&#39;Block start/end mismatch&#39;</span><span class="p">)</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="ow">not</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;defaultbr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IsSet</span><span class="p">(),</span> <span class="s1">&#39;Duplicate default&#39;</span><span class="p">)</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;defaultbr&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDSwitchBreak</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDGetLastBlockOfName</span><span class="p">(</span><span class="s1">&#39;swblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;swend&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDSwitchBreakIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDGetLastBlockOfName</span><span class="p">(</span><span class="s1">&#39;swblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;swend&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDSwitchBreakIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDGetLastBlockOfName</span><span class="p">(</span><span class="s1">&#39;swblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;swend&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">EUDEndSwitch</span><span class="p">():</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;swblock&#39;</span><span class="p">)</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">swend</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;swend&#39;</span><span class="p">]</span>
    <span class="n">EUDJump</span><span class="p">(</span><span class="n">swend</span><span class="p">)</span>  <span class="c1"># Exit switch block</span>
    <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

    <span class="c1"># If default block is not specified, skip it</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;defaultbr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IsSet</span><span class="p">():</span>
        <span class="n">block</span><span class="p">[</span><span class="s1">&#39;defaultbr&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">swend</span>

    <span class="c1"># Create key selector</span>
    <span class="n">casebrlist</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;casebrlist&#39;</span><span class="p">]</span>
    <span class="n">defbranch</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;defaultbr&#39;</span><span class="p">]</span>
    <span class="n">casekeylist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="s1">&#39;casebrlist&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;targetvar&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">KeySelector</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
        <span class="c1"># Uses simple binary search</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Only one keys on the list</span>
            <span class="n">tg</span><span class="o">.</span><span class="n">EUDBranch</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">casebrlist</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">defbranch</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">br1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
            <span class="n">br2</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
            <span class="n">midpos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">midval</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">midpos</span><span class="p">]</span>
            <span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">midval</span><span class="p">,</span> <span class="n">casebrlist</span><span class="p">[</span><span class="n">midval</span><span class="p">])</span>
            <span class="n">tg</span><span class="o">.</span><span class="n">EUDBranch</span><span class="p">(</span><span class="n">var</span> <span class="o">&lt;=</span> <span class="n">midval</span><span class="p">,</span> <span class="n">br1</span><span class="p">,</span> <span class="n">br2</span><span class="p">)</span>
            <span class="n">br1</span> <span class="o">&lt;&lt;</span> <span class="n">KeySelector</span><span class="p">(</span><span class="n">keys</span><span class="p">[:</span><span class="n">midpos</span><span class="p">])</span>
            <span class="n">br2</span> <span class="o">&lt;&lt;</span> <span class="n">KeySelector</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">midpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># len(keys) == 0</span>
            <span class="k">return</span> <span class="n">defbranch</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="n">KeySelector</span><span class="p">(</span><span class="n">casekeylist</span><span class="p">)</span>

    <span class="n">swend</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\ctrlstru\__init__.py : 80 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.cshelper</span> <span class="kn">import</span> <span class="n">CtrlStruOpener</span>

<span class="kn">from</span> <span class="nn">.basicstru</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DoActions</span><span class="p">,</span>
    <span class="n">EUDJump</span><span class="p">,</span>
    <span class="n">EUDJumpIf</span><span class="p">,</span>
    <span class="n">EUDJumpIfNot</span><span class="p">,</span>
    <span class="n">EUDTernary</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.simpleblock</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDIf</span><span class="p">,</span>
    <span class="n">EUDIfNot</span><span class="p">,</span>
    <span class="n">EUDElseIf</span><span class="p">,</span>
    <span class="n">EUDElseIfNot</span><span class="p">,</span>
    <span class="n">EUDElse</span><span class="p">,</span>
    <span class="n">EUDEndIf</span><span class="p">,</span>

    <span class="n">EUDExecuteOnce</span><span class="p">,</span>
    <span class="n">EUDEndExecuteOnce</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.loopblock</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDInfLoop</span><span class="p">,</span>
    <span class="n">EUDEndInfLoop</span><span class="p">,</span>

    <span class="n">EUDLoopN</span><span class="p">,</span>
    <span class="n">EUDEndLoopN</span><span class="p">,</span>

    <span class="n">EUDLoopRange</span><span class="p">,</span>

    <span class="n">EUDWhile</span><span class="p">,</span>
    <span class="n">EUDWhileNot</span><span class="p">,</span>
    <span class="n">EUDEndWhile</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.swblock</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDSwitch</span><span class="p">,</span>
    <span class="n">EUDSwitchCase</span><span class="p">,</span>
    <span class="n">EUDSwitchDefault</span><span class="p">,</span>
    <span class="n">EUDEndSwitch</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.breakcont</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDContinue</span><span class="p">,</span>
    <span class="n">EUDContinueIf</span><span class="p">,</span>
    <span class="n">EUDContinueIfNot</span><span class="p">,</span>
    <span class="n">EUDSetContinuePoint</span><span class="p">,</span>
    <span class="n">EUDIsContinuePointSet</span><span class="p">,</span>

    <span class="n">EUDBreak</span><span class="p">,</span>
    <span class="n">EUDBreakIf</span><span class="p">,</span>
    <span class="n">EUDBreakIfNot</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\eudarray.py : 104 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.memiof</span> <span class="kn">import</span> <span class="n">f_dwread_epd</span><span class="p">,</span> <span class="n">f_dwwrite_epd</span>


<span class="k">class</span> <span class="nc">EUDArrayData</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">EUDObject</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Structure for storing multiple values.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">arrlen</span> <span class="o">=</span> <span class="n">arr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">arrlen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arrlen</span> <span class="o">=</span> <span class="n">arrlen</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">IsConstExpr</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="s1">&#39;Invalid item #</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datas</span> <span class="o">=</span> <span class="n">arr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arrlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrlen</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datas</span><span class="p">:</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># --------</span>

    <span class="k">def</span> <span class="nf">GetArraySize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get size of array &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrlen</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EUDArray</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ExprProxy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initval</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">initval</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">initval</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">dataObj</span> <span class="o">=</span> <span class="n">EUDArrayData</span><span class="p">(</span><span class="n">initval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataObj</span> <span class="o">=</span> <span class="n">initval</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">dataObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epd</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_epd</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_epd</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\eudgrp.py : 72 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">import</span> <span class="nn">struct</span>


<span class="k">class</span> <span class="nc">EUDGrp</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">EUDObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object for GRP</span>

<span class="sd">    Starcraft modifies GRP in certain way before it is used ingame. This object</span>
<span class="sd">    emulates that modification so that SC recognizes GRP correctly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="n">content</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">GetObjectAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\0\0</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># 2byte padding to align dwords at (*)</span>

        <span class="c1"># fill in grp header</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span>
        <span class="n">fn</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;HHH&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">WriteWord</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">WriteWord</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">WriteWord</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="c1"># fill in grp frame headers table</span>
        <span class="n">selfaddr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Evaluate</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="n">fhoffset</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">lto</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
                <span class="s1">&#39;&lt;BBBBI&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">fhoffset</span><span class="p">:</span> <span class="n">fhoffset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">])</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">WriteByte</span><span class="p">(</span><span class="n">xoff</span><span class="p">)</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">WriteByte</span><span class="p">(</span><span class="n">yoff</span><span class="p">)</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">WriteByte</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">WriteByte</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="n">lto</span> <span class="o">+</span> <span class="n">selfaddr</span><span class="p">)</span>  <span class="c1"># (*)</span>

        <span class="n">buf</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">fn</span><span class="p">:])</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\eudstack.py : 57 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.eudarray</span> <span class="kn">import</span> <span class="n">EUDArray</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>


<span class="k">class</span> <span class="nc">EUDStack</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">EUDStruct</span><span class="p">):</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">EUDArray</span><span class="p">),</span>
        <span class="s1">&#39;pos&#39;</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">([</span>
            <span class="c1"># data</span>
            <span class="n">EUDArray</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="mi">0</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span> <span class="o">=</span> <span class="n">basetype</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\__init__.py : 35 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.memiof</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.stringf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.utilf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.qgcf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.mathf</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">.eudarray</span> <span class="kn">import</span> <span class="n">EUDArray</span>
<span class="kn">from</span> <span class="nn">.eudgrp</span> <span class="kn">import</span> <span class="n">EUDGrp</span>
<span class="kn">from</span> <span class="nn">.eudstack</span> <span class="kn">import</span> <span class="n">EUDStack</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\mathf\atan2.py : 108 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># Formula source : http://nghiaho.com/?p=997</span>

<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">signflags</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">signflags</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>

    <span class="c1"># Check x sign</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mh">0x80000000</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="n">x</span>
        <span class="n">signflags</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># set xsign</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="c1"># Check y sign</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mh">0x80000000</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="n">y</span>
        <span class="n">signflags</span> <span class="o">+=</span> <span class="mi">2</span>  <span class="c1"># set ysign</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="c1"># Check x/y order</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="c1"># Swap x, y so that y &lt;= x</span>
        <span class="n">z</span> <span class="o">&lt;&lt;</span> <span class="n">x</span>
        <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">y</span>
        <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">z</span>
        <span class="n">signflags</span> <span class="o">+=</span> <span class="mi">4</span>  <span class="c1"># set xyabscmp</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="c1"># To prevent overflow, we limit values of y and x.</span>
    <span class="c1"># atan value is maximized when x = y, then atan_value = 45 * x**3</span>
    <span class="c1"># 45 * x**3 &lt;= 0xFFFFFFFF : x &lt;= 456.99....</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">):</span>
        <span class="c1"># Normalize below 400</span>
        <span class="n">divn</span> <span class="o">=</span> <span class="n">x</span> <span class="o">//</span> <span class="mi">400</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">x</span> <span class="o">//=</span> <span class="n">divn</span>
        <span class="n">y</span> <span class="o">//=</span> <span class="n">divn</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="c1"># Calculate arctan value</span>
    <span class="c1"># arctan(z) ~= z * (45 - (z-1) * (14 + 4*z)), 0 &lt;= z &lt;= 1</span>
    <span class="c1"># arctan(y/x) ~= y/x * (45 - (y-x)/x * (14x + 4y)/x))</span>
    <span class="c1"># arctan(y/x) ~= y * (45*x*x - (y-x)(14x+4y)) / (x*x*x)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mi">45</span> <span class="o">*</span> <span class="n">t1</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">14</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">t1</span>
    <span class="n">atan_value</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">//</span> <span class="n">t3</span>

    <span class="c1"># Translate angles by sign flags</span>
    <span class="c1">#</span>
    <span class="c1">#      |  0 |  1 | xsign          |  0 |  1 | xsign</span>
    <span class="c1"># -----+----+----+-----      -----+----+----+-----</span>
    <span class="c1">#   0  |  0+|180-|             0  | 90-| 90+|</span>
    <span class="c1"># -----+----+----+           -----+----+----+</span>
    <span class="c1">#   1  |360-|180+|             1  |270+|270-|</span>
    <span class="c1"># -----+----+----+           -----+----+----+</span>
    <span class="c1"># ysign|      xyabscmp=0     ysign|      xyabscmp=1</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitch</span><span class="p">(</span><span class="n">signflags</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 0, 0, 0</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 1, 0, 0</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 0, 1, 0</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">360</span> <span class="o">-</span> <span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 1, 1, 0</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 0, 0, 1</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 1, 0, 1</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">90</span> <span class="o">+</span> <span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 0, 1, 1</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">270</span> <span class="o">+</span> <span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSwitchCase</span><span class="p">()(</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># xsign, ysign, xyabscmp = 1, 1, 1</span>
    <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">270</span> <span class="o">-</span> <span class="n">atan_value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndSwitch</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\mathf\lengthdir.py : 111 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="n">f_dwread_epd</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_lengthdir</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="c1"># sin, cos table</span>
    <span class="n">clist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">slist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">91</span><span class="p">):</span>
        <span class="n">cosv</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="mi">65536</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">sinv</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="mi">65536</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">clist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">cosv</span><span class="p">))</span>
        <span class="n">slist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">sinv</span><span class="p">))</span>

    <span class="n">cdb</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">clist</span><span class="p">))</span>
    <span class="n">sdb</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slist</span><span class="p">))</span>

    <span class="c1"># MAIN LOGIC</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">angle</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">):</span>
        <span class="n">angle</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">f_div</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="mi">360</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ldir_x</span><span class="p">,</span> <span class="n">ldir_y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>  <span class="c1"># cos, sin * 65536</span>
    <span class="c1"># sign of cos, sin</span>
    <span class="n">csign</span><span class="p">,</span> <span class="n">ssign</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDLightVariable</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDLightVariable</span><span class="p">()</span>
    <span class="n">tableangle</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># get cos, sin from table</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">89</span><span class="p">):</span>
        <span class="n">tableangle</span> <span class="o">&lt;&lt;</span> <span class="n">angle</span>
        <span class="n">csign</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
        <span class="n">ssign</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElseIf</span><span class="p">()(</span><span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">179</span><span class="p">):</span>
        <span class="n">tableangle</span> <span class="o">&lt;&lt;</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">angle</span>
        <span class="n">csign</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">ssign</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElseIf</span><span class="p">()(</span><span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">269</span><span class="p">):</span>
        <span class="n">tableangle</span> <span class="o">&lt;&lt;</span> <span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">csign</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">ssign</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">()():</span>
        <span class="n">tableangle</span> <span class="o">&lt;&lt;</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">angle</span>
        <span class="n">csign</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
        <span class="n">ssign</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">tablecos</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">cdb</span><span class="p">)</span> <span class="o">+</span> <span class="n">tableangle</span><span class="p">)</span>
    <span class="n">tablesin</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">sdb</span><span class="p">)</span> <span class="o">+</span> <span class="n">tableangle</span><span class="p">)</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># calculate lengthdir</span>
    <span class="n">ldir_x</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">f_div</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">f_mul</span><span class="p">(</span><span class="n">tablecos</span><span class="p">,</span> <span class="n">length</span><span class="p">),</span> <span class="mi">65536</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ldir_y</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">f_div</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">f_mul</span><span class="p">(</span><span class="n">tablesin</span><span class="p">,</span> <span class="n">length</span><span class="p">),</span> <span class="mi">65536</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1"># restore sign of cos, sin</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">csign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ldir_x</span> <span class="o">&lt;&lt;</span> <span class="mh">0xFFFFFFFF</span> <span class="o">-</span> <span class="n">ldir_x</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">ssign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ldir_y</span> <span class="o">&lt;&lt;</span> <span class="mh">0xFFFFFFFF</span> <span class="o">-</span> <span class="n">ldir_y</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ldir_x</span><span class="p">,</span> <span class="n">ldir_y</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\mathf\sqrt.py : 33 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">..utilf</span> <span class="kn">import</span> <span class="n">EUDBinaryMax</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">EUDBinaryMax</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\mathf\__init__.py : 29 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.lengthdir</span> <span class="kn">import</span> <span class="n">f_lengthdir</span>
<span class="kn">from</span> <span class="nn">.atan2</span> <span class="kn">import</span> <span class="n">f_atan2</span>
<span class="kn">from</span> <span class="nn">.sqrt</span> <span class="kn">import</span> <span class="n">f_sqrt</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\byterw.py : 268 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">dwmemio</span> <span class="k">as</span> <span class="n">dwm</span>


<span class="n">_epd</span><span class="p">,</span> <span class="n">_suboffset</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EUDByteReader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Read byte by byte.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dw</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="c1"># -------</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">seekepd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epdoffset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Seek EUDByteReader to specific epd player address&quot;&quot;&quot;</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">epdoffset</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">,</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">epdoffset</span><span class="p">))</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">],</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwbreak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">seekoffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Seek EUDByteReader to specific address&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">_epd</span><span class="p">,</span> <span class="n">_suboffset</span>

        <span class="c1"># convert offset to epd offset &amp; suboffset</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span><span class="n">_epd</span><span class="p">,</span> <span class="n">_suboffset</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">f_div</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([(</span><span class="n">_epd</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x58A364</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)])</span>

        <span class="c1"># seek to epd &amp; set suboffset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekepd</span><span class="p">(</span><span class="n">_epd</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">_suboffset</span><span class="p">)</span>
        <span class="p">])</span>

    <span class="c1"># -------</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">readbyte</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read byte from current address. Reader will advance by 1 bytes.</span>

<span class="sd">        :returns: Read byte</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">case0</span><span class="p">,</span> <span class="n">case1</span><span class="p">,</span> <span class="n">case2</span><span class="p">,</span> <span class="n">case3</span><span class="p">,</span> <span class="n">swend</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

        <span class="c1"># suboffset == 0</span>
        <span class="n">case0</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">case1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">swend</span><span class="p">)</span>

        <span class="c1"># suboffset == 1</span>
        <span class="n">case1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">case2</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">swend</span><span class="p">)</span>

        <span class="c1"># suboffset == 2</span>
        <span class="n">case2</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">case3</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">swend</span><span class="p">)</span>

        <span class="c1"># suboffset == 3</span>
        <span class="c1"># read more dword</span>
        <span class="n">case3</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">,</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">],</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwbreak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>

        <span class="n">swend</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span>


<span class="k">class</span> <span class="nc">EUDByteWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Write byte by byte&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dw</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">EUDLightVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">secaller</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socaller</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wbcaller</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">seekepd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epdoffset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Seek EUDByteWriter to specific epd player addresss&quot;&quot;&quot;</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">epdoffset</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">,</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">epdoffset</span><span class="p">))</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">],</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwbreak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">seekoffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Seek EUDByteWriter to specific address&quot;&quot;&quot;</span>

        <span class="k">global</span> <span class="n">_epd</span><span class="p">,</span> <span class="n">_suboffset</span>

        <span class="c1"># convert offset to epd offset &amp; suboffset</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span><span class="n">_epd</span><span class="p">,</span> <span class="n">_suboffset</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">f_div</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([(</span><span class="n">_epd</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x100000000</span> <span class="o">-</span> <span class="mh">0x58A364</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seekepd</span><span class="p">(</span><span class="n">_epd</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">_suboffset</span><span class="p">)</span>
        <span class="p">])</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">writebyte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write byte to current position.</span>

<span class="sd">        Write a byte to current position of EUDByteWriter. Writer will advance</span>
<span class="sd">        by 1 byte.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Bytes could be buffered before written to memory. After you</span>
<span class="sd">            finished using writebytes, you must call `flushdword` to flush the</span>
<span class="sd">            buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">case0</span><span class="p">,</span> <span class="n">case1</span><span class="p">,</span> <span class="n">case2</span><span class="p">,</span> <span class="n">case3</span><span class="p">,</span> <span class="n">swend</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

        <span class="n">case0</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">case1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">byte</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">swend</span><span class="p">)</span>

        <span class="n">case1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">case2</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">byte</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">swend</span><span class="p">)</span>

        <span class="n">case2</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIfNot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">case3</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">byte</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">swend</span><span class="p">)</span>

        <span class="n">case3</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">byte</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_suboffset</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">,</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">],</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwbreak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>

        <span class="n">swend</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="nd">@c.EUDFuncMethod</span>
    <span class="k">def</span> <span class="nf">flushdword</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flush buffer.&quot;&quot;&quot;</span>
        <span class="c1"># mux bytes</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                    <span class="p">],</span>
                    <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span>
                    <span class="p">]</span>
                <span class="p">)</span>

        <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dw</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\cpmemio.py : 68 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">_reader</span><span class="p">(</span><span class="n">cpo</span><span class="p">):</span>
    <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">ptr</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="n">epd</span> <span class="o">&lt;&lt;</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">ptr</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">epd</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>


<span class="k">def</span> <span class="nf">f_dwepdread_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cpo</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">cpo</span><span class="p">))</span>
    <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="o">=</span> <span class="n">_reader</span><span class="p">(</span><span class="n">cpo</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpo</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="o">-</span><span class="n">cpo</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>


<span class="k">def</span> <span class="nf">f_dwread_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_dwepdread_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">f_epdread_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_dwepdread_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">f_dwwrite_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">cpo</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="o">-</span><span class="n">cpo</span><span class="p">),</span>
    <span class="p">])</span>


<span class="k">def</span> <span class="nf">f_dwadd_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">cpo</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="o">-</span><span class="n">cpo</span><span class="p">),</span>
    <span class="p">])</span>


<span class="k">def</span> <span class="nf">f_dwsubtract_cp</span><span class="p">(</span><span class="n">cpo</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">cpo</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">subtract</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="o">-</span><span class="n">cpo</span><span class="p">),</span>
    <span class="p">])</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\dwmemio.py : 179 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.modcurpl</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_setcurpl</span><span class="p">,</span>
    <span class="n">f_getcurpl</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dwepdread_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">):</span>
    <span class="n">origcp</span> <span class="o">=</span> <span class="n">f_getcurpl</span><span class="p">()</span>
    <span class="n">f_setcurpl</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">)</span>

    <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">ptr</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="n">epd</span> <span class="o">&lt;&lt;</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">ptr</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">epd</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">f_setcurpl</span><span class="p">(</span><span class="n">origcp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>


<span class="k">def</span> <span class="nf">f_dwread_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_dwepdread_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">f_epdread_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_dwepdread_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>


<span class="c1"># Special flag reading functions</span>
<span class="k">def</span> <span class="nf">f_flagread_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">,</span> <span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">_readerdict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>    <span class="c1"># Make flags hashable</span>

    <span class="k">if</span> <span class="n">flags</span> <span class="ow">in</span> <span class="n">_readerdict</span><span class="p">:</span>
        <span class="n">readerf</span> <span class="o">=</span> <span class="n">_readerdict</span><span class="p">[</span><span class="n">flags</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Create reader function</span>
        <span class="nd">@c.EUDFunc</span>
        <span class="k">def</span> <span class="nf">readerf</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">):</span>
            <span class="n">origcp</span> <span class="o">=</span> <span class="n">f_getcurpl</span><span class="p">()</span>
            <span class="n">f_setcurpl</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">)</span>

            <span class="n">resetteract</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
            <span class="n">flagsv</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">))]</span>

            <span class="c1"># All set to 0</span>
            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">resetteract</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="p">[</span><span class="n">flagv</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">flagv</span> <span class="ow">in</span> <span class="n">flagsv</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Fill flags</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                    <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">],</span>
                    <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">resetteract</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                        <span class="p">[</span>
                            <span class="n">flagv</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">flagv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flagsv</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                        <span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>

            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">resetteract</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">])</span>
            <span class="n">f_setcurpl</span><span class="p">(</span><span class="n">origcp</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">flagsv</span>

        <span class="n">_readerdict</span><span class="p">[</span><span class="n">flags</span><span class="p">]</span> <span class="o">=</span> <span class="n">readerf</span>

    <span class="k">return</span> <span class="n">readerf</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">)</span>


<span class="c1"># Writing functions</span>

<span class="k">def</span> <span class="nf">f_dwwrite_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">f_dwadd_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">f_dwsubtract_epd</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>


<span class="c1"># Dword breaking functions</span>
<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dwbreak</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get hiword/loword/4byte of dword&quot;&quot;&quot;</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">byte</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Clear byte[], word[]</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">byteidx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">wordidx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">16</span>
        <span class="n">byteexp</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">8</span>
        <span class="n">wordexp</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">16</span>

        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">number</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">byte</span><span class="p">[</span><span class="n">byteidx</span><span class="p">]</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">byteexp</span><span class="p">),</span>
                <span class="n">word</span><span class="p">[</span><span class="n">wordidx</span><span class="p">]</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">wordexp</span><span class="p">),</span>
                <span class="n">number</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dwbreak2</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get hiword/loword/4byte of dword&quot;&quot;&quot;</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">byte</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDCreateVariables</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Clear byte[], word[]</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">byte</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">byteidx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">wordidx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">16</span>

        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">number</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">byte</span><span class="p">[</span><span class="n">byteidx</span><span class="p">]</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">word</span><span class="p">[</span><span class="n">wordidx</span><span class="p">]</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">number</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">byte</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\mblockio.py : 131 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">modcurpl</span> <span class="k">as</span> <span class="n">cp</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">byterw</span> <span class="k">as</span> <span class="n">bm</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_repmovsd_epd</span><span class="p">(</span><span class="n">dstepdp</span><span class="p">,</span> <span class="n">srcepdp</span><span class="p">,</span> <span class="n">copydwn</span><span class="p">):</span>
    <span class="n">epd_diff</span> <span class="o">=</span> <span class="n">dstepdp</span> <span class="o">-</span> <span class="n">srcepdp</span>
    <span class="n">tempv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="c1"># Backup original cp.</span>
    <span class="n">origcp</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">f_getcurpl</span><span class="p">()</span>

    <span class="n">cp</span><span class="o">.</span><span class="n">f_setcurpl</span><span class="p">(</span><span class="n">srcepdp</span><span class="p">)</span>

    <span class="c1"># Set cpmodas.</span>
    <span class="n">cpmoda1_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
    <span class="n">cpmoda2_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
    <span class="n">cpmoda0_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()]</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cpmoda1</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">epd_diff</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cpmoda1</span> <span class="ow">in</span> <span class="n">cpmoda1_list</span><span class="p">],</span>
        <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cpmoda2</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="o">-</span><span class="n">epd_diff</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cpmoda2</span> <span class="ow">in</span> <span class="n">cpmoda2_list</span><span class="p">],</span>
        <span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cpmoda0_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">epd_diff</span><span class="p">),</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cpmoda0_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="o">-</span><span class="n">epd_diff</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">])</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhileNot</span><span class="p">()(</span><span class="n">copydwn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">cpmoda01</span><span class="p">,</span> <span class="n">cpmoda02</span> <span class="o">=</span> <span class="n">cpmoda0_list</span>

        <span class="c1"># *dstepdp, tempv = 0</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">cpmoda01</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">cpmoda02</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">tempv</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cpmoda1</span><span class="p">,</span> <span class="n">cpmoda2</span> <span class="o">=</span> <span class="n">cpmoda1_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cpmoda2_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># if *srcepdp &gt;= 2**i:</span>
            <span class="c1">#     *srcepdp -= 2 ** i</span>
            <span class="c1">#     *dstepdp += 2 ** i</span>
            <span class="c1">#     tempv += 2 ** i</span>
            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">conditions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">cpmoda1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">cpmoda2</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">tempv</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="n">resetteract</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">tempv</span> <span class="o">&lt;&lt;</span> <span class="n">resetteract</span> <span class="o">+</span> <span class="mi">20</span>

        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">resetteract</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">copydwn</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>

    <span class="n">cp</span><span class="o">.</span><span class="n">f_setcurpl</span><span class="p">(</span><span class="n">origcp</span><span class="p">)</span>


<span class="c1"># -------</span>


<span class="n">_br</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteReader</span><span class="p">()</span>
<span class="n">_bw</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteWriter</span><span class="p">()</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_memcpy</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">copylen</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="n">_br</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

    <span class="n">loopstart</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
    <span class="n">loopend</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">copylen</span><span class="o">.</span><span class="n">Exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">loopend</span><span class="p">)</span>

    <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">())</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">copylen</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">loopstart</span><span class="p">)</span>

    <span class="n">loopend</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\modcurpl.py : 54 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">f_setcurpl</span><span class="p">(</span><span class="n">cp</span><span class="p">):</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetCurrentPlayer</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span>


<span class="c1"># This function initializes _curpl_checkcond, so should be called at least once</span>
<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_getcurpl</span><span class="p">():</span>
    <span class="n">cpcache</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">curpl</span><span class="o">.</span><span class="n">GetCPCache</span><span class="p">()</span>
    <span class="n">cpcond</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">curpl</span><span class="o">.</span><span class="n">cpcacheMatchCond</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIfNot</span><span class="p">()(</span><span class="n">cpcond</span><span class="p">):</span>
        <span class="n">cpcache</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)],</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">),</span>
                    <span class="n">cpcache</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetCurrentPlayer</span><span class="p">(</span><span class="n">cpcache</span><span class="p">))</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cpcache</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\ptrmemio.py : 89 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">safedwmemio</span> <span class="k">as</span> <span class="n">dwm</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">byterw</span> <span class="k">as</span> <span class="n">brw</span>

<span class="c1"># Helper functions</span>

<span class="n">_bw</span> <span class="o">=</span> <span class="n">brw</span><span class="o">.</span><span class="n">EUDByteWriter</span><span class="p">()</span>
<span class="n">_br</span> <span class="o">=</span> <span class="n">brw</span><span class="o">.</span><span class="n">EUDByteReader</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">f_dwwrite</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">dw</span><span class="p">):</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwbreak</span><span class="p">(</span><span class="n">dw</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">f_wwrite</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="n">dwm</span><span class="o">.</span><span class="n">f_dwbreak</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">f_bwrite</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">_bw</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>


<span class="c1"># -----------------------------</span>


<span class="k">def</span> <span class="nf">f_dwread</span><span class="p">(</span><span class="n">ptr</span><span class="p">):</span>
    <span class="n">_br</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="n">chars0</span> <span class="o">=</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
    <span class="n">chars1</span> <span class="o">=</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
    <span class="n">chars2</span> <span class="o">=</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
    <span class="n">chars3</span> <span class="o">=</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">chars0</span> <span class="o">+</span>
        <span class="n">chars1</span> <span class="o">*</span> <span class="mh">0x100</span> <span class="o">+</span>
        <span class="n">chars2</span> <span class="o">*</span> <span class="mh">0x10000</span> <span class="o">+</span>
        <span class="n">chars3</span> <span class="o">*</span> <span class="mh">0x1000000</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">f_wread</span><span class="p">(</span><span class="n">ptr</span><span class="p">):</span>
    <span class="n">_br</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="n">chars0</span> <span class="o">=</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
    <span class="n">chars1</span> <span class="o">=</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">chars0</span> <span class="o">+</span>
        <span class="n">chars1</span> <span class="o">*</span> <span class="mh">0x100</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">f_bread</span><span class="p">(</span><span class="n">ptr</span><span class="p">):</span>
    <span class="n">_br</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_br</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\safedwmemio.py : 105 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dwepdread_epd_safe</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">):</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">retepd</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="c1"># Common comparison rawtrigger</span>
    <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">()</span>
    <span class="n">cmpc</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">cmp_player</span> <span class="o">=</span> <span class="n">cmpc</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="n">cmp_number</span> <span class="o">=</span> <span class="n">cmpc</span> <span class="o">+</span> <span class="mi">8</span>
    <span class="n">cmpact</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="n">cmptrigger</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">cmptrigger</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">cmpc</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">AtMost</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">cmpact</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cmptrigger</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">cmpact_ontrueaddr</span> <span class="o">=</span> <span class="n">cmpact</span> <span class="o">+</span> <span class="mi">20</span>
    <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

    <span class="c1"># static_for</span>
    <span class="n">chain1</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
    <span class="n">chain2</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>

    <span class="c1"># Main logic start</span>
    <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">([</span>
        <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">cmp_player</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">targetplayer</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">cmp_number</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">),</span>
        <span class="p">(</span><span class="n">retepd</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x3FFFFFFF</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">readend</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">nextchain</span> <span class="o">=</span> <span class="n">chain1</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">readend</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">epdsubact</span> <span class="o">=</span> <span class="p">[</span><span class="n">retepd</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))]</span>
            <span class="n">epdaddact</span> <span class="o">=</span> <span class="p">[</span><span class="n">retepd</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">epdsubact</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">epdaddact</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">chain1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="n">cmptrigger</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cmp_number</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">cmptrigger</span><span class="p">,</span> <span class="n">chain2</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cmpact_ontrueaddr</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">nextchain</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="p">]</span> <span class="o">+</span> <span class="n">epdsubact</span>
        <span class="p">)</span>

        <span class="n">chain2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cmp_number</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="p">]</span> <span class="o">+</span> <span class="n">epdaddact</span>
        <span class="p">)</span>

    <span class="n">readend</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">retepd</span>


<span class="k">def</span> <span class="nf">f_dwread_epd_safe</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_dwepdread_epd_safe</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">f_epdread_epd_safe</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_dwepdread_epd_safe</span><span class="p">(</span><span class="n">targetplayer</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\memiof\__init__.py : 82 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.modcurpl</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_setcurpl</span><span class="p">,</span>
    <span class="n">f_getcurpl</span>
<span class="p">)</span>


<span class="kn">from</span> <span class="nn">.dwmemio</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dwepdread_epd</span><span class="p">,</span>
    <span class="n">f_dwread_epd</span><span class="p">,</span>
    <span class="n">f_epdread_epd</span><span class="p">,</span>

    <span class="n">f_flagread_epd</span><span class="p">,</span>

    <span class="n">f_dwwrite_epd</span><span class="p">,</span>
    <span class="n">f_dwadd_epd</span><span class="p">,</span>
    <span class="n">f_dwsubtract_epd</span><span class="p">,</span>
    <span class="n">f_dwbreak</span><span class="p">,</span>
    <span class="n">f_dwbreak2</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.cpmemio</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dwepdread_cp</span><span class="p">,</span>
    <span class="n">f_dwread_cp</span><span class="p">,</span>
    <span class="n">f_epdread_cp</span><span class="p">,</span>

    <span class="n">f_dwwrite_cp</span><span class="p">,</span>
    <span class="n">f_dwadd_cp</span><span class="p">,</span>
    <span class="n">f_dwsubtract_cp</span><span class="p">,</span>
<span class="p">)</span>


<span class="kn">from</span> <span class="nn">.safedwmemio</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dwread_epd_safe</span><span class="p">,</span>
    <span class="n">f_epdread_epd_safe</span><span class="p">,</span>
    <span class="n">f_dwepdread_epd_safe</span><span class="p">,</span>
<span class="p">)</span>


<span class="kn">from</span> <span class="nn">.byterw</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDByteReader</span><span class="p">,</span>
    <span class="n">EUDByteWriter</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.ptrmemio</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dwwrite</span><span class="p">,</span>
    <span class="n">f_wwrite</span><span class="p">,</span>
    <span class="n">f_bwrite</span><span class="p">,</span>
    <span class="n">f_dwread</span><span class="p">,</span>
    <span class="n">f_wread</span><span class="p">,</span>
    <span class="n">f_bread</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.mblockio</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_repmovsd_epd</span><span class="p">,</span>
    <span class="n">f_memcpy</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\qgcf\qgc.py : 69 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="n">f_dwread_epd</span><span class="p">,</span> <span class="n">f_memcpy</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">QueueGameCommand</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Queue game command to packet queue.</span>

<span class="sd">    Starcraft periodically boradcasts game packets to other player. Game</span>
<span class="sd">    packets are stored to queue, and this function add data to that queue, so</span>
<span class="sd">    that SC can boradcast it.</span>

<span class="sd">    :param data: Data to put in queue</span>
<span class="sd">    :param size: Size of data</span>

<span class="sd">    .. note::</span>
<span class="sd">        If packet queue is full, this function fails. This behavior is silent</span>
<span class="sd">        without any warning or error, since this behavior shouldn&#39;t happen in</span>
<span class="sd">        common situations. So **Don&#39;t use this function too much in a frame.**</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prov_maxbuffer</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x57F0D8</span><span class="p">))</span>
    <span class="n">cmdqlen</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x654AA0</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIfNot</span><span class="p">()(</span><span class="n">cmdqlen</span> <span class="o">+</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">prov_maxbuffer</span><span class="p">):</span>
        <span class="n">f_memcpy</span><span class="p">(</span><span class="mh">0x654880</span> <span class="o">+</span> <span class="n">cmdqlen</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x654AA0</span><span class="p">),</span> <span class="n">cmdqlen</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">QueueGameCommand_RightClick</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Queue right click action.</span>

<span class="sd">    :param xy: (y * 65536) + x, where (x, y) is coordinate for right click.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RightClickCommand</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;...</span><span class="se">\x14</span><span class="s1">XXYY</span><span class="se">\0\0\xE4\0\x00</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">RightClickCommand</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span> <span class="n">xy</span><span class="p">)</span>
    <span class="n">QueueGameCommand</span><span class="p">(</span><span class="n">RightClickCommand</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\qgcf\__init__.py : 30 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.qgc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QueueGameCommand</span><span class="p">,</span>
    <span class="n">QueueGameCommand_RightClick</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\stringf\dbstr.py : 187 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="n">f_dwread_epd</span><span class="p">,</span> <span class="n">f_dwwrite_epd</span>


<span class="k">class</span> <span class="nc">DBString</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ExprProxy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object for storing single modifiable string.</span>

<span class="sd">    Manipluating STR section is hard. DBString stores only one string, so that</span>
<span class="sd">    modifying its structure is substantially easier than modifying entire STR</span>
<span class="sd">    section. You can do anything you would do with normal string with DBString.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for DBString</span>

<span class="sd">        :param content: Initial DBString content / capacity. Capacity of</span>
<span class="sd">            DBString is determined by size of this. If content is integer, then</span>
<span class="sd">            initial capacity and content of DBString will be set to</span>
<span class="sd">            content(int) and empty string.</span>

<span class="sd">        :type content: str, bytes, int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">DBStringData</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetStringMemoryAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get memory address of DBString content.</span>

<span class="sd">        :returns: Memory address of DBString content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">GetDisplayAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DisplayText equivilant for DBString.</span>

<span class="sd">        :returns: List of actions for printing DBString content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resetter</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">fw</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x5993D4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="n">c</span><span class="o">.</span><span class="n">DisplayText</span><span class="p">(</span><span class="n">fw</span><span class="p">),</span>
            <span class="n">resetter</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x5993D4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">fw</span> <span class="o">&lt;&lt;</span> <span class="n">ExtendedStringIndex_FW</span><span class="p">(</span><span class="n">resetter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">acts</span>

<span class="k">class</span> <span class="nc">DBStringData</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">EUDObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object containing DBString data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for DBString</span>

<span class="sd">        :param content: Initial DBString content / capacity. Capacity of</span>
<span class="sd">            DBString is determined by size of this. If content is integer, then</span>
<span class="sd">            initial capacity and content of DBString will be set to</span>
<span class="sd">            content(int) and empty string.</span>

<span class="sd">        :type content: str, bytes, int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">):</span>
        <span class="n">pbuf</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\x01\x00\x04\x00</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">pbuf</span><span class="o">.</span><span class="n">WriteBytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">pbuf</span><span class="o">.</span><span class="n">WriteByte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExtendedStringIndex_FW</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ConstExpr</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resetter</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resetter</span> <span class="o">=</span> <span class="n">resetter</span>

    <span class="k">def</span> <span class="nf">Evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_RegisterResetterAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resetter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">toRlocInt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="n">_resetteracts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">RCPC_ResetActionSet</span><span class="p">():</span>
    <span class="n">_resetteracts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="n">c</span><span class="o">.</span><span class="n">RegisterCreatePayloadCallback</span><span class="p">(</span><span class="n">RCPC_ResetActionSet</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_RegisterResetterAction</span><span class="p">(</span><span class="n">resetteract</span><span class="p">):</span>
    <span class="n">_resetteracts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resetteract</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ResetterBuffer</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">EUDObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">GetDataSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_resetteracts</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">WritePayload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ra</span> <span class="ow">in</span> <span class="n">_resetteracts</span><span class="p">:</span>
            <span class="n">pbuf</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">ra</span> <span class="o">+</span> <span class="mi">20</span><span class="p">))</span>
        <span class="n">pbuf</span><span class="o">.</span><span class="n">WriteDword</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">)</span>


<span class="n">_extstr_dict</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">DisplayExtText</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Equivilant to DisplayText, but doesn&#39;t use string table to store text.</span>

<span class="sd">    :param text: Text to display.</span>
<span class="sd">    :type text: str or bytes</span>

<span class="sd">    .. note:: You need to call `f_initextstr` before using DisplayExtText.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_extstr_dict</span><span class="p">:</span>
        <span class="n">_extstr_dict</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">DBString</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_extstr_dict</span><span class="p">[</span><span class="n">text</span><span class="p">]</span><span class="o">.</span><span class="n">GetDisplayAction</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_f_initextstr</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;(internal)Initialize DBString system.&quot;&quot;&quot;</span>
    <span class="n">rb</span> <span class="o">=</span> <span class="n">ResetterBuffer</span><span class="p">()</span>
    <span class="n">ptr</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">ptr</span> <span class="o">&lt;&lt;</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">rb</span><span class="p">)</span>
    <span class="n">origstrptr</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x5993D4</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDInfLoop</span><span class="p">()():</span>
        <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDBreakIf</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
        <span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">origstrptr</span><span class="p">)</span>
        <span class="n">ptr</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndInfLoop</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">f_initextstr</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This function does nothing.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This function is deprecated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\stringf\eudprint.py : 182 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.rwcommon</span> <span class="kn">import</span> <span class="n">br1</span><span class="p">,</span> <span class="n">bw1</span>
<span class="kn">from</span> <span class="nn">.dbstr</span> <span class="kn">import</span> <span class="n">DBString</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dbstr_addstr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print string as string to dst. Same as strcpy except of return value.</span>

<span class="sd">    :param dst: Destination address (Not EPD player)</span>
<span class="sd">    :param src: Source address (Not EPD player)</span>

<span class="sd">    :returns: dst + strlen(src)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="n">br1</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="n">bw1</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDInfLoop</span><span class="p">()():</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">br1</span><span class="o">.</span><span class="n">readbyte</span><span class="p">())</span>
        <span class="n">bw1</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDBreakIf</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dst</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndInfLoop</span><span class="p">()</span>

    <span class="n">bw1</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dst</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dbstr_adddw</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print number as string to dst.</span>

<span class="sd">    :param dst: Destination address (Not EPD player)</span>
<span class="sd">    :param number: DWORD to print</span>

<span class="sd">    :returns: dst + strlen(itoa(number))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bw1</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

    <span class="n">skipper</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span>
    <span class="n">ch</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>

    <span class="c1"># Get digits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">number</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">f_div</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIf</span><span class="p">(</span><span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">skipper</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># print digits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">skipper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="n">bw1</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="s1">&#39;0&#39;</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">dst</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">bw1</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># EOS</span>
    <span class="n">bw1</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dst</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dbstr_addptr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print number as string to dst.</span>

<span class="sd">    :param dst: Destination address (Not EPD player)</span>
<span class="sd">    :param number: DWORD to print</span>

<span class="sd">    :returns: dst + strlen(itoa(number))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bw1</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
    <span class="n">ch</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>

    <span class="c1"># Get digits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">number</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">f_div</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="c1"># print digits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">):</span>
            <span class="n">bw1</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="s1">&#39;0&#39;</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">()():</span>
            <span class="n">bw1</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="s1">&#39;A&#39;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
        <span class="n">dst</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">bw1</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># EOS</span>
    <span class="n">bw1</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dst</span>


<span class="k">class</span> <span class="nc">hptr</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">def</span> <span class="nf">f_dbstr_print</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print multiple string / number to dst.</span>

<span class="sd">    :param dst: Destination address (Not EPD player)</span>
<span class="sd">    :param args: Things to print</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">DBString</span><span class="p">):</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">GetStringMemoryAddr</span><span class="p">()</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">f_dbstr_addstr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">arg</span> <span class="o">+</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">f_dbstr_addstr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">DBString</span><span class="p">):</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">f_dbstr_addstr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">GetStringMemoryAddr</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># int and c.EUDVariable should act the same if possible.</span>
            <span class="c1"># EUDVariable has a value of 32bit unsigned integer.</span>
            <span class="c1"># So we adjust arg to be in the same range.</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">f_dbstr_addstr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">))</span> <span class="o">+</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">f_dbstr_adddw</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">hptr</span><span class="p">):</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">f_dbstr_addptr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span>
                <span class="s1">&#39;Object wit unknown parameter type </span><span class="si">%s</span><span class="s1"> given to f_eudprint.&#39;</span>
                <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">dst</span>


<span class="n">_printf_buffer</span> <span class="o">=</span> <span class="n">DBString</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">f_simpleprint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">spaced</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="c1"># Add spaces between arguments</span>
    <span class="k">if</span> <span class="n">spaced</span><span class="p">:</span>
        <span class="n">spaced_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">spaced_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">])</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">spaced_args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Print</span>
    <span class="n">f_dbstr_print</span><span class="p">(</span><span class="n">_printf_buffer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">_printf_buffer</span><span class="o">.</span><span class="n">GetDisplayAction</span><span class="p">())</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\stringf\rwcommon.py : 34 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="n">byterw</span> <span class="k">as</span> <span class="n">bm</span>

<span class="n">br1</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteReader</span><span class="p">()</span>
<span class="n">br2</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteReader</span><span class="p">()</span>
<span class="n">br3</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteReader</span><span class="p">()</span>
<span class="n">bw1</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteWriter</span><span class="p">()</span>
<span class="n">bw2</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteWriter</span><span class="p">()</span>
<span class="n">bw3</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">EUDByteWriter</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\stringf\strfunc.py : 75 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>

<span class="kn">from</span> <span class="nn">.rwcommon</span> <span class="kn">import</span> <span class="n">br1</span><span class="p">,</span> <span class="n">br2</span><span class="p">,</span> <span class="n">bw1</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_strcpy</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Strcpy equivilant in eudplib. Copy C-style string.</span>

<span class="sd">    :param dst: Destination address (Not EPD player)</span>
<span class="sd">    :param src: Source address (Not EPD player)</span>

<span class="sd">    :return: dst</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="n">br1</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="n">bw1</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDInfLoop</span><span class="p">()():</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">br1</span><span class="o">.</span><span class="n">readbyte</span><span class="p">())</span>
        <span class="n">bw1</span><span class="o">.</span><span class="n">writebyte</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDBreakIf</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndInfLoop</span><span class="p">()</span>

    <span class="n">bw1</span><span class="o">.</span><span class="n">flushdword</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dst</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_strcmp</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
    <span class="n">br1</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
    <span class="n">br2</span><span class="o">.</span><span class="n">seekoffset</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDInfLoop</span><span class="p">()():</span>
        <span class="n">ch1</span> <span class="o">=</span> <span class="n">br1</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
        <span class="n">ch2</span> <span class="o">=</span> <span class="n">br2</span><span class="o">.</span><span class="n">readbyte</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">ch1</span> <span class="o">==</span> <span class="n">ch2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">ch1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDContinue</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">()():</span>
            <span class="n">c</span><span class="o">.</span><span class="n">EUDReturn</span><span class="p">(</span><span class="n">ch1</span> <span class="o">-</span> <span class="n">ch2</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndInfLoop</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\stringf\__init__.py : 40 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.dbstr</span> <span class="kn">import</span> <span class="n">DBString</span><span class="p">,</span> <span class="n">DisplayExtText</span><span class="p">,</span> <span class="n">f_initextstr</span>
<span class="kn">from</span> <span class="nn">.strfunc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_strcpy</span><span class="p">,</span>
    <span class="n">f_strcmp</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.eudprint</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dbstr_adddw</span><span class="p">,</span>
    <span class="n">f_dbstr_addptr</span><span class="p">,</span>
    <span class="n">f_dbstr_addstr</span><span class="p">,</span>
    <span class="n">hptr</span><span class="p">,</span>
    <span class="n">f_dbstr_print</span><span class="p">,</span>
    <span class="n">f_simpleprint</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\binsearch.py : 109 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDBinaryMax</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">minv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxv</span><span class="o">=</span><span class="mh">0xFFFFFFFF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Find maximum x satisfying cond(x) using binary search</span>

<span class="sd">    :param cond: Test condition</span>
<span class="sd">    :param minv: Minimum value in domain</span>
<span class="sd">    :param maxv: Maximum value in domain</span>

<span class="sd">    Cond should be binary classifier, meaning that for some N</span>
<span class="sd">        for all x &gt; N, cond(x) is false.</span>
<span class="sd">        for all x &lt;= N, cond(x) is true</span>
<span class="sd">    Then EUDBinaryMin will find such N.</span>

<span class="sd">    .. note:: If none of the value satisfies condition, then this</span>
<span class="sd">        function will return maxv.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">minv</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minv</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maxv</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">maxv</span> <span class="o">-</span> <span class="n">minv</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">minv</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">and</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIfNot</span><span class="p">()([</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">maxv</span><span class="p">,</span> <span class="n">cond</span><span class="p">(</span><span class="n">x</span><span class="p">)]):</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">))</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">EUDBinaryMin</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">minv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxv</span><span class="o">=</span><span class="mh">0xFFFFFFFF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Find minimum x satisfying cond(x) using binary search</span>

<span class="sd">    :param cond: Test condition</span>
<span class="sd">    :param minv: Minimum value in domain</span>
<span class="sd">    :param maxv: Maximum value in domain</span>

<span class="sd">    Cond should be binary classifier, meaning that for some N</span>
<span class="sd">        for all x &lt; N, cond(x) is false.</span>
<span class="sd">        for all x &gt;= N, cond(x) is true</span>
<span class="sd">    Then EUDBinaryMin will find such N</span>

<span class="sd">    .. note:: If none of the value satisfies condition, then this</span>
<span class="sd">        function will return maxv.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">maxv</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minv</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maxv</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">maxv</span> <span class="o">-</span> <span class="n">minv</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">minv</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">and</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()([</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIfNot</span><span class="p">()([</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">minv</span><span class="p">,</span> <span class="n">cond</span><span class="p">(</span><span class="n">x</span><span class="p">)]):</span>
                <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">))</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\listloop.py : 95 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="n">f_dwepdread_epd</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span><span class="p">,</span>
    <span class="n">trigtrg</span> <span class="k">as</span> <span class="n">tt</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDLoopList</span><span class="p">(</span><span class="n">header_offset</span><span class="p">,</span> <span class="n">break_offset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">blockname</span> <span class="o">=</span> <span class="s1">&#39;listloop&#39;</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="n">blockname</span><span class="p">,</span> <span class="n">header_offset</span><span class="p">)</span>

    <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="o">=</span> <span class="n">f_dwepdread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">header_offset</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">break_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhileNot</span><span class="p">()(</span><span class="n">ptr</span> <span class="o">==</span> <span class="n">break_offset</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()([</span><span class="n">ptr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ptr</span> <span class="o">&lt;=</span> <span class="mh">0x7FFFFFFF</span><span class="p">])</span>

    <span class="k">yield</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDSetContinuePoint</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span><span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span><span class="p">],</span> <span class="n">f_dwepdread_epd</span><span class="p">(</span><span class="n">epd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="n">blockname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">header_offset</span><span class="p">,</span>
        <span class="s1">&#39;listloop mismatch&#39;</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDLoopUnit</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="ow">in</span> <span class="n">EUDLoopList</span><span class="p">(</span><span class="mh">0x628430</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>


<span class="k">def</span> <span class="nf">EUDLoopBullet</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="ow">in</span> <span class="n">EUDLoopList</span><span class="p">(</span><span class="mh">0x64DEC4</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>


<span class="k">def</span> <span class="nf">EUDLoopSprite</span><span class="p">():</span>
    <span class="n">y_epd</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">y_epd</span> <span class="o">&lt;&lt;</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x629688</span><span class="p">)</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;listloop&#39;</span><span class="p">,</span> <span class="s1">&#39;sprlo&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">y_epd</span> <span class="o">&lt;</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x629688</span><span class="p">)</span> <span class="o">+</span> <span class="mi">256</span><span class="p">):</span>
        <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="o">=</span> <span class="n">f_dwepdread_epd</span><span class="p">(</span><span class="n">y_epd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">ptr</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDSetContinuePoint</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetVariables</span><span class="p">([</span><span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span><span class="p">],</span> <span class="n">f_dwepdread_epd</span><span class="p">(</span><span class="n">epd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>
        <span class="n">y_epd</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;spriteloop&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDLoopTrigger</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
    <span class="n">player</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EncodePlayer</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>

    <span class="n">tbegin</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">TrigTriggerBegin</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIfNot</span><span class="p">()(</span><span class="n">tbegin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">tend</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">TrigTriggerEnd</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span> <span class="ow">in</span> <span class="n">EUDLoopList</span><span class="p">(</span><span class="n">tbegin</span><span class="p">,</span> <span class="n">tend</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">epd</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\logic.py : 90 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDOr</span><span class="p">(</span><span class="n">cond1</span><span class="p">,</span> <span class="o">*</span><span class="n">conds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; cond1 || cond2 || ... || condn</span>

<span class="sd">    .. warning:: Short circuiting is not supported</span>

<span class="sd">    :param conds: List of conditions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">cond1</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElseIf</span><span class="p">()(</span><span class="n">cond</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">()():</span>
        <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span>


<span class="k">def</span> <span class="nf">EUDAnd</span><span class="p">(</span><span class="n">cond1</span><span class="p">,</span> <span class="o">*</span><span class="n">conds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; cond1 &amp;&amp; cond2 &amp;&amp; ... &amp;&amp; condn</span>

<span class="sd">    .. note::</span>
<span class="sd">        This function computes AND value of various conditions.</span>
<span class="sd">        If you don&#39;t want to do much computation, you should better use</span>
<span class="sd">        plain list instead of this function.</span>

<span class="sd">    .. warning:: Short circuiting is not supported.</span>

<span class="sd">    :param conds: List of conditions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIfNot</span><span class="p">()(</span><span class="n">cond1</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElseIfNot</span><span class="p">()(</span><span class="n">cond</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">()():</span>
        <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span>


<span class="k">def</span> <span class="nf">EUDNot</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; !cond</span>

<span class="sd">    :param conds: Condition to negate</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">():</span>
        <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\mempatch.py : 121 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span><span class="p">,</span>
    <span class="n">trigger</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..eudarray</span> <span class="kn">import</span> <span class="n">EUDArray</span>
<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dwread_epd</span><span class="p">,</span>
    <span class="n">f_dwwrite_epd</span><span class="p">,</span>
    <span class="n">f_repmovsd_epd</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">patchMax</span> <span class="o">=</span> <span class="mi">8192</span>

<span class="n">patchstack</span> <span class="o">=</span> <span class="n">EUDArray</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">patchMax</span><span class="p">)</span>
<span class="n">dws_top</span><span class="p">,</span> <span class="n">ps_top</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
<span class="n">dwstack</span> <span class="o">=</span> <span class="n">EUDArray</span><span class="p">(</span><span class="n">patchMax</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pushpatchstack</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">ps_top</span>
    <span class="n">patchstack</span><span class="p">[</span><span class="n">ps_top</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">ps_top</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">poppatchstack</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">ps_top</span>
    <span class="n">ps_top</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">patchstack</span><span class="p">[</span><span class="n">ps_top</span><span class="p">]</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dwpatch_epd</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">patchstack</span><span class="p">,</span> <span class="n">ps_top</span><span class="p">,</span> <span class="n">dws_top</span>

    <span class="n">prev_value</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">dstepd</span><span class="p">)</span>
    <span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">dwstack</span><span class="p">)</span> <span class="o">+</span> <span class="n">dws_top</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">prev_value</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">pushpatchstack</span><span class="p">(</span><span class="n">dstepd</span><span class="p">)</span>
    <span class="n">pushpatchstack</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">dwstack</span><span class="p">)</span> <span class="o">+</span> <span class="n">dws_top</span><span class="p">)</span>
    <span class="n">pushpatchstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dws_top</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_blockpatch_epd</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">srcepd</span><span class="p">,</span> <span class="n">dwn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Patch 4*dwn bytes of memory at dstepd with memory of srcepd.</span>

<span class="sd">    .. note::</span>
<span class="sd">        After calling this function, contents at srcepd memory may change.</span>
<span class="sd">        Since new contents are required for :py:`f_unpatchall` to run, you</span>
<span class="sd">        shouldn&#39;t use the memory for any other means.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">dws_top</span>

    <span class="c1"># Push to stack</span>
    <span class="n">pushpatchstack</span><span class="p">(</span><span class="n">dstepd</span><span class="p">)</span>
    <span class="n">pushpatchstack</span><span class="p">(</span><span class="n">srcepd</span><span class="p">)</span>
    <span class="n">pushpatchstack</span><span class="p">(</span><span class="n">dwn</span><span class="p">)</span>
    <span class="n">dws_top</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Swap contents btw dstepd, srcepd</span>
    <span class="n">tmpbuffer</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">dwn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">copydwn</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">copydwn</span> <span class="o">&lt;&lt;</span> <span class="mi">256</span>
        <span class="n">t</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span>
            <span class="n">dwn</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">,</span>
            <span class="n">copydwn</span><span class="o">.</span><span class="n">SetNumber</span><span class="p">(</span><span class="n">dwn</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">dwn</span> <span class="o">-=</span> <span class="n">copydwn</span>

        <span class="n">f_repmovsd_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">tmpbuffer</span><span class="p">),</span> <span class="n">dstepd</span><span class="p">,</span> <span class="n">copydwn</span><span class="p">)</span>
        <span class="n">f_repmovsd_epd</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">srcepd</span><span class="p">,</span> <span class="n">copydwn</span><span class="p">)</span>
        <span class="n">f_repmovsd_epd</span><span class="p">(</span><span class="n">srcepd</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">tmpbuffer</span><span class="p">),</span> <span class="n">copydwn</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_unpatchall</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">ps_top</span><span class="p">,</span> <span class="n">dws_top</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">ps_top</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">dws_top</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">dwn</span> <span class="o">=</span> <span class="n">poppatchstack</span><span class="p">()</span>
        <span class="n">unpatchsrcepd</span> <span class="o">=</span> <span class="n">poppatchstack</span><span class="p">()</span>
        <span class="n">dstepd</span> <span class="o">=</span> <span class="n">poppatchstack</span><span class="p">()</span>
        <span class="n">f_repmovsd_epd</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">unpatchsrcepd</span><span class="p">,</span> <span class="n">dwn</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\pexist.py : 86 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dwread_epd</span><span class="p">,</span>
    <span class="n">f_getcurpl</span><span class="p">,</span>
    <span class="n">f_setcurpl</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="p">)</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_playerexist</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if player has not left the game.</span>

<span class="sd">    :returns: 1 if player exists, 0 if not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="mh">0x51A280</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">prevtstart</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">prevtstart</span> <span class="o">==</span> <span class="o">~</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)):</span>
        <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">()():</span>
        <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ret</span>


<span class="c1"># --------</span>

<span class="k">def</span> <span class="nf">EUDPlayerLoop</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_footer</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;origcp&#39;</span><span class="p">:</span> <span class="n">f_getcurpl</span><span class="p">(),</span> <span class="s1">&#39;playerv&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()}</span>
        <span class="n">playerv</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;playerv&#39;</span><span class="p">]</span>

        <span class="n">playerv</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">playerv</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDContinueIfNot</span><span class="p">(</span><span class="n">f_playerexist</span><span class="p">(</span><span class="n">playerv</span><span class="p">))</span>
        <span class="n">f_setcurpl</span><span class="p">(</span><span class="n">playerv</span><span class="p">)</span>

        <span class="n">ut</span><span class="o">.</span><span class="n">EUDCreateBlock</span><span class="p">(</span><span class="s1">&#39;ploopblock&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">cs</span><span class="o">.</span><span class="n">CtrlStruOpener</span><span class="p">(</span><span class="n">_footer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDEndPlayerLoop</span><span class="p">():</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EUDPopBlock</span><span class="p">(</span><span class="s1">&#39;ploopblock&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">playerv</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;playerv&#39;</span><span class="p">]</span>
    <span class="n">origcp</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s1">&#39;origcp&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIsContinuePointSet</span><span class="p">():</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDSetContinuePoint</span><span class="p">()</span>

    <span class="n">playerv</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>
    <span class="n">f_setcurpl</span><span class="p">(</span><span class="n">origcp</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\random.py : 86 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># This code uses simple LCG algorithm.</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="n">f_dwbreak</span><span class="p">,</span> <span class="n">f_dwread_epd</span>

<span class="n">_seed</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">f_getseed</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">_seed</span>
    <span class="k">return</span> <span class="n">t</span>


<span class="k">def</span> <span class="nf">f_srand</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="n">_seed</span> <span class="o">&lt;&lt;</span> <span class="n">seed</span>


<span class="k">def</span> <span class="nf">f_randomize</span><span class="p">():</span>
    <span class="n">current_rv</span> <span class="o">=</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x51CA14</span><span class="p">))</span>
    <span class="n">_seed</span> <span class="o">&lt;&lt;</span> <span class="n">current_rv</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_rand</span><span class="p">():</span>
    <span class="n">_seed</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">f_mul</span><span class="p">(</span><span class="n">_seed</span><span class="p">,</span> <span class="mi">1103515245</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12345</span>
    <span class="k">return</span> <span class="n">f_dwbreak</span><span class="p">(</span><span class="n">_seed</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Only HIWORD is returned</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_dwrand</span><span class="p">():</span>
    <span class="n">seed1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">f_mul</span><span class="p">(</span><span class="n">_seed</span><span class="p">,</span> <span class="mi">1103515245</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12345</span>
    <span class="n">seed2</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">f_mul</span><span class="p">(</span><span class="n">seed1</span><span class="p">,</span> <span class="mi">1103515245</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12345</span>
    <span class="n">_seed</span> <span class="o">&lt;&lt;</span> <span class="n">seed2</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>

    <span class="c1"># HIWORD</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">seed1</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">seed1</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># LOWORD</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">seed2</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">seed2</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">16</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\userpl.py : 36 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">core</span> <span class="k">as</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..memiof</span> <span class="kn">import</span> <span class="n">f_dwread_epd</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">f_getuserplayerid</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x512684</span><span class="p">))</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\eudlib\utilf\__init__.py : 66 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.logic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDAnd</span><span class="p">,</span>
    <span class="n">EUDOr</span><span class="p">,</span>
    <span class="n">EUDNot</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.userpl</span> <span class="kn">import</span> <span class="n">f_getuserplayerid</span>

<span class="kn">from</span> <span class="nn">.random</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_getseed</span><span class="p">,</span>
    <span class="n">f_srand</span><span class="p">,</span>
    <span class="n">f_rand</span><span class="p">,</span>
    <span class="n">f_dwrand</span><span class="p">,</span>
    <span class="n">f_randomize</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.mempatch</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_dwpatch_epd</span><span class="p">,</span>
    <span class="n">f_blockpatch_epd</span><span class="p">,</span>
    <span class="n">f_unpatchall</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.pexist</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">f_playerexist</span><span class="p">,</span>
    <span class="n">EUDPlayerLoop</span><span class="p">,</span>
    <span class="n">EUDEndPlayerLoop</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.listloop</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDLoopList</span><span class="p">,</span>
    <span class="n">EUDLoopUnit</span><span class="p">,</span>
    <span class="n">EUDLoopSprite</span><span class="p">,</span>
    <span class="n">EUDLoopBullet</span><span class="p">,</span>
    <span class="n">EUDLoopTrigger</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.binsearch</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDBinaryMin</span><span class="p">,</span>
    <span class="n">EUDBinaryMax</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\loadmap.py : 45 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..core.mapdata</span> <span class="kn">import</span> <span class="n">chktok</span><span class="p">,</span> <span class="n">mpqapi</span><span class="p">,</span> <span class="n">mapdata</span>
<span class="kn">from</span> <span class="nn">.mpqadd</span> <span class="kn">import</span> <span class="n">UpdateFileListByListfile</span>


<span class="k">def</span> <span class="nf">LoadMap</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load basemap from fname</span>

<span class="sd">    :param fname: Path for basemap.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Loading map </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">rawfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">mpqr</span> <span class="o">=</span> <span class="n">mpqapi</span><span class="o">.</span><span class="n">MpqRead</span><span class="p">()</span>
    <span class="n">mpqr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">chkt</span> <span class="o">=</span> <span class="n">chktok</span><span class="o">.</span><span class="n">CHK</span><span class="p">()</span>
    <span class="n">chkt</span><span class="o">.</span><span class="n">loadchk</span><span class="p">(</span><span class="n">mpqr</span><span class="o">.</span><span class="n">Extract</span><span class="p">(</span><span class="s1">&#39;staredit</span><span class="se">\\</span><span class="s1">scenario.chk&#39;</span><span class="p">))</span>
    <span class="n">mapdata</span><span class="o">.</span><span class="n">InitMapData</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">rawfile</span><span class="p">)</span>
    <span class="n">UpdateFileListByListfile</span><span class="p">(</span><span class="n">mpqr</span><span class="p">)</span>
    <span class="n">mpqr</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\mpqadd.py : 108 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>

<span class="n">_addedFiles</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">UpdateFileListByListfile</span><span class="p">(</span><span class="n">mpqr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use listfile to get list of already existing files.&quot;&quot;&quot;</span>

    <span class="n">_addedFiles</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">flist</span> <span class="o">=</span> <span class="n">mpqr</span><span class="o">.</span><span class="n">EnumFiles</span><span class="p">()</span>

    <span class="c1"># no listfile -&gt; add default listfile</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flist</span><span class="p">:</span>
        <span class="n">flist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;staredit</span><span class="se">\\</span><span class="s1">scenario.chk&#39;</span><span class="p">,</span>
            <span class="s1">&#39;(listfile)&#39;</span>
        <span class="p">]</span>

    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">flist</span><span class="p">:</span>
        <span class="n">MPQAddFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MPQAddFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">isWave</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add file/wave to output map.</span>

<span class="sd">    :param fname: Desired filename in mpq</span>
<span class="sd">    :param content: Content to put inside.</span>
<span class="sd">    :param isWave: Is file wave file? Wave file can be lossy compressed if this</span>
<span class="sd">        flag is set to True.</span>

<span class="sd">    .. note::</span>
<span class="sd">        This function may error if duplicate filenames is found. However, not</span>
<span class="sd">        all duplicated filenames are guaranteed to be catched here. Some of</span>
<span class="sd">        them may be catched at UpdateMPQ(internal) function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make fname case_insensitive</span>
    <span class="n">fname_key</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">or</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)</span> <span class="ow">or</span>
        <span class="n">content</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s2">&quot;Invalid content type&quot;</span>
    <span class="p">)</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span>
        <span class="n">fname_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_addedFiles</span><span class="p">,</span>
        <span class="s2">&quot;MPQ filename duplicate : </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fname</span>
    <span class="p">)</span>

    <span class="n">_addedFiles</span><span class="p">[</span><span class="n">fname_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">isWave</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MPQAddWave</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add wave to output map.</span>

<span class="sd">    :param fname: Desired filename in mpq</span>
<span class="sd">    :param content: Content to put inside.</span>

<span class="sd">    .. note:: See `MPQAddFile` for more info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MPQAddFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">UpdateMPQ</span><span class="p">(</span><span class="n">mpqw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Really append additional mpq file to mpq file.</span>

<span class="sd">    `MPQAddFile` queues addition, and UpdateMPQ really adds them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">isWave</span> <span class="ow">in</span> <span class="n">_addedFiles</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isWave</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">mpqw</span><span class="o">.</span><span class="n">PutWave</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">content</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">mpqw</span><span class="o">.</span><span class="n">PutFile</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">u2b</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">content</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPError</span><span class="p">(</span>
                    <span class="s1">&#39;Failed adding file </span><span class="si">%s</span><span class="s1"> to mpq: May be duplicate&#39;</span> <span class="o">%</span> <span class="n">fname</span>
                <span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\savemap.py : 64 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..core.mapdata</span> <span class="kn">import</span> <span class="n">mapdata</span><span class="p">,</span> <span class="n">mpqapi</span>

<span class="kn">from</span> <span class="nn">.injector.applyInjector</span> <span class="kn">import</span> <span class="n">applyInjector</span>
<span class="kn">from</span> <span class="nn">.inlinecode.ilcprocesstrig</span> <span class="kn">import</span> <span class="n">PreprocessInlineCode</span>
<span class="kn">from</span> <span class="nn">.injector.doevents</span> <span class="kn">import</span> <span class="n">_MainStarter</span>
<span class="kn">from</span> <span class="nn">.mpqadd</span> <span class="kn">import</span> <span class="n">UpdateMPQ</span>


<span class="k">def</span> <span class="nf">SaveMap</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">rootf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save output map with root function.</span>

<span class="sd">    :param fname: Path for output map.</span>
<span class="sd">    :param rootf: Main entry function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Saving to </span><span class="si">%s</span><span class="s1">...&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">chkt</span> <span class="o">=</span> <span class="n">mapdata</span><span class="o">.</span><span class="n">GetChkTokenized</span><span class="p">()</span>

    <span class="c1"># Add payload</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">_MainStarter</span><span class="p">(</span><span class="n">rootf</span><span class="p">)</span>
    <span class="n">PreprocessInlineCode</span><span class="p">(</span><span class="n">chkt</span><span class="p">)</span>
    <span class="n">mapdata</span><span class="o">.</span><span class="n">UpdateMapData</span><span class="p">()</span>
    <span class="n">applyInjector</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

    <span class="n">chkt</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
    <span class="n">rawchk</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">savechk</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Output scenario.chk : </span><span class="si">%.3f</span><span class="s1">MB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rawchk</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">))</span>

    <span class="c1"># Process by modifying existing mpqfile</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mapdata</span><span class="o">.</span><span class="n">GetRawFile</span><span class="p">())</span>

    <span class="n">mw</span> <span class="o">=</span> <span class="n">mpqapi</span><span class="o">.</span><span class="n">MpqWrite</span><span class="p">()</span>
    <span class="n">mw</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">mw</span><span class="o">.</span><span class="n">PutFile</span><span class="p">(</span><span class="s1">&#39;staredit</span><span class="se">\\</span><span class="s1">scenario.chk&#39;</span><span class="p">,</span> <span class="n">rawchk</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">UpdateMPQ</span><span class="p">(</span><span class="n">mw</span><span class="p">)</span>
    <span class="c1"># mw.DeleteFile(&#39;(listfile)&#39;)</span>
    <span class="n">mw</span><span class="o">.</span><span class="n">Compact</span><span class="p">()</span>
    <span class="n">mw</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\__init__.py : 30 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.loadmap</span> <span class="kn">import</span> <span class="n">LoadMap</span>
<span class="kn">from</span> <span class="nn">.savemap</span> <span class="kn">import</span> <span class="n">SaveMap</span>
<span class="kn">from</span> <span class="nn">.injector.doevents</span> <span class="kn">import</span> <span class="n">EUDDoEvents</span>
<span class="kn">from</span> <span class="nn">.mpqadd</span> <span class="kn">import</span> <span class="n">MPQAddFile</span><span class="p">,</span> <span class="n">MPQAddWave</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\injector\applyInjector.py : 48 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...utils.blockstru</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BlockStruManager</span><span class="p">,</span>
    <span class="n">SetCurrentBlockStruManager</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.vectorReloc</span> <span class="kn">import</span> <span class="n">CreateVectorRelocator</span>
<span class="kn">from</span> <span class="nn">.payloadReloc</span> <span class="kn">import</span> <span class="n">CreatePayloadRelocator</span>
<span class="kn">from</span> <span class="nn">.injFinalizer</span> <span class="kn">import</span> <span class="n">CreateInjectFinalizer</span>


<span class="k">def</span> <span class="nf">applyInjector</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="c1"># Create injector triggers</span>
    <span class="n">bsm</span> <span class="o">=</span> <span class="n">BlockStruManager</span><span class="p">()</span>
    <span class="n">prev_bsm</span> <span class="o">=</span> <span class="n">SetCurrentBlockStruManager</span><span class="p">(</span><span class="n">bsm</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">CreateInjectFinalizer</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">CreatePayload</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">final_payload</span> <span class="o">=</span> <span class="n">CreatePayloadRelocator</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">CreateVectorRelocator</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">final_payload</span><span class="p">)</span>

    <span class="n">SetCurrentBlockStruManager</span><span class="p">(</span><span class="n">prev_bsm</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\injector\doevents.py : 67 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">eudlib</span> <span class="k">as</span> <span class="n">sf</span>
<span class="kn">from</span> <span class="nn">...eudlib.stringf.dbstr</span> <span class="kn">import</span> <span class="n">_f_initextstr</span>


<span class="n">jumper</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">_MainStarter</span><span class="p">(</span><span class="n">mf</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">jumper</span>
    <span class="n">jumper</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">():</span>
        <span class="n">rootstarter</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="n">_f_initextstr</span><span class="p">()</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">f_getcurpl</span><span class="p">()</span>  <span class="c1"># Nessecary. See comments on f_getcurpl</span>

        <span class="n">mf</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="mh">0x80000000</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">jumper</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">jumper</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">nextptr</span><span class="o">=</span><span class="n">rootstarter</span><span class="p">)</span>

    <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jumper</span>


<span class="k">def</span> <span class="nf">EUDDoEvents</span><span class="p">():</span>
    <span class="n">oldcp</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_getcurpl</span><span class="p">()</span>

    <span class="n">_t</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">jumper</span><span class="p">,</span> <span class="n">_t</span><span class="p">))</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="mh">0x80000000</span><span class="p">)</span>
    <span class="n">_t</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="n">sf</span><span class="o">.</span><span class="n">f_setcurpl</span><span class="p">(</span><span class="n">oldcp</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\injector\injFinalizer.py : 250 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">trigger</span> <span class="k">as</span> <span class="n">trg</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">eudlib</span> <span class="k">as</span> <span class="n">sf</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">...trigtrg</span> <span class="kn">import</span> <span class="n">runtrigtrg</span> <span class="k">as</span> <span class="n">rtt</span>
<span class="kn">from</span> <span class="nn">..inlinecode.ilcprocesstrig</span> <span class="kn">import</span> <span class="n">GetInlineCodeList</span>


<span class="sd">&#39;&#39;&#39; Stage 3:</span>
<span class="sd">- Fixes nextptr modification to TRIG triggers by stage 1</span>
<span class="sd">- Flip property value by trig section</span>
<span class="sd">- Dispatch inline codes</span>
<span class="sd">- Create infinite executer for root</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">_DispatchInlineCode</span><span class="p">(</span><span class="n">trigepd</span><span class="p">):</span>
    <span class="n">cs0</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>  <span class="c1"># set cs0+20 to codeStart</span>
    <span class="n">cs1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>  <span class="c1"># set cs1+20 to ut.EPD(codeEnd) + 1</span>
    <span class="n">cs2</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>  <span class="c1"># set cs2+20 to cs_a0_epd + 4</span>
    <span class="n">cs3</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>  <span class="c1"># set cs3+20 to cs_a0_epd + 5</span>
    <span class="n">resetter</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="n">nextptr</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">trigepd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">trigepd</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">funcID</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">GetInlineCodeList</span><span class="p">():</span>
        <span class="n">codeStart</span><span class="p">,</span> <span class="n">codeEnd</span> <span class="o">=</span> <span class="n">func</span>
        <span class="n">cs_a0_epd</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">codeStart</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="n">funcID</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cs0</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">codeStart</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cs1</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">codeEnd</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cs2</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">cs_a0_epd</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">cs3</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">cs_a0_epd</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">resetter</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">resetter</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">nt</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">nt</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="n">end</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
        <span class="c1"># Reset t&#39;s nextptr</span>
        <span class="n">resetter</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

        <span class="c1"># SetNextPtr for this trigger</span>
        <span class="c1"># action #1</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">trigepd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">cs0</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

        <span class="c1"># SetNextPtr for codeend</span>
        <span class="c1"># action #2</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="n">cs1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">nextptr</span><span class="p">),</span>

        <span class="c1"># This trigger sets argument for cs_a0_epd</span>
        <span class="c1"># cs_a0 will be SetNextPtr(trigepd + 1, nextptr) after this</span>
        <span class="c1"># action #3</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="n">cs2</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">trigepd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>

        <span class="c1"># action #4</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="n">cs3</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">SetMemoryEPD</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">nextptr</span><span class="p">),</span>
    <span class="p">])</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">_FlipProp</span><span class="p">(</span><span class="n">trigepd</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Iterate through triggers and flip &#39;Trigger disabled&#39; flag</span>

<span class="sd">    Also, dispatch inline codes</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhileNot</span><span class="p">()([</span><span class="n">trigepd</span> <span class="o">&gt;=</span> <span class="mh">0x3FD56E6E</span><span class="p">,</span> <span class="n">trigepd</span> <span class="o">&lt;=</span> <span class="mh">0x3FD56E86</span><span class="p">]):</span>
        <span class="n">prop_epd</span> <span class="o">=</span> <span class="n">trigepd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">2048</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
        <span class="c1"># trigepd&#39;s nextptr may change during flipping process, so</span>
        <span class="c1"># we get it now.</span>
        <span class="n">nexttrigepd</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_epdread_epd</span><span class="p">(</span><span class="n">trigepd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">//</span> <span class="mi">4</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">prop_epd</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>  <span class="c1"># Preserved</span>
            <span class="n">sf</span><span class="o">.</span><span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="n">prop_epd</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>  <span class="c1"># Disable now</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDElse</span><span class="p">()():</span>
            <span class="n">sf</span><span class="o">.</span><span class="n">f_dwsubtract_epd</span><span class="p">(</span><span class="n">prop_epd</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

        <span class="c1"># Dispatch inline code</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">prop_epd</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="mh">0x10000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="n">sf</span><span class="o">.</span><span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="n">prop_epd</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># Preserve</span>
            <span class="n">_DispatchInlineCode</span><span class="p">(</span><span class="n">trigepd</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

        <span class="n">trigepd</span> <span class="o">&lt;&lt;</span> <span class="n">nexttrigepd</span>

    <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">CreateInjectFinalizer</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="n">rtt</span><span class="o">.</span><span class="n">AllocTrigTriggerLink</span><span class="p">()</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="mh">0x51A280</span>

    <span class="c1"># Apply inline code patch</span>
    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">():</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="c1"># Revert nextptr</span>
        <span class="n">triggerend</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">ptsprev_epd</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">f_dwwrite_epd</span><span class="p">(</span><span class="n">ptsprev_epd</span><span class="p">,</span> <span class="n">triggerend</span><span class="p">)</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="c1"># revert mrgndata</span>
        <span class="n">mrgndata</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;MRGN&#39;</span><span class="p">)</span>
        <span class="n">mrgndata_db</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">mrgndata</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">f_repmovsd_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x58DC60</span><span class="p">),</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">mrgndata_db</span><span class="p">),</span> <span class="mi">5100</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Flip TRIG properties</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">_FlipProp</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">f_epdread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>

        <span class="c1"># Create payload for each players &amp; Link them with pts</span>
        <span class="n">lasttime</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">curtime</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
        <span class="n">tmcheckt</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="n">trs</span> <span class="o">=</span> <span class="n">rtt</span><span class="o">.</span><span class="n">_runner_start</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>
            <span class="n">tre</span> <span class="o">=</span> <span class="n">rtt</span><span class="o">.</span><span class="n">_runner_end</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>

            <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">()</span>

            <span class="c1"># Crash preventer</span>
            <span class="n">tstart</span><span class="p">,</span> <span class="n">_t0</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
            <span class="n">tstart</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">prevptr</span><span class="o">=</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">nextptr</span><span class="o">=</span><span class="n">trs</span><span class="p">,</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">_t0</span><span class="p">)]</span>
            <span class="p">)</span>

            <span class="n">_t0</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">nextptr</span><span class="o">=</span><span class="n">tmcheckt</span><span class="p">,</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="c1"># reset</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">trs</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

            <span class="n">prevtstart</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">8</span><span class="p">))</span>
            <span class="n">prevtend</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>

            <span class="c1"># If there were triggers</span>
            <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIfNot</span><span class="p">()(</span><span class="n">prevtstart</span> <span class="o">==</span> <span class="o">~</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)):</span>
                <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">([</span>
                    <span class="c1"># Link pts</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">tstart</span><span class="p">),</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">tre</span><span class="p">),</span>

                    <span class="c1"># Link trs</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">trs</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">prevtstart</span><span class="p">),</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">prevtend</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">tre</span><span class="p">),</span>

                    <span class="c1"># Cache dlist start &amp; end</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">rtt</span><span class="o">.</span><span class="n">orig_tstart</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span>
                                <span class="n">prevtstart</span><span class="p">),</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">rtt</span><span class="o">.</span><span class="n">orig_tend</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span>
                                <span class="n">prevtend</span><span class="p">),</span>
                <span class="p">])</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">():</span>
            <span class="n">tmcheckt</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
            <span class="n">curtime</span> <span class="o">&lt;&lt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x57F23C</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDIf</span><span class="p">()(</span><span class="n">lasttime</span> <span class="o">&lt;</span> <span class="n">curtime</span><span class="p">):</span>
                <span class="n">lasttime</span> <span class="o">&lt;&lt;</span> <span class="n">curtime</span>
                <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndIf</span><span class="p">()</span>

            <span class="c1"># Set current player to 1.</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="mh">0x80000000</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

        <span class="c1"># lasttime &lt;&lt; curtime</span>
        <span class="n">curtime</span> <span class="o">&lt;&lt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mh">0x57F23C</span><span class="p">))</span>
        <span class="n">lasttime</span> <span class="o">&lt;&lt;</span> <span class="n">curtime</span>

        <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Current player = 1</span>

        <span class="c1"># now jump to root</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\injector\payloadReloc.py : 84 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">eudlib</span> <span class="k">as</span> <span class="n">sf</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">varfunc</span> <span class="k">as</span> <span class="n">vf</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>

<span class="sd">&#39;&#39;&#39; Stage 2 :</span>
<span class="sd">- Initialize payload (stage3+ + user code) &amp; execute it</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">CreatePayloadRelocator</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
    <span class="c1"># We first build code injector.</span>
    <span class="n">prtdb</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">x</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">prttable</span><span class="p">]))</span>
    <span class="n">prtn</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="n">ortdb</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">x</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">orttable</span><span class="p">]))</span>
    <span class="n">ortn</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>

    <span class="n">orig_payload</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">():</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="c1"># Verify payload</span>
        <span class="c1"># Note : this is very, very basic protection method. Intended attackers</span>
        <span class="c1"># should be able to penetrate through this very easily</span>

        <span class="c1"># init prt</span>
        <span class="n">prtn</span> <span class="o">&lt;&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">prttable</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">payload</span><span class="o">.</span><span class="n">prttable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">prtn</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">prtn</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">sf</span><span class="o">.</span><span class="n">f_dwadd_epd</span><span class="p">(</span>
                    <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">orig_payload</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">prtn</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">prtdb</span><span class="p">)),</span>
                    <span class="n">orig_payload</span> <span class="o">//</span> <span class="mi">4</span>
                <span class="p">)</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>

        <span class="c1"># init ort</span>
        <span class="n">ortn</span> <span class="o">&lt;&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">orttable</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">payload</span><span class="o">.</span><span class="n">orttable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">EUDWhile</span><span class="p">()(</span><span class="n">ortn</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">cs</span><span class="o">.</span><span class="n">DoActions</span><span class="p">(</span><span class="n">ortn</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">sf</span><span class="o">.</span><span class="n">f_dwadd_epd</span><span class="p">(</span>
                    <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">orig_payload</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">sf</span><span class="o">.</span><span class="n">f_dwread_epd</span><span class="p">(</span><span class="n">ortn</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">ortdb</span><span class="p">)),</span>
                    <span class="n">orig_payload</span>
                <span class="p">)</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">EUDEndWhile</span><span class="p">()</span>

        <span class="c1"># Jump</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJump</span><span class="p">(</span><span class="n">orig_payload</span><span class="p">)</span>

    <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">CreatePayload</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\injector\vectorReloc.py : 365 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39; Stage 1 : works in TRIG section.</span>
<span class="sd">- Check if EUD is available. If not, defeat</span>
<span class="sd">- Initialize stage 2 &amp; execute it</span>
<span class="sd">- Modifies TRIG rawtrigger&#39;s nextptr. Modification is fixed in stage 3.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">...trigtrg</span> <span class="kn">import</span> <span class="n">trigtrg</span> <span class="k">as</span> <span class="n">tt</span>


<span class="n">trglist</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">Trigger</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">trglist</span>
    <span class="n">trglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">CopyDeaths</span><span class="p">(</span><span class="n">iplayer</span><span class="p">,</span> <span class="n">oplayer</span><span class="p">,</span> <span class="n">copyepd</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">initvalue</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">tmpplayer</span> <span class="o">=</span> <span class="mi">11</span>

    <span class="k">if</span> <span class="n">initvalue</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">copyepd</span><span class="p">:</span>
            <span class="n">initvalue</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initvalue</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">Trigger</span><span class="p">(</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">oplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">initvalue</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">tmpplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">copyepd</span><span class="p">:</span>
            <span class="n">subval</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">subval</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span>

        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">iplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">iplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">tmpplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">oplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">subval</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">players</span><span class="o">=</span><span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">AllPlayers</span><span class="p">],</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">tmpplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">iplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">tmpplayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">CreateVectorRelocator</span><span class="p">(</span><span class="n">chkt</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">trglist</span>

    <span class="c1"># Append &#39;Require EUD enabler&#39; to string table</span>
    <span class="n">str_section</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;STR&#39;</span><span class="p">)</span>
    <span class="n">strtb</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">TBL</span><span class="p">(</span><span class="n">str_section</span><span class="p">)</span>
    <span class="n">eude_needed</span> <span class="o">=</span> <span class="n">strtb</span><span class="o">.</span><span class="n">GetStringIndex</span><span class="p">(</span><span class="s1">&#39;This map requires EUD Enabler to run&#39;</span><span class="p">)</span>
    <span class="n">str_section</span> <span class="o">=</span> <span class="n">strtb</span><span class="o">.</span><span class="n">SaveTBL</span><span class="p">()</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Algorithm credit to klassical_31@naver.com</span>

<span class="sd">    Overall algorithm : STR &lt;-&gt; MRGN cycle</span>

<span class="sd">    MRGN:</span>
<span class="sd">      SetMemory(payload, Add, payload_offset // 4)</span>

<span class="sd">    MRGN &lt;-&gt; STR0  =  Trigger(actions=[</span>
<span class="sd">             STR1        [SetMemory(</span>
<span class="sd">                            mrgn.action[i].player,</span>
<span class="sd">                            Add,</span>
<span class="sd">                            prttable[j+packn] - prttable[j]</span>
<span class="sd">                          ) for i in range(packn)],</span>
<span class="sd">             STR2        SetNextPtr(mrgn, STR[k+1])</span>
<span class="sd">             ...      )</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">mrgn</span> <span class="o">=</span> <span class="mh">0x58DC60</span>
    <span class="n">packn</span> <span class="o">=</span> <span class="mi">15</span>

    <span class="c1">#############</span>
    <span class="c1"># STR SECTION</span>
    <span class="c1">#############</span>
    <span class="n">str_sled</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sledheader_prt</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0\0\0\0</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">mrgn</span><span class="p">)</span>
    <span class="n">sledheader_ort</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0\0\0\0</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span><span class="p">)</span>

    <span class="c1"># apply prt</span>
    <span class="n">prttrg_start</span> <span class="o">=</span> <span class="mi">2408</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_sled</span><span class="p">)</span>  <span class="c1"># = 0</span>
    <span class="c1"># mrgn.action[i].player = EPD(payload_offset) + prevoffset[i]</span>
    <span class="n">prevoffset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">packn</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">prttable</span><span class="p">),</span> <span class="n">packn</span><span class="p">):</span>
        <span class="n">prts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">prttable</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">packn</span><span class="p">]))</span>
        <span class="n">prts</span> <span class="o">=</span> <span class="n">prts</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">packn</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prts</span><span class="p">))</span>  <span class="c1"># -1 : dummy space</span>
        <span class="n">pch</span> <span class="o">=</span> <span class="p">[</span><span class="n">prts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">prevoffset</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)]</span>
        <span class="n">str_sled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sledheader_prt</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">328</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">pch</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="p">))</span>

        <span class="n">prevoffset</span> <span class="o">=</span> <span class="n">prts</span>

    <span class="c1"># apply ort</span>
    <span class="n">orttrg_start</span> <span class="o">=</span> <span class="mi">2408</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_sled</span><span class="p">)</span>  <span class="c1"># = 0</span>
    <span class="c1"># mrgn.action[i].player = EPD(payload_offset) + prevoffset[i]</span>
    <span class="n">prevoffset</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">packn</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">orttable</span><span class="p">),</span> <span class="n">packn</span><span class="p">):</span>
        <span class="n">orts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">orttable</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">packn</span><span class="p">]))</span>
        <span class="n">orts</span> <span class="o">=</span> <span class="n">orts</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">packn</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">orts</span><span class="p">))</span>  <span class="c1"># -1 : dummy space</span>
        <span class="n">pch</span> <span class="o">=</span> <span class="p">[</span><span class="n">orts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">prevoffset</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)]</span>
        <span class="n">str_sled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sledheader_ort</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">328</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">pch</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="p">))</span>

        <span class="n">prevoffset</span> <span class="o">=</span> <span class="n">orts</span>

    <span class="c1"># jump to ort</span>
    <span class="n">str_sled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sledheader_ort</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">328</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span>
                          <span class="mh">0xFFFFFFFF</span> <span class="o">-</span> <span class="n">prevoffset</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># skip garbage area</span>
        <span class="p">]</span>
    <span class="p">))</span>

    <span class="c1"># sled completed</span>
    <span class="n">str_sled</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_sled</span><span class="p">)</span>

    <span class="n">str_padding_length</span> <span class="o">=</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">str_section</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span>
    <span class="n">strsled_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_section</span><span class="p">)</span> <span class="o">+</span> <span class="n">str_padding_length</span>
    <span class="n">payload_offset</span> <span class="o">=</span> <span class="n">strsled_offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_sled</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="n">str_section</span> <span class="o">=</span> <span class="n">str_section</span> <span class="o">+</span> \
        <span class="nb">bytes</span><span class="p">(</span><span class="n">str_padding_length</span><span class="p">)</span> <span class="o">+</span> <span class="n">str_sled</span> <span class="o">+</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0\0\0\0</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload</span><span class="o">.</span><span class="n">data</span>
    <span class="n">chkt</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="s1">&#39;STR&#39;</span><span class="p">,</span> <span class="n">str_section</span><span class="p">)</span>

    <span class="c1">##############</span>
    <span class="c1"># MRGN SECTION</span>
    <span class="c1">##############</span>
    <span class="n">mrgn_trigger</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mrgn_trigger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">prttrg_start</span> <span class="o">+</span> <span class="n">strsled_offset</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="c1"># SetDeaths actions in MRGN initially points to EPD(payload -</span>
                <span class="c1"># 4)</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">payload_offset</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">payload_offset</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2408</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">mrgn_trigger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">orttrg_start</span> <span class="o">+</span> <span class="n">strsled_offset</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">payload_offset</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">payload_offset</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2408</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">mrgn_section</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrgn_trigger</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">5100</span> <span class="o">-</span> <span class="mi">2408</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">chkt</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="s1">&#39;MRGN&#39;</span><span class="p">,</span> <span class="n">mrgn_section</span><span class="p">)</span>

    <span class="c1">##############</span>
    <span class="c1"># TRIG SECTION</span>
    <span class="c1">##############</span>
    <span class="n">trglist</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Check if epd is supported</span>
    <span class="n">Trigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">Trigger</span><span class="p">(</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">DisplayTextMessage</span><span class="p">(</span><span class="n">eude_needed</span><span class="p">),</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># End trigger execution if EUDA is not supported</span>
    <span class="c1">#  - using condition #115 twice.</span>
    <span class="n">Trigger</span><span class="p">(</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">Condition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">Trigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="c1"># -------</span>

    <span class="c1"># Init mrgn rawtrigger</span>
    <span class="n">strs</span> <span class="o">=</span> <span class="mh">0x5993D4</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># prt table</span>
        <span class="c1"># player</span>
        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">328</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">328</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">),</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span>
                    <span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">328</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">),</span>
                <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">mrgn</span> <span class="o">+</span> <span class="mi">2408</span> <span class="o">+</span> <span class="mi">328</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">packn</span><span class="p">)],</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Payload update</span>
    <span class="n">curpl</span> <span class="o">=</span> <span class="mh">0x6509B0</span>

    <span class="c1"># -------</span>

    <span class="c1"># pts[player].lasttrigger-&gt;next = value(strs) + strsled_offset</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="mh">0x51A280</span>

    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">triggerend</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x51A284</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span>

        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">players</span><span class="o">=</span><span class="p">[</span><span class="n">player</span><span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">curpl</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pts</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">player</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">triggerend</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Used in stage 2</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># read pts[player].lasttrigger</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># apply to curpl</span>
    <span class="n">Trigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">curpl</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="p">])</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Trigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="c1"># used for nextptr recovery in stage 3</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">curpl</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># now curpl = EPD(value(ptsprev) + 4)</span>
    <span class="c1"># value(EPD(value(ptsprev) + 4)) = strs + payload_offset</span>
    <span class="n">CopyDeaths</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">strs</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">strsled_offset</span><span class="p">)</span>

    <span class="c1"># Done!</span>
    <span class="n">trigdata</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trglist</span><span class="p">)</span>

    <span class="c1"># Stage 1 created</span>

    <span class="c1"># -------</span>

    <span class="c1"># Previous rawtrigger datas</span>

    <span class="n">oldtrigraw</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;TRIG&#39;</span><span class="p">)</span>
    <span class="n">oldtrigs</span> <span class="o">=</span> <span class="p">[</span><span class="n">oldtrigraw</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2400</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldtrigraw</span><span class="p">),</span> <span class="mi">2400</span><span class="p">)]</span>
    <span class="n">proc_trigs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Collect only enabled triggers</span>
    <span class="k">for</span> <span class="n">trig</span> <span class="ow">in</span> <span class="n">oldtrigs</span><span class="p">:</span>
        <span class="n">trig</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">trig</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i4</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">2048</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># Trigger already disabled</span>
            <span class="k">pass</span>

        <span class="n">flag</span> <span class="o">^=</span> <span class="mi">8</span>  <span class="c1"># Disable it temporarilly. It will be re-enabled at stage 3</span>
        <span class="n">trig</span><span class="p">[</span><span class="mi">320</span> <span class="o">+</span> <span class="mi">2048</span><span class="p">:</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">2048</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="n">proc_trigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">trig</span><span class="p">))</span>

    <span class="n">oldtrigraw_processed</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proc_trigs</span><span class="p">)</span>
    <span class="n">chkt</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="s1">&#39;TRIG&#39;</span><span class="p">,</span> <span class="n">trigdata</span> <span class="o">+</span> <span class="n">oldtrigraw_processed</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\injector\__init__.py : 25 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\inlinecode\ilccompile.py : 84 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">trigger</span> <span class="k">as</span> <span class="n">t</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">eudlib</span> <span class="k">as</span> <span class="n">sf</span>

<span class="kn">import</span> <span class="nn">types</span>

<span class="n">_inlineGlobals</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">ComputeBaseInlineCodeGlobals</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return list of globals inline eudplib code can call.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">_inlineGlobals</span>

    <span class="c1"># Add eudplib functions</span>
    <span class="n">G</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="n">ut</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">G</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">_inlineGlobals</span> <span class="o">=</span> <span class="n">G</span>


<span class="k">def</span> <span class="nf">GetInlineCodeGlobals</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return list of globals inline eudplib code can call.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">_inlineGlobals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Add custom registered functions</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">GetEUDNamespace</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">G</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">return</span> <span class="n">G</span>


<span class="k">def</span> <span class="nf">CompileInlineCode</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s1">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">():</span>
        <span class="n">tStart</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">GetInlineCodeGlobals</span><span class="p">(),</span> <span class="p">{})</span>
        <span class="n">tEnd</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">tStart</span><span class="p">,</span> <span class="n">tEnd</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\inlinecode\ilcprocesstrig.py : 137 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">...trigtrg</span> <span class="kn">import</span> <span class="n">trigtrg</span> <span class="k">as</span> <span class="n">tt</span>

<span class="kn">from</span> <span class="nn">.ilccompile</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ComputeBaseInlineCodeGlobals</span><span class="p">,</span>
    <span class="n">CompileInlineCode</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">_inlineCodes</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">PreprocessInlineCode</span><span class="p">(</span><span class="n">chkt</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_inlineCodes</span>
    <span class="n">trigSection</span> <span class="o">=</span> <span class="n">chkt</span><span class="o">.</span><span class="n">getsection</span><span class="p">(</span><span class="s1">&#39;TRIG&#39;</span><span class="p">)</span>
    <span class="n">_inlineCodes</span><span class="p">,</span> <span class="n">trigSection</span> <span class="o">=</span> <span class="n">PreprocessTrigSection</span><span class="p">(</span><span class="n">trigSection</span><span class="p">)</span>
    <span class="n">chkt</span><span class="o">.</span><span class="n">setsection</span><span class="p">(</span><span class="s1">&#39;TRIG&#39;</span><span class="p">,</span> <span class="n">trigSection</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">PreprocessTrigSection</span><span class="p">(</span><span class="n">trigSection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fetch inline codes &amp; compiles them &quot;&quot;&quot;</span>
    <span class="n">ComputeBaseInlineCodeGlobals</span><span class="p">()</span>

    <span class="n">inlineCodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">trigSegments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trigSection</span><span class="p">),</span> <span class="mi">2400</span><span class="p">):</span>
        <span class="n">trigSegment</span> <span class="o">=</span> <span class="n">trigSection</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2400</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trigSegment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2400</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">decoded</span> <span class="o">=</span> <span class="n">DecodeSpecialData</span><span class="p">(</span><span class="n">inlineCodes</span><span class="p">,</span> <span class="n">trigSegment</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decoded</span><span class="p">:</span>
            <span class="n">trigSegment</span> <span class="o">=</span> <span class="n">decoded</span>

        <span class="n">trigSegments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trigSegment</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is rather hard to explain, but we need blank trigger.</span>

<span class="sd">    If inline_eudplib trigger is at the last of the trigger, then its</span>
<span class="sd">    nextptr should be modified to codeStart.</span>

<span class="sd">    But after flipprop works, RunTrigTrigger engine will re-change its nextptr</span>
<span class="sd">    to somewhere else, where everything quits.</span>

<span class="sd">    So we need &#39;normal&#39; trigger at the last of TRIG triggers for every player.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">trigSegments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">players</span><span class="o">=</span><span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">AllPlayers</span><span class="p">]))</span>

    <span class="n">trigSection</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trigSegments</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inlineCodes</span><span class="p">,</span> <span class="n">trigSection</span>


<span class="k">def</span> <span class="nf">GetInlineCodeList</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Get list of compiled inline_eudplib code &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_inlineCodes</span>


<span class="k">def</span> <span class="nf">DecodeSpecialData</span><span class="p">(</span><span class="n">inlineCodes</span><span class="p">,</span> <span class="n">trigger_bytes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if trigger segment has special data. &quot;&quot;&quot;</span>
    <span class="c1"># Check if effplayer &amp; current_action is empty</span>
    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">28</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">trigger_bytes</span><span class="p">[</span><span class="mi">320</span> <span class="o">+</span> <span class="mi">2048</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">player</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="c1"># trg.cond[0].condtype != 0</span>
    <span class="k">if</span> <span class="n">trigger_bytes</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c1"># trg.act[0].acttype != 0</span>
    <span class="k">if</span> <span class="n">trigger_bytes</span><span class="p">[</span><span class="mi">346</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">trigger_bytes</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">320</span><span class="p">]</span> <span class="o">+</span> <span class="n">trigger_bytes</span><span class="p">[</span><span class="mi">352</span><span class="p">:</span><span class="mi">2372</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ProcessInlineCode</span><span class="p">(</span><span class="n">inlineCodes</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ProcessInlineCode</span><span class="p">(</span><span class="n">inlineCodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if trigger segment has inline_eudplib code. &quot;&quot;&quot;</span>
    <span class="n">magicCode</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i4</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># inline_eudplib code</span>
    <span class="k">if</span> <span class="n">magicCode</span> <span class="o">==</span> <span class="mh">0x10978d4a</span><span class="p">:</span>
        <span class="n">playerCode</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i4</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">codeData</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2u</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:])</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Compile code</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">CompileInlineCode</span><span class="p">(</span><span class="n">codeData</span><span class="p">)</span>
        <span class="n">funcID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inlineCodes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1024</span>
        <span class="n">inlineCodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">funcID</span><span class="p">,</span> <span class="n">func</span><span class="p">))</span>

        <span class="c1"># Return new trigger</span>
        <span class="n">newTrigger</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">2400</span><span class="p">)</span>

        <span class="c1"># Apply effplayer</span>
        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">27</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">playerCode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">player</span><span class="p">):</span>
                <span class="n">newTrigger</span><span class="p">[</span><span class="mi">320</span> <span class="o">+</span> <span class="mi">2048</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Apply 4 SetDeaths</span>
        <span class="n">SetDeathsTemplate</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetDeaths</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">newTrigger</span><span class="p">[</span><span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetDeathsTemplate</span>
        <span class="n">newTrigger</span><span class="p">[</span><span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetDeathsTemplate</span>
        <span class="n">newTrigger</span><span class="p">[</span><span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetDeathsTemplate</span>
        <span class="n">newTrigger</span><span class="p">[</span><span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">320</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetDeathsTemplate</span>

        <span class="c1"># Apply flag</span>
        <span class="n">newTrigger</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">i2b4</span><span class="p">(</span><span class="n">funcID</span><span class="p">)</span>
        <span class="n">newTrigger</span><span class="p">[</span><span class="mi">2368</span><span class="p">:</span><span class="mi">2372</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0\0\0\x10</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">newTrigger</span>

    <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\maprw\inlinecode\__init__.py : 26 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.ilcprocesstrig</span> <span class="kn">import</span> <span class="n">PreprocessTrigSection</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigger\branch.py : 82 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.tpatcher</span> <span class="kn">import</span> <span class="n">PatchCondition</span>


<span class="k">def</span> <span class="nf">_EUDBranchSub</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">ontrue</span><span class="p">,</span> <span class="n">onfalse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduced version of EUDBranch with following restructions.</span>
<span class="sd">    - All fields of conditions/actions should be constant.</span>
<span class="sd">    - type(conditions) is list</span>
<span class="sd">    - len(conditions) &lt;= 16</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">16</span>

    <span class="n">brtrg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">tjtrg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">brtrg</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">nextptr</span><span class="o">=</span><span class="n">onfalse</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="n">conditions</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">brtrg</span><span class="p">,</span> <span class="n">tjtrg</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">tjtrg</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">nextptr</span><span class="o">=</span><span class="n">ontrue</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">brtrg</span><span class="p">,</span> <span class="n">onfalse</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDBranch</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">ontrue</span><span class="p">,</span> <span class="n">onfalse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Branch by whether conditions is satisfied or not.</span>

<span class="sd">    :param conditions: Nested list of conditions.</span>
<span class="sd">    :param ontrue: When all conditions are true, this branch is taken.</span>
<span class="sd">    :param onfalse: When any of the conditions are false, this branch is taken.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">PatchCondition</span><span class="p">,</span> <span class="n">conditions</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">nextptr</span><span class="o">=</span><span class="n">ontrue</span><span class="p">)</span>  <span class="c1"># Just jump</span>
        <span class="k">return</span>

    <span class="c1"># Check all conditions</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">),</span> <span class="mi">16</span><span class="p">):</span>
        <span class="n">subontrue</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">subonfalse</span> <span class="o">=</span> <span class="n">onfalse</span>
        <span class="n">_EUDBranchSub</span><span class="p">(</span><span class="n">conditions</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">16</span><span class="p">],</span> <span class="n">subontrue</span><span class="p">,</span> <span class="n">subonfalse</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
            <span class="n">subontrue</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subontrue</span> <span class="o">&lt;&lt;</span> <span class="n">ontrue</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigger\filler.py : 100 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">def</span> <span class="nf">_dww</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="n">act</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">((</span>
        <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">act</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">dstepd</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">act</span> <span class="o">+</span> <span class="mi">20</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span>
    <span class="p">))</span>
    <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">(</span><span class="n">act</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_filldw</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">v1</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">SeqCompute</span><span class="p">((</span>
        <span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span>
    <span class="p">))</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">_fillwbb</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">v1</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">v1</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">v2</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">v2</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">v3</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">v3</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="n">_dww</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">_fillbbbb</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>

    <span class="n">vlist</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vlist</span><span class="p">):</span>
        <span class="n">lsf</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">conditions</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">SubtractNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">AddNumber</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">lsf</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="p">)</span>

    <span class="n">_dww</span><span class="p">(</span><span class="n">dstepd</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigger\ptrigger.py : 131 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">.triggerdef</span> <span class="kn">import</span> <span class="n">Trigger</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="n">_pt_db</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span>
<span class="n">_pinfos</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_pdbtable</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">InitPTrigger</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;(Internal) Enable PTrigger. Internally called by eudplib&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_pinfos</span>
    <span class="k">if</span> <span class="n">_pinfos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_pinfos</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">GetPlayerInfo</span><span class="p">(</span><span class="n">player</span><span class="p">)</span> <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">PTrigger</span><span class="p">(</span><span class="n">players</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Execute trigger by player basis</span>

<span class="sd">    :param players: Players the trigger should execute with. When Current</span>
<span class="sd">        Player specifies any of the players, trigger will execute.</span>
<span class="sd">    :param conditions: List of conditions. If all conditions are met, then</span>
<span class="sd">        actions will be executed.</span>
<span class="sd">    :param actions: List of actions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">InitPTrigger</span><span class="p">()</span>

    <span class="n">players</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
    <span class="n">effp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>

    <span class="c1"># Trigger is never executed if it has no effplayers.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Check whose the player is executed to.</span>
    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
        <span class="n">player</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">EncodePlayer</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">player</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">effp</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="mh">0x12</span> <span class="o">&lt;=</span> <span class="n">player</span> <span class="o">&lt;=</span> <span class="mh">0x15</span><span class="p">:</span>  <span class="c1"># Force 1 ~ 4</span>
            <span class="n">forceIndex</span> <span class="o">=</span> <span class="n">player</span> <span class="o">-</span> <span class="mh">0x12</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_pinfos</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">force</span> <span class="o">==</span> <span class="n">forceIndex</span><span class="p">:</span>
                    <span class="n">effp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="n">player</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">:</span>  <span class="c1"># All players</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                <span class="n">effp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>

    <span class="c1"># Create player table!</span>
    <span class="n">dbb</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\0\0\0\0</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">eff</span> <span class="ow">is</span> <span class="bp">False</span> <span class="k">else</span> <span class="n">b</span><span class="s1">&#39;aaaa&#39;</span> <span class="k">for</span> <span class="n">eff</span> <span class="ow">in</span> <span class="n">effp</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">dbb</span> <span class="ow">in</span> <span class="n">_pdbtable</span><span class="p">:</span>
        <span class="n">pdb</span> <span class="o">=</span> <span class="n">_pdbtable</span><span class="p">[</span><span class="n">dbb</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">pdb</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Db</span><span class="p">(</span><span class="n">dbb</span><span class="p">)</span>
        <span class="n">_pdbtable</span><span class="p">[</span><span class="n">dbb</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdb</span>

    <span class="c1"># effplayer[p] is True  -&gt; Memory(EPD(pdb) + p) == b&#39;aaaa&#39;</span>
    <span class="c1"># effplayer[p] is False -&gt; Memory(EPD(pdb) + p) == b&#39;\0\0\0\0&#39;</span>

    <span class="c1"># Create triggers</span>
    <span class="n">offset_curpl</span> <span class="o">=</span> <span class="mh">0x6509B0</span>
    <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">tc</span><span class="p">,</span> <span class="n">t3</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

    <span class="n">t1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">nextptr</span><span class="o">=</span><span class="n">t3</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span><span class="n">offset_curpl</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">AtMost</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">),</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">offset_curpl</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pdb</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">t2</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">nextptr</span><span class="o">=</span><span class="n">t3</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">Deaths</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">CurrentPlayer</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">b2i4</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;aaaa&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">tc</span><span class="p">),</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">offset_curpl</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pdb</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">tc</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="n">Trigger</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>

    <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">),</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">offset_curpl</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pdb</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">t3</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t3</span><span class="p">),</span>
            <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="n">offset_curpl</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Subtract</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">pdb</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigger\tpatcher.py : 100 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">.filler</span> <span class="kn">import</span> <span class="n">_filldw</span><span class="p">,</span> <span class="n">_fillwbb</span><span class="p">,</span> <span class="n">_fillbbbb</span>


<span class="k">def</span> <span class="nf">HasEUDVariable</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">unProxy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>


<span class="k">def</span> <span class="nf">ApplyPatchTable</span><span class="p">(</span><span class="n">initepd</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">patchTable</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fieldSelector</span><span class="p">(</span><span class="n">fieldName</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fieldName</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fieldName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fieldName</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">patchEntry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">patchTable</span><span class="p">):</span>
        <span class="n">patchFields</span> <span class="o">=</span> <span class="n">patchEntry</span>
        <span class="n">memoryFiller</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">_filldw</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="n">_fillwbb</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="n">_fillbbbb</span><span class="p">,</span>
        <span class="p">}[</span><span class="nb">len</span><span class="p">(</span><span class="n">patchFields</span><span class="p">)]</span>

        <span class="n">fieldList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fieldSelector</span><span class="p">,</span> <span class="n">patchFields</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">HasEUDVariable</span><span class="p">(</span><span class="n">fieldList</span><span class="p">):</span>
            <span class="n">memoryFiller</span><span class="p">(</span><span class="n">initepd</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">fieldList</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fieldName</span> <span class="ow">in</span> <span class="n">patchFields</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fieldName</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fieldName</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="n">condpt</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;locid&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;player&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;unitid&#39;</span><span class="p">,</span> <span class="s1">&#39;comparison&#39;</span><span class="p">,</span> <span class="s1">&#39;condtype&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;restype&#39;</span><span class="p">,</span> <span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">actpt</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;locid1&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;strid&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;wavid&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;player1&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;player2&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;unitid&#39;</span><span class="p">,</span> <span class="s1">&#39;acttype&#39;</span><span class="p">,</span> <span class="s1">&#39;amount&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">PatchCondition</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">EUDVariable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cond</span> <span class="o">&gt;=</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cond</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">Always</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">Never</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ApplyPatchTable</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span> <span class="n">cond</span><span class="p">,</span> <span class="n">condpt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cond</span>


<span class="k">def</span> <span class="nf">PatchAction</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
    <span class="n">ApplyPatchTable</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">EPD</span><span class="p">(</span><span class="n">act</span><span class="p">),</span> <span class="n">act</span><span class="p">,</span> <span class="n">actpt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">act</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigger\triggerdef.py : 127 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">.tpatcher</span> <span class="kn">import</span> <span class="n">PatchCondition</span><span class="p">,</span> <span class="n">PatchAction</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">def</span> <span class="nf">Trigger</span><span class="p">(</span><span class="n">conditions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">preserved</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;General easy-to-use trigger</span>

<span class="sd">    :param conditions: List of conditions. If there are none, trigger will</span>
<span class="sd">        always execute.</span>
<span class="sd">    :param actions: List of actions. If there are none, trigger will have no</span>
<span class="sd">        actions.</span>
<span class="sd">    :param preserved: Is trigger preserved? True by default.</span>

<span class="sd">    .. note::</span>
<span class="sd">        This is &#39;extended&#39; trigger. All conditions and variables can contain</span>
<span class="sd">        `EUDVariable` object, and there may be more than 16 conditions and 64</span>
<span class="sd">        actions. Trigger internally uses `RawTrigger`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">preserved</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="s1">&#39;preserved should be bool&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">conditions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">actions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">conditions</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>

    <span class="c1"># Translate boolean conditions.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cond</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cond</span><span class="p">:</span>
                <span class="n">conditions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Always</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conditions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Never</span><span class="p">()</span>

    <span class="c1"># Normal</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">16</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="p">:</span>
        <span class="n">patched_conds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="n">patched_conds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PatchCondition</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>

        <span class="n">patched_actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">patched_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PatchAction</span><span class="p">(</span><span class="n">act</span><span class="p">))</span>

        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">patched_conds</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="n">patched_actions</span><span class="p">,</span>
            <span class="n">preserved</span><span class="o">=</span><span class="n">preserved</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Extended trigger</span>
        <span class="n">condts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cend</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

        <span class="c1"># Check conditions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">),</span> <span class="mi">16</span><span class="p">):</span>
            <span class="n">conds</span> <span class="o">=</span> <span class="n">conditions</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]</span>
            <span class="n">cts</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>

            <span class="n">patched_conds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conds</span><span class="p">:</span>
                <span class="n">patched_conds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PatchCondition</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>

            <span class="n">nextcond</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
            <span class="n">cts</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">nextptr</span><span class="o">=</span><span class="n">cend</span><span class="p">,</span>
                <span class="n">conditions</span><span class="o">=</span><span class="n">patched_conds</span><span class="p">,</span>
                <span class="n">actions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">cts</span><span class="p">,</span> <span class="n">nextcond</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">nextcond</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

            <span class="n">condts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cts</span><span class="p">)</span>

        <span class="n">skipt</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">preserved</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">skipt</span><span class="p">))</span>

        <span class="c1"># Execute actions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">),</span> <span class="mi">64</span><span class="p">):</span>
            <span class="n">acts</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">64</span><span class="p">]</span>
            <span class="n">patched_actions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
                <span class="n">patched_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PatchAction</span><span class="p">(</span><span class="n">act</span><span class="p">))</span>

            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">patched_actions</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">preserved</span><span class="p">:</span>
            <span class="n">skipt</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

        <span class="c1"># Revert conditions</span>
        <span class="n">cend</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">condts</span><span class="p">),</span> <span class="mi">64</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">cts</span><span class="p">,</span> <span class="n">cend</span><span class="p">)</span> <span class="k">for</span> <span class="n">cts</span> <span class="ow">in</span> <span class="n">condts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">64</span><span class="p">]]</span>
            <span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigger\__init__.py : 29 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.triggerdef</span> <span class="kn">import</span> <span class="n">Trigger</span>
<span class="kn">from</span> <span class="nn">.branch</span> <span class="kn">import</span> <span class="n">EUDBranch</span>
<span class="kn">from</span> <span class="nn">.ptrigger</span> <span class="kn">import</span> <span class="n">PTrigger</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigtrg\runtrigtrg.py : 112 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">c</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">ctrlstru</span> <span class="k">as</span> <span class="n">cs</span>

<span class="n">_runner_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
<span class="n">_runner_end</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

<span class="n">c</span><span class="o">.</span><span class="n">PushTriggerScope</span><span class="p">()</span>
<span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">_runner_start</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">nextptr</span><span class="o">=</span><span class="n">_runner_end</span><span class="p">[</span><span class="n">player</span><span class="p">])</span>
    <span class="n">_runner_end</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span><span class="n">nextptr</span><span class="o">=~</span><span class="p">(</span><span class="mh">0x51A280</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">c</span><span class="o">.</span><span class="n">PopTriggerScope</span><span class="p">()</span>


<span class="nd">@c.EUDFunc</span>
<span class="k">def</span> <span class="nf">RunTrigTrigger</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">eudlib</span> <span class="k">as</span> <span class="n">sf</span>

    <span class="n">oldcp</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">f_getcurpl</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">skipt</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">cs</span><span class="o">.</span><span class="n">EUDJumpIf</span><span class="p">(</span>
            <span class="n">c</span><span class="o">.</span><span class="n">Memory</span><span class="p">(</span>
                <span class="mh">0x51A280</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">player</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">c</span><span class="o">.</span><span class="n">Exactly</span><span class="p">,</span>
                <span class="mh">0x51A280</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">player</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="p">),</span> <span class="n">skipt</span><span class="p">)</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Forward</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">nextptr</span><span class="o">=</span><span class="n">_runner_start</span><span class="p">[</span><span class="n">player</span><span class="p">],</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetMemory</span><span class="p">(</span><span class="mh">0x6509B0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">SetTo</span><span class="p">,</span> <span class="n">player</span><span class="p">),</span>
                <span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span><span class="n">_runner_end</span><span class="p">[</span><span class="n">player</span><span class="p">],</span> <span class="n">nt</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">nt</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">RawTrigger</span><span class="p">(</span>
            <span class="n">actions</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">SetNextPtr</span><span class="p">(</span>
                <span class="n">_runner_end</span><span class="p">[</span><span class="n">player</span><span class="p">],</span>
                <span class="o">~</span><span class="p">(</span><span class="mh">0x51A280</span> <span class="o">+</span> <span class="n">player</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">skipt</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">NextTrigger</span><span class="p">()</span>

    <span class="n">sf</span><span class="o">.</span><span class="n">f_setcurpl</span><span class="p">(</span><span class="n">oldcp</span><span class="p">)</span>


<span class="c1">#######</span>

<span class="n">orig_tstart</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">orig_tend</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">runner_end_array</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">AllocTrigTriggerLink</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">orig_tstart</span><span class="p">,</span> <span class="n">orig_tend</span><span class="p">,</span> <span class="n">runner_end_array</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">orig_tstart</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">eudlib</span> <span class="k">as</span> <span class="n">sf</span>

        <span class="n">orig_tstart</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">EUDArray</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">orig_tend</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">EUDArray</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">runner_end_array</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">EUDArray</span><span class="p">(</span><span class="n">_runner_end</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">GetFirstTrigTrigger</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get dlist start of trig-trigger for player &quot;&quot;&quot;</span>
    <span class="n">AllocTrigTriggerLink</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">orig_tstart</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">GetLastTrigTrigger</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get dlist end of trig-trigger for player&quot;&quot;&quot;</span>
    <span class="n">AllocTrigTriggerLink</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">orig_tend</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">TrigTriggerBegin</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
    <span class="n">AllocTrigTriggerLink</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">GetFirstTrigTrigger</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">TrigTriggerEnd</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
    <span class="n">AllocTrigTriggerLink</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_runner_end</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">runner_end_array</span><span class="p">[</span><span class="n">player</span><span class="p">]</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigtrg\trigtrg.py : 194 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">WARNING! This code is speciallized for use on eudplib</span>
<span class="sd">- Default player of rawtrigger is &#39;All Player&#39;.</span>
<span class="sd">- Only conditions/actions used in eudplib are declared</span>
<span class="sd">- Condition/Action input filtering (&amp; 0xFFFFFFFF thing) are only applied to</span>
<span class="sd">  player &amp; number section of Deaths/SetDeaths</span>
<span class="sd">Note this when using this code outside of eudplib.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="kn">from</span> <span class="nn">eudplib</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">ut</span>


<span class="k">def</span> <span class="nf">i2b1</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">((</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,))</span>


<span class="k">def</span> <span class="nf">i2b2</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">((</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">i2b4</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">((</span>
        <span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
        <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
        <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
        <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
    <span class="p">))</span>


<span class="c1"># for Deaths</span>
<span class="n">AtLeast</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">AtMost</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Exactly</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># for Set Death</span>
<span class="n">SetTo</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">Add</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">Subtract</span> <span class="o">=</span> <span class="mi">9</span>

<span class="c1"># player enum</span>
<span class="n">CurrentPlayer</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">AllPlayers</span> <span class="o">=</span> <span class="mi">17</span>

<span class="c1"># constructor</span>
<span class="n">_bc_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="n">i2b1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="n">i2b2</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="n">i2b4</span><span class="p">,</span>
    <span class="bp">None</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">FlattenList</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># l is not iterable</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">Condition</span><span class="p">(</span><span class="n">locid</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unitid</span><span class="p">,</span>
              <span class="n">comparison</span><span class="p">,</span> <span class="n">condtype</span><span class="p">,</span> <span class="n">restype</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">player</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">player</span> <span class="o">+=</span> <span class="mh">0x100000000</span>  <span class="c1"># EPD</span>

    <span class="n">player</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>
    <span class="n">amount</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>

    <span class="k">return</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;IIIHBBBBBB&#39;</span><span class="p">,</span> <span class="n">locid</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unitid</span><span class="p">,</span>
                <span class="n">comparison</span><span class="p">,</span> <span class="n">condtype</span><span class="p">,</span> <span class="n">restype</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Action</span><span class="p">(</span><span class="n">locid1</span><span class="p">,</span> <span class="n">strid</span><span class="p">,</span> <span class="n">wavid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">player1</span><span class="p">,</span>
           <span class="n">player2</span><span class="p">,</span> <span class="n">unitid</span><span class="p">,</span> <span class="n">acttype</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
    <span class="n">player1</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>
    <span class="n">player2</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>

    <span class="k">if</span> <span class="n">player1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">player1</span> <span class="o">+=</span> <span class="mh">0x100000000</span>  <span class="c1"># EPD</span>
    <span class="k">if</span> <span class="n">player2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">player2</span> <span class="o">+=</span> <span class="mh">0x100000000</span>  <span class="c1"># EPD</span>
    <span class="k">return</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;IIIIIIHBBBBBB&#39;</span><span class="p">,</span> <span class="n">locid1</span><span class="p">,</span> <span class="n">strid</span><span class="p">,</span> <span class="n">wavid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">player1</span><span class="p">,</span> <span class="n">player2</span><span class="p">,</span>
                <span class="n">unitid</span><span class="p">,</span> <span class="n">acttype</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Trigger</span><span class="p">(</span><span class="n">players</span><span class="o">=</span><span class="p">[</span><span class="n">AllPlayers</span><span class="p">],</span> <span class="n">conditions</span><span class="o">=</span><span class="p">[],</span> <span class="n">actions</span><span class="o">=</span><span class="p">[],</span> <span class="n">prtrig</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="n">FlattenList</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">FlattenList</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">players</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="p">)</span>
    <span class="n">peff</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
        <span class="n">peff</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">conditions</span> <span class="o">+</span>
        <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)))]</span> <span class="o">+</span>
        <span class="n">actions</span> <span class="o">+</span>
        <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="p">(</span><span class="mi">64</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">)))]</span> <span class="o">+</span>
        <span class="p">[</span><span class="n">prtrig</span> <span class="ow">and</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\x04\0\0\0</span><span class="s1">&#39;</span> <span class="ow">or</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\0\0\0\0</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span>
        <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="n">peff</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2400</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b</span>


<span class="c1"># conditions</span>
<span class="k">def</span> <span class="nf">Deaths</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Condition</span><span class="p">(</span>
        <span class="mh">0x00000000</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span>
        <span class="n">comparison</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Memory</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">offset</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># only this kind of comparison is possible</span>
    <span class="n">player</span> <span class="o">=</span> <span class="n">EPD</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">player</span> <span class="o">&lt;</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">228</span><span class="p">:</span>  <span class="c1"># eud possible</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">player</span> <span class="o">//</span> <span class="mi">12</span>
        <span class="n">player</span> <span class="o">=</span> <span class="n">player</span> <span class="o">%</span> <span class="mi">12</span>
        <span class="k">return</span> <span class="n">Deaths</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># use epd</span>
        <span class="k">return</span> <span class="n">Deaths</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1"># actions</span>
<span class="k">def</span> <span class="nf">SetDeaths</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">settype</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span>
        <span class="mh">0x00000000</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">,</span>
        <span class="n">player</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="n">settype</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">SetMemory</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">settype</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">offset</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">player</span> <span class="o">=</span> <span class="n">EPD</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">player</span> <span class="o">&lt;</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">228</span><span class="p">:</span>  <span class="c1"># eud possible</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">player</span> <span class="o">//</span> <span class="mi">12</span>
        <span class="n">player</span> <span class="o">=</span> <span class="n">player</span> <span class="o">%</span> <span class="mi">12</span>
        <span class="k">return</span> <span class="n">SetDeaths</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">settype</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># use epd</span>
        <span class="k">return</span> <span class="n">SetDeaths</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">settype</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">DisplayTextMessage</span><span class="p">(</span><span class="n">Text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Draw</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EPD</span><span class="p">(</span><span class="n">offset</span><span class="p">):</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ep_assert</span><span class="p">(</span><span class="n">offset</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="mh">0x0058A364</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\trigtrg\__init__.py : 35 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.runtrigtrg</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RunTrigTrigger</span><span class="p">,</span>

    <span class="n">GetFirstTrigTrigger</span><span class="p">,</span>
    <span class="n">GetLastTrigTrigger</span><span class="p">,</span>

    <span class="n">TrigTriggerBegin</span><span class="p">,</span>
    <span class="n">TrigTriggerEnd</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\binio.py : 61 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">b2i1</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">b2i2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">b2i4</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">b</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">i2b1</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">((</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,))</span>


<span class="k">def</span> <span class="nf">i2b2</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">((</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">i2b4</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">((</span>
        <span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
        <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
        <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
        <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
    <span class="p">))</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\blockstru.py : 94 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.eperror</span> <span class="kn">import</span> <span class="n">ep_assert</span>


<span class="k">class</span> <span class="nc">BlockStruManager</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blockstru</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastblockdict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blockstru</span>


<span class="n">_current_bsm</span> <span class="o">=</span> <span class="n">BlockStruManager</span><span class="p">()</span>  <span class="c1"># Default one</span>


<span class="k">def</span> <span class="nf">SetCurrentBlockStruManager</span><span class="p">(</span><span class="n">bsm</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_current_bsm</span>
    <span class="n">old_bsm</span> <span class="o">=</span> <span class="n">_current_bsm</span>
    <span class="n">_current_bsm</span> <span class="o">=</span> <span class="n">bsm</span>
    <span class="k">return</span> <span class="n">old_bsm</span>


<span class="k">def</span> <span class="nf">EUDCreateBlock</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
    <span class="n">_blockstru</span> <span class="o">=</span> <span class="n">_current_bsm</span><span class="o">.</span><span class="n">_blockstru</span>
    <span class="n">_lastblockdict</span> <span class="o">=</span> <span class="n">_current_bsm</span><span class="o">.</span><span class="n">_lastblockdict</span>

    <span class="n">block</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">userdata</span><span class="p">)</span>
    <span class="n">_blockstru</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_lastblockdict</span><span class="p">:</span>
        <span class="n">_lastblockdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_lastblockdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">EUDGetLastBlock</span><span class="p">():</span>
    <span class="n">_blockstru</span> <span class="o">=</span> <span class="n">_current_bsm</span><span class="o">.</span><span class="n">_blockstru</span>
    <span class="k">return</span> <span class="n">_blockstru</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">EUDGetLastBlockOfName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">_lastblockdict</span> <span class="o">=</span> <span class="n">_current_bsm</span><span class="o">.</span><span class="n">_lastblockdict</span>

    <span class="k">return</span> <span class="n">_lastblockdict</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">EUDPeekBlock</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">lastblock</span> <span class="o">=</span> <span class="n">EUDGetLastBlock</span><span class="p">()</span>
    <span class="n">ep_assert</span><span class="p">(</span><span class="n">lastblock</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Block starting/ending mismatch&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lastblock</span>


<span class="k">def</span> <span class="nf">EUDPopBlock</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">_blockstru</span> <span class="o">=</span> <span class="n">_current_bsm</span><span class="o">.</span><span class="n">_blockstru</span>
    <span class="n">_lastblockdict</span> <span class="o">=</span> <span class="n">_current_bsm</span><span class="o">.</span><span class="n">_lastblockdict</span>

    <span class="n">lastblock</span> <span class="o">=</span> <span class="n">_blockstru</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">ep_assert</span><span class="p">(</span><span class="n">lastblock</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">Block starting/ending mismatch:</span>
<span class="s2">    - Started with </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">    - Ended with </span><span class="si">%s</span><span class="se">\</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lastblock</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="p">))</span>
    <span class="n">_lastblockdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lastblock</span>


<span class="k">def</span> <span class="nf">EUDGetBlockList</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_current_bsm</span><span class="o">.</span><span class="n">_blockstru</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\eperror.py : 34 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">EPError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">ep_assert</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Assertion failed&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">statement</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">EPError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\etc.py : 156 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">itertools</span>


<span class="k">def</span> <span class="nf">EPD</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mh">0x58A364</span><span class="p">))</span> <span class="o">//</span> <span class="mi">4</span>


<span class="c1"># -------</span>


<span class="k">def</span> <span class="nf">FlattenList</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">FlattenList</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># l is not iterable</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">eqsplit</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">eqr</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">iterable</span><span class="p">),</span> <span class="n">eqr</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">iterable</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">eqr</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">eqr</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">item</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">eqr</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">List2Assignable</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">l</span>


<span class="k">def</span> <span class="nf">Assignable2List</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>


<span class="c1"># -------</span>

<span class="c1"># Original code from TrigEditPlus::ConvertString_SCMD2ToRaw</span>

<span class="k">def</span> <span class="nf">SCMD2Text</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># normal -&gt; xdigitinput1 -&gt; xdigitinput2 -&gt; xdigitinput3 -&gt; normal</span>
    <span class="c1">#        &#39;&lt;&#39;           xdigit          xdigit            &#39;&gt;&#39;</span>
    <span class="c1">#                        -&gt; normal</span>
    <span class="c1">#                       &#39;&gt;&#39; emit &#39;&lt;&gt;&#39;</span>
    <span class="c1">#                                        -&gt; normal</span>
    <span class="c1">#                                        &#39;&gt;&#39; emit x00</span>
    <span class="c1">#                                                        -&gt; normal</span>
    <span class="c1"># xdigit/normal  emit &#39;&lt;xx&#39;</span>
    <span class="k">def</span> <span class="nf">toxdigit</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;0&#39;</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="s1">&#39;9&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">48</span>
        <span class="k">elif</span> <span class="s1">&#39;a&#39;</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">97</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="s1">&#39;A&#39;</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">65</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">bufch</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># simple fsm</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xdi</span> <span class="o">=</span> <span class="n">toxdigit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xdi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdi</span>
                <span class="n">bufch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">xdi</span> <span class="o">=</span> <span class="n">toxdigit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xdi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdi</span>
                <span class="n">bufch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">3</span>

            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">bufch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">bufch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bufch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\exprproxy.py : 91 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">ExprProxy</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39; Class which can contain both constxpr and eudvariable &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initval</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">initval</span>

    <span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="c1"># Proxy operators</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">-</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">*</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">//</span> <span class="n">k</span>

    <span class="c1"># Proxy other methods</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unProxy</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unProxy</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\stackobjs.py : 79 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">StackObjects</span><span class="p">(</span>
    <span class="n">found_objects</span><span class="p">,</span>
    <span class="n">dwoccupmap_dict</span><span class="p">,</span>
    <span class="n">alloctable</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">dwoccupmap_max_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">found_objects</span><span class="p">:</span>
        <span class="n">dwoccupmap_max_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dwoccupmap_dict</span><span class="p">[</span><span class="n">obj</span><span class="p">])</span>

    <span class="c1"># Buffer to sum all dwoccupmaps</span>
    <span class="n">dwoccupmap_sum</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dwoccupmap_max_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">lallocaddr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">payload_size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">found_objects</span><span class="p">:</span>
        <span class="c1"># Convert to faster c array</span>
        <span class="n">dwoccupmap</span> <span class="o">=</span> <span class="n">dwoccupmap_dict</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
        <span class="n">oclen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dwoccupmap</span><span class="p">)</span>

        <span class="c1"># preprocess dwoccupmap</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">oclen</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Find appropriate position to allocate object</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">oclen</span><span class="p">:</span>
            <span class="c1"># Update on conflict map</span>
            <span class="k">if</span> <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">dwoccupmap_sum</span><span class="p">[</span><span class="n">lallocaddr</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">lallocaddr</span> <span class="o">=</span> <span class="n">dwoccupmap_sum</span><span class="p">[</span><span class="n">lallocaddr</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Apply occupation map</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">oclen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">curoff</span> <span class="o">=</span> <span class="n">lallocaddr</span> <span class="o">+</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">dwoccupmap</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">dwoccupmap_sum</span><span class="p">[</span><span class="n">curoff</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dwoccupmap_sum</span><span class="p">[</span><span class="n">curoff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">dwoccupmap_sum</span><span class="p">[</span><span class="n">curoff</span><span class="p">]</span> <span class="o">=</span> <span class="n">curoff</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dwoccupmap_sum</span><span class="p">[</span><span class="n">curoff</span><span class="p">]</span> <span class="o">=</span> <span class="n">dwoccupmap_sum</span><span class="p">[</span><span class="n">curoff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">alloctable</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">lallocaddr</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lallocaddr</span> <span class="o">+</span> <span class="n">oclen</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">&gt;</span> <span class="n">payload_size</span><span class="p">:</span>
            <span class="n">payload_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">lallocaddr</span> <span class="o">+</span> <span class="n">oclen</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\ubconv.py : 53 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">from</span> <span class="nn">.eperror</span> <span class="kn">import</span> <span class="n">EPError</span>

<span class="n">g_encoding</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">getpreferredencoding</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">UbconvSetEncoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">g_encoding</span>
    <span class="n">g_encoding</span> <span class="o">=</span> <span class="n">encoding</span>


<span class="k">def</span> <span class="nf">u2b</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">g_encoding</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Invalid type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">b2u</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">g_encoding</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">EPError</span><span class="p">(</span><span class="s1">&#39;Invalid type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</pre></div>
</td></tr></table><br><br><p><h2> eudplib\utils\__init__.py : 52 lines </h2></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright (c) 2014 trgk</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">THE SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">.ubconv</span> <span class="kn">import</span> <span class="n">u2b</span><span class="p">,</span> <span class="n">b2u</span>
<span class="kn">from</span> <span class="nn">.binio</span> <span class="kn">import</span> <span class="n">b2i1</span><span class="p">,</span> <span class="n">b2i2</span><span class="p">,</span> <span class="n">b2i4</span><span class="p">,</span> <span class="n">i2b1</span><span class="p">,</span> <span class="n">i2b2</span><span class="p">,</span> <span class="n">i2b4</span>
<span class="kn">from</span> <span class="nn">.blockstru</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EUDCreateBlock</span><span class="p">,</span>
    <span class="n">EUDGetLastBlock</span><span class="p">,</span>
    <span class="n">EUDGetLastBlockOfName</span><span class="p">,</span>
    <span class="n">EUDPeekBlock</span><span class="p">,</span>
    <span class="n">EUDPopBlock</span><span class="p">,</span>
    <span class="n">EUDGetBlockList</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.etc</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EPD</span><span class="p">,</span>
    <span class="n">FlattenList</span><span class="p">,</span>
    <span class="n">List2Assignable</span><span class="p">,</span>
    <span class="n">Assignable2List</span><span class="p">,</span>
    <span class="n">SCMD2Text</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.eperror</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EPError</span><span class="p">,</span>
    <span class="n">ep_assert</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.exprproxy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExprProxy</span><span class="p">,</span>
    <span class="n">unProxy</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table><br><br>
</body>
</html>
